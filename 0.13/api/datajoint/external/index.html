
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/project-logo-color.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.3">
    
    
      
        <title>external.py - DataJoint Python</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Slab";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="datajoint" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datajoint.external" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DataJoint Python" class="md-header__button md-logo" aria-label="DataJoint Python" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 208.15 210.1">
    <defs>
    </defs>
    <title>Asset 3</title>
    <g id="Layer_2" data-name="Layer 2">
        <g id="Layer_1-2" data-name="Layer 1">
            <polygon class="cls-1" points="104.58 90.61 104.58 149.75 155.7 120.03 155.73 61.06 104.58 90.61" />
            <polygon class="cls-1"
                points="208.15 30.67 156.7 60.39 156.71 60.45 156.68 119.36 208.15 89.43 208.15 30.67" />
            <polygon class="cls-1" points="103.48 149.75 103.69 89.92 52.05 61.1 52.15 120.02 103.48 149.75" />
            <polygon class="cls-1"
                points="103.57 150.88 52.04 121.16 52.03 180.34 103.55 210.08 103.58 151.13 103.57 150.88" />
            <polygon class="cls-1" points="155.73 121.17 104.58 150.9 104.58 210.1 155.65 180.83 155.73 121.17" />
            <polygon class="cls-1" points="207.64 29.75 156.28 0.1 104.83 29.84 156.09 59.53 207.64 29.75" />
            <path class="cls-1" d="M104.08,30.27" />
            <path class="cls-1" d="M104.23,30" />
            <polygon class="cls-1" points="104.58 89.41 155.21 60.16 104.58 30.86 104.58 89.41" />
            <polygon class="cls-1"
                points="104.1 30.05 52.05 0 0 30.05 0 30.07 0 30.08 52.05 60.12 104.08 30.06 104.1 30.05" />
        </g>
    </g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DataJoint Python
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              external.py
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="datajoint" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
    <label class="md-nav__title" for="__drawer">
        <a href="../../.." title="DataJoint Python"
            class="md-nav__button md-logo" aria-label="DataJoint Python" data-md-component="logo">
            
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 208.15 210.1">
    <defs>
    </defs>
    <title>Asset 3</title>
    <g id="Layer_2" data-name="Layer 2">
        <g id="Layer_1-2" data-name="Layer 1">
            <polygon class="cls-1" points="104.58 90.61 104.58 149.75 155.7 120.03 155.73 61.06 104.58 90.61" />
            <polygon class="cls-1"
                points="208.15 30.67 156.7 60.39 156.71 60.45 156.68 119.36 208.15 89.43 208.15 30.67" />
            <polygon class="cls-1" points="103.48 149.75 103.69 89.92 52.05 61.1 52.15 120.02 103.48 149.75" />
            <polygon class="cls-1"
                points="103.57 150.88 52.04 121.16 52.03 180.34 103.55 210.08 103.58 151.13 103.57 150.88" />
            <polygon class="cls-1" points="155.73 121.17 104.58 150.9 104.58 210.1 155.65 180.83 155.73 121.17" />
            <polygon class="cls-1" points="207.64 29.75 156.28 0.1 104.83 29.84 156.09 59.53 207.64 29.75" />
            <path class="cls-1" d="M104.08,30.27" />
            <path class="cls-1" d="M104.23,30" />
            <polygon class="cls-1" points="104.58 89.41 155.21 60.16 104.58 30.86 104.58 89.41" />
            <polygon class="cls-1"
                points="104.1 30.05 52.05 0 0 30.05 0 30.07 0 30.08 52.05 60.12 104.08 30.06 104.1 30.05" />
        </g>
    </g>
</svg>

        </a><a href="https://datajoint.com/docs/" title="DataJoint">
            â¬… Home
        </a>
    </label>
    
    <div class="md-nav__source">
        <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        DataJoint Python
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          datajoint
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="datajoint" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          datajoint
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../__init__/" class="md-nav__link">
        __init__.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin/" class="md-nav__link">
        admin.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribute_adapter/" class="md-nav__link">
        attribute_adapter.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autopopulate/" class="md-nav__link">
        autopopulate.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../blob/" class="md-nav__link">
        blob.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../condition/" class="md-nav__link">
        condition.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connection/" class="md-nav__link">
        connection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../declare/" class="md-nav__link">
        declare.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        dependencies.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diagram/" class="md-nav__link">
        diagram.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        errors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../expression/" class="md-nav__link">
        expression.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          external.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        external.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datajoint.external" class="md-nav__link">
    datajoint.external
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.external.ExternalMapping" class="md-nav__link">
    ExternalMapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable" class="md-nav__link">
    ExternalTable
  </a>
  
    <nav class="md-nav" aria-label="ExternalTable">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.delete" class="md-nav__link">
    delete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.download_attachment" class="md-nav__link">
    download_attachment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.download_filepath" class="md-nav__link">
    download_filepath()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.exists" class="md-nav__link">
    exists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.fetch_external_paths" class="md-nav__link">
    fetch_external_paths()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.put" class="md-nav__link">
    put()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.references" class="md-nav__link">
    references()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.unused" class="md-nav__link">
    unused()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.upload_filepath" class="md-nav__link">
    upload_filepath()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.external.ExternalTable.used" class="md-nav__link">
    used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.external.subfold" class="md-nav__link">
    subfold()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fetch/" class="md-nav__link">
        fetch.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hash/" class="md-nav__link">
        hash.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../heading/" class="md-nav__link">
        heading.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jobs/" class="md-nav__link">
        jobs.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        logging.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../migrate/" class="md-nav__link">
        migrate.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        plugin.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../preview/" class="md-nav__link">
        preview.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        s3.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/" class="md-nav__link">
        schemas.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        settings.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../table/" class="md-nav__link">
        table.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_tables/" class="md-nav__link">
        user_tables.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../version/" class="md-nav__link">
        version.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>external.py</h1>

<div class="doc doc-object doc-module">


<a id="datajoint.external"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="datajoint.external.ExternalMapping" class="doc doc-heading">
        <code>ExternalMapping</code>


<a href="#datajoint.external.ExternalMapping" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="collections.abc.Mapping">Mapping</span></code></p>

  
      <p>The external manager contains all the tables for all external stores for a given schema
:Example:
    e = ExternalMapping(schema)
    external_table = e[store]</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/external.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalMapping</span><span class="p">(</span><span class="n">Mapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The external manager contains all the tables for all external stores for a given schema</span>
<span class="sd">    :Example:</span>
<span class="sd">        e = ExternalMapping(schema)</span>
<span class="sd">        external_table = e[store]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;External file tables for schema `</span><span class="si">{schema}</span><span class="s2">`:</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">database</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s1">&#39;&quot;</span><span class="si">{store}</span><span class="s1">&quot; </span><span class="si">{protocol}</span><span class="s1">:</span><span class="si">{location}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="o">**</span><span class="n">v</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Triggers the creation of an external table.</span>
<span class="sd">        Should only be used when ready to save or read from external storage.</span>

<span class="sd">        :param store: the name of the store</span>
<span class="sd">        :return: the ExternalTable object for the store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">store</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExternalTable</span><span class="p">(</span>
                <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="datajoint.external.ExternalTable" class="doc doc-heading">
        <code>ExternalTable</code>


<a href="#datajoint.external.ExternalTable" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.table.Table" href="../table/#datajoint.table.Table">Table</a></code></p>

  
      <p>The table tracking externally stored objects.
Declare as ExternalTable(connection, database)</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/external.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The table tracking externally stored objects.</span>
<span class="sd">    Declare as ExternalTable(connection, database)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_store_spec</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">table_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">conn</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declare</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;Inaccessible local directory </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # external storage tracking</span>
<span class="s2">        hash  : uuid    #  hash of contents (blob), of filename + contents (attach), or relative filepath (filepath)</span>
<span class="s2">        ---</span>
<span class="s2">        size      :bigint unsigned     # size of object in bytes</span>
<span class="s2">        attachment_name=null : varchar(255)  # the filename of an attachment</span>
<span class="s2">        filepath=null : varchar(1000)  # relative filepath or attachment filename</span>
<span class="s2">        contents_hash=null : uuid      # used for the filepath datatype</span>
<span class="s2">        timestamp=CURRENT_TIMESTAMP  :timestamp   # automatic timestamp</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">EXTERNAL_TABLE_ROOT</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Folder</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span>

    <span class="c1"># - low-level operations - private</span>

    <span class="k">def</span> <span class="nf">_make_external_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;resolve the complete external path based on the relative path&quot;&quot;&quot;</span>
        <span class="c1"># Strip root</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="n">posix_path</span> <span class="o">=</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">PureWindowsPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]))</span>
            <span class="n">location_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">posix_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">case</span> <span class="ow">in</span> <span class="n">posix_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">))</span>
                <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="n">posix_path</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">location_path</span><span class="p">,</span> <span class="n">relative_filepath</span><span class="p">)</span>
        <span class="c1"># Preserve root</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]),</span> <span class="n">relative_filepath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_make_uuid_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;create external path based on the uuid hash&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span>
            <span class="n">PurePosixPath</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subfold</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;subfolding&quot;</span><span class="p">])),</span>
                <span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upload_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">external_path</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">fput</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">external_path</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">safe_copy</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">external_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">safe_copy</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_upload_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">external_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">safe_write</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_download_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_remove_external_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if the external file is accessible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">external_filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">external_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="c1"># --- BLOBS ----</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blob</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        put a binary string (blob) in external store</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_buffer</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span>
        <span class="c1"># insert tracking info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO </span><span class="si">{tab}</span><span class="s2"> (hash, size) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">{size}</span><span class="s2">) ON DUPLICATE KEY &quot;</span>
            <span class="s2">&quot;UPDATE timestamp=CURRENT_TIMESTAMP&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span><span class="p">,),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">uuid</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get an object from external store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uuid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># attempt to get object from cache</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cache_folder</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cache&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cache_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_folder</span><span class="p">,</span> <span class="o">*</span><span class="n">subfold</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="n">CACHE_SUBFOLDING</span><span class="p">))</span>
                <span class="n">cache_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">)</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># not cached</span>
        <span class="c1"># download blob from external store</span>
        <span class="k">if</span> <span class="n">blob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">MissingExternalFile</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">SUPPORT_MIGRATED_BLOBS</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># blobs migrated from datajoint 0.11 are stored at explicitly defined filepaths</span>
                <span class="n">relative_filepath</span><span class="p">,</span> <span class="n">contents_hash</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
                    <span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;contents_hash&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">relative_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_buffer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
                <span class="n">cache_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">safe_write</span><span class="p">(</span><span class="n">cache_path</span> <span class="o">/</span> <span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="n">blob</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span>

    <span class="c1"># --- ATTACHMENTS ---</span>

    <span class="k">def</span> <span class="nf">upload_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_path</span><span class="p">):</span>
        <span class="n">attachment_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">init_string</span><span class="o">=</span><span class="n">attachment_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">external_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">attachment_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_file</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">external_path</span><span class="p">)</span>
        <span class="c1"># insert tracking info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INSERT INTO {tab} (hash, size, attachment_name)</span>
<span class="sd">        VALUES (%s, {size}, &quot;{attachment_name}&quot;)</span>
<span class="sd">        ON DUPLICATE KEY UPDATE timestamp=CURRENT_TIMESTAMP&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
                <span class="n">attachment_name</span><span class="o">=</span><span class="n">attachment_name</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">uuid</span>

    <span class="k">def</span> <span class="nf">get_attachment_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;attachment_name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">attachment_name</span><span class="p">,</span> <span class="n">download_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;save attachment from memory buffer into the save_path&quot;&quot;&quot;</span>
        <span class="n">external_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">attachment_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>

    <span class="c1"># --- FILEPATH ---</span>

    <span class="k">def</span> <span class="nf">upload_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise exception if an external entry already exists with a different contents checksum.</span>
<span class="sd">        Otherwise, copy (with overwrite) file to remote and</span>
<span class="sd">        If an external entry exists with the same checksum, then no copying should occur</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">local_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">relative_filepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">local_filepath</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The path </span><span class="si">{path}</span><span class="s2"> is not in stage </span><span class="si">{stage}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">local_filepath</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span>
            <span class="n">init_string</span><span class="o">=</span><span class="n">relative_filepath</span>
        <span class="p">)</span>  <span class="c1"># hash relative path, not contents</span>
        <span class="n">contents_hash</span> <span class="o">=</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span>

        <span class="c1"># check if the remote file already exists and verify that it matches</span>
        <span class="n">check_hash</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;contents_hash&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_hash</span><span class="p">:</span>
            <span class="c1"># the tracking entry exists, check that it&#39;s the same file as before</span>
            <span class="k">if</span> <span class="n">contents_hash</span> <span class="o">!=</span> <span class="n">check_hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;A different version of &#39;</span><span class="si">{</span><span class="n">relative_filepath</span><span class="si">}</span><span class="s2">&#39; has already been placed.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># upload the file and create its tracking entry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_file</span><span class="p">(</span>
                <span class="n">local_filepath</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;contents_hash&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">contents_hash</span><span class="p">)},</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO </span><span class="si">{tab}</span><span class="s2"> (hash, size, filepath, contents_hash) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">{size}</span><span class="s2">, &#39;</span><span class="si">{filepath}</span><span class="s2">&#39;, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
                    <span class="n">filepath</span><span class="o">=</span><span class="n">relative_filepath</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span><span class="p">,</span> <span class="n">contents_hash</span><span class="o">.</span><span class="n">bytes</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">uuid</span>

    <span class="k">def</span> <span class="nf">download_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath_hash</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sync a file from external store to the local stage</span>

<span class="sd">        :param filepath_hash: The hash (UUID) of the relative_path</span>
<span class="sd">        :return: hash (UUID) of the contents of the downloaded file or Nones</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">):</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filepath_checksum_size_limit&quot;</span><span class="p">)</span>
            <span class="n">actual_size</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
            <span class="k">if</span> <span class="n">expected_size</span> <span class="o">!=</span> <span class="n">actual_size</span><span class="p">:</span>
                <span class="c1"># this should never happen without outside interference</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&#39; downloaded but size did not match.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">actual_size</span> <span class="o">&lt;</span> <span class="n">limit</span>

        <span class="k">if</span> <span class="n">filepath_hash</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relative_filepath</span><span class="p">,</span> <span class="n">contents_hash</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">filepath_hash</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;contents_hash&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span>
            <span class="n">external_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">)</span>
            <span class="n">local_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="n">relative_filepath</span>

            <span class="n">file_exists</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">contents_hash</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">local_filepath</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span> <span class="o">!=</span> <span class="n">contents_hash</span>
                <span class="p">):</span>
                    <span class="c1"># this should never happen without outside interference</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&#39; downloaded but did not pass checksum.&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Skipped checksum for file with hash: </span><span class="si">{</span><span class="n">contents_hash</span><span class="si">}</span><span class="s2">, and path: </span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">),</span> <span class="n">contents_hash</span>

    <span class="c1"># --- UTILITIES ---</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: generator of referencing table names and their referencing columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SELECT concat(&#39;`&#39;, table_schema, &#39;`.`&#39;, table_name, &#39;`&#39;) as referencing_table, column_name</span>
<span class="sd">        FROM information_schema.key_column_usage</span>
<span class="sd">        WHERE referenced_table_name=&quot;{tab}&quot; and referenced_table_schema=&quot;{db}&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                <span class="p">),</span>
                <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_external_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate complete external filepaths from the query.</span>
<span class="sd">        Each element is a tuple: (uuid, path)</span>

<span class="sd">        :param fetch_kwargs: keyword arguments to pass to fetch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fetch_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="s2">&quot;attachment_name&quot;</span><span class="p">,</span> <span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;attachment_name&quot;</span><span class="p">]:</span>
                <span class="c1"># attachments</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;attachment_name&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]:</span>
                <span class="c1"># external filepaths</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># blobs</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">])</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">],</span> <span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">unused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        query expression for unused hashes</span>

<span class="sd">        :return: self restricted to elements that are not in use by any tables in the schema</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;referencing_table&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                <span class="nb">hash</span><span class="o">=</span><span class="n">ref</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        query expression for used hashes</span>

<span class="sd">        :return: self restricted to elements that in use by tables in the schema</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">&amp;</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;referencing_table&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                <span class="nb">hash</span><span class="o">=</span><span class="n">ref</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">delete_external_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">display_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">errors_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param delete_external_files: True or False. If False, only the tracking info is removed from the external</span>
<span class="sd">                store table but the external files remain intact. If True, then the external files themselves are deleted too.</span>
<span class="sd">        :param errors_as_string: If True any errors returned when deleting from external files will be strings</span>
<span class="sd">        :param limit: (integer) limit the number of items to delete</span>
<span class="sd">        :param display_progress: if True, display progress as files are cleaned up</span>
<span class="sd">        :return: if deleting external files, returns errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">delete_external_files</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The delete_external_files argument must be set to either &quot;</span>
                <span class="s2">&quot;True or False in delete()&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_external_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unused</span><span class="p">()</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_external_paths</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">display_progress</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="c1"># delete items one by one, close to transaction-safe</span>
            <span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">external_path</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># if delete failed, do not remove the external file</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_external_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                            <span class="c1"># adding row back into table after failed delete</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">(</span>
                                    <span class="n">uuid</span><span class="p">,</span>
                                    <span class="n">external_path</span><span class="p">,</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">if</span> <span class="n">errors_as_string</span> <span class="k">else</span> <span class="n">error</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
            <span class="k">return</span> <span class="n">error_list</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.delete" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">delete_external_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.delete" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>:param delete_external_files: True or False. If False, only the tracking info is removed from the external
        store table but the external files remain intact. If True, then the external files themselves are deleted too.
:param errors_as_string: If True any errors returned when deleting from external files will be strings
:param limit: (integer) limit the number of items to delete
:param display_progress: if True, display progress as files are cleaned up
:return: if deleting external files, returns errors</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">delete_external_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">display_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">errors_as_string</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param delete_external_files: True or False. If False, only the tracking info is removed from the external</span>
<span class="sd">            store table but the external files remain intact. If True, then the external files themselves are deleted too.</span>
<span class="sd">    :param errors_as_string: If True any errors returned when deleting from external files will be strings</span>
<span class="sd">    :param limit: (integer) limit the number of items to delete</span>
<span class="sd">    :param display_progress: if True, display progress as files are cleaned up</span>
<span class="sd">    :return: if deleting external files, returns errors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">delete_external_files</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;The delete_external_files argument must be set to either &quot;</span>
            <span class="s2">&quot;True or False in delete()&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_external_files</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unused</span><span class="p">()</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_external_paths</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">display_progress</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="c1"># delete items one by one, close to transaction-safe</span>
        <span class="n">error_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">external_path</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># if delete failed, do not remove the external file</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_external_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                        <span class="c1"># adding row back into table after failed delete</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">error_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">uuid</span><span class="p">,</span>
                                <span class="n">external_path</span><span class="p">,</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">if</span> <span class="n">errors_as_string</span> <span class="k">else</span> <span class="n">error</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">error_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.download_attachment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_attachment</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">attachment_name</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.download_attachment" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>save attachment from memory buffer into the save_path</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">attachment_name</span><span class="p">,</span> <span class="n">download_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;save attachment from memory buffer into the save_path&quot;&quot;&quot;</span>
    <span class="n">external_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">attachment_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_download_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">download_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.download_filepath" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_filepath</span><span class="p">(</span><span class="n">filepath_hash</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.download_filepath" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>sync a file from external store to the local stage</p>
<p>:param filepath_hash: The hash (UUID) of the relative_path
:return: hash (UUID) of the contents of the downloaded file or Nones</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath_hash</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sync a file from external store to the local stage</span>

<span class="sd">    :param filepath_hash: The hash (UUID) of the relative_path</span>
<span class="sd">    :return: hash (UUID) of the contents of the downloaded file or Nones</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">expected_size</span><span class="p">):</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filepath_checksum_size_limit&quot;</span><span class="p">)</span>
        <span class="n">actual_size</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
        <span class="k">if</span> <span class="n">expected_size</span> <span class="o">!=</span> <span class="n">actual_size</span><span class="p">:</span>
            <span class="c1"># this should never happen without outside interference</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&#39; downloaded but size did not match.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">actual_size</span> <span class="o">&lt;</span> <span class="n">limit</span>

    <span class="k">if</span> <span class="n">filepath_hash</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">relative_filepath</span><span class="p">,</span> <span class="n">contents_hash</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">filepath_hash</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;contents_hash&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="n">external_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">)</span>
        <span class="n">local_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="n">relative_filepath</span>

        <span class="n">file_exists</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span> <span class="o">==</span> <span class="n">contents_hash</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_exists</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_file</span><span class="p">(</span><span class="n">external_path</span><span class="p">,</span> <span class="n">local_filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span> <span class="o">!=</span> <span class="n">contents_hash</span>
            <span class="p">):</span>
                <span class="c1"># this should never happen without outside interference</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&#39; downloaded but did not pass checksum.&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_need_checksum</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Skipped checksum for file with hash: </span><span class="si">{</span><span class="n">contents_hash</span><span class="si">}</span><span class="s2">, and path: </span><span class="si">{</span><span class="n">local_filepath</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">),</span> <span class="n">contents_hash</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.exists" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">external_filepath</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.exists" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>:return: True if the external file is accessible</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">external_filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: True if the external file is accessible</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">external_filepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">external_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
    <span class="k">assert</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.fetch_external_paths" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_external_paths</span><span class="p">(</span><span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.fetch_external_paths" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>generate complete external filepaths from the query.
Each element is a tuple: (uuid, path)</p>
<p>:param fetch_kwargs: keyword arguments to pass to fetch</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_external_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generate complete external filepaths from the query.</span>
<span class="sd">    Each element is a tuple: (uuid, path)</span>

<span class="sd">    :param fetch_kwargs: keyword arguments to pass to fetch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fetch_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="s2">&quot;attachment_name&quot;</span><span class="p">,</span> <span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;attachment_name&quot;</span><span class="p">]:</span>
            <span class="c1"># attachments</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;attachment_name&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]:</span>
            <span class="c1"># external filepaths</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># blobs</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">])</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;hash&quot;</span><span class="p">],</span> <span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">paths</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.get" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.get" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>get an object from external store.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get an object from external store.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">uuid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># attempt to get object from cache</span>
    <span class="n">blob</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cache_folder</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cache&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_folder</span><span class="p">,</span> <span class="o">*</span><span class="n">subfold</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="n">CACHE_SUBFOLDING</span><span class="p">))</span>
            <span class="n">cache_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">)</span>
            <span class="n">blob</span> <span class="o">=</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># not cached</span>
    <span class="c1"># download blob from external store</span>
    <span class="k">if</span> <span class="n">blob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">MissingExternalFile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">SUPPORT_MIGRATED_BLOBS</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># blobs migrated from datajoint 0.11 are stored at explicitly defined filepaths</span>
            <span class="n">relative_filepath</span><span class="p">,</span> <span class="n">contents_hash</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
                <span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;contents_hash&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">relative_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">blob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_buffer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">cache_folder</span><span class="p">:</span>
            <span class="n">cache_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">safe_write</span><span class="p">(</span><span class="n">cache_path</span> <span class="o">/</span> <span class="n">uuid</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="n">blob</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blob</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.put" class="doc doc-heading">
<code class="highlight language-python"><span class="n">put</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.put" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>put a binary string (blob) in external store</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    put a binary string (blob) in external store</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_upload_buffer</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_uuid_path</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span>
    <span class="c1"># insert tracking info</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="s2">&quot;INSERT INTO </span><span class="si">{tab}</span><span class="s2"> (hash, size) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">{size}</span><span class="s2">) ON DUPLICATE KEY &quot;</span>
        <span class="s2">&quot;UPDATE timestamp=CURRENT_TIMESTAMP&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">blob</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span><span class="p">,),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">uuid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.references" class="doc doc-heading">
<code class="highlight language-python"><span class="n">references</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.external.ExternalTable.references" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>:return: generator of referencing table names and their referencing columns</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: generator of referencing table names and their referencing columns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SELECT concat(&#39;`&#39;, table_schema, &#39;`.`&#39;, table_name, &#39;`&#39;) as referencing_table, column_name</span>
<span class="sd">    FROM information_schema.key_column_usage</span>
<span class="sd">    WHERE referenced_table_name=&quot;{tab}&quot; and referenced_table_schema=&quot;{db}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.unused" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unused</span><span class="p">()</span></code>

<a href="#datajoint.external.ExternalTable.unused" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>query expression for unused hashes</p>
<p>:return: self restricted to elements that are not in use by any tables in the schema</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    query expression for unused hashes</span>

<span class="sd">    :return: self restricted to elements that are not in use by any tables in the schema</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;referencing_table&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
            <span class="nb">hash</span><span class="o">=</span><span class="n">ref</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.upload_filepath" class="doc doc-heading">
<code class="highlight language-python"><span class="n">upload_filepath</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span></code>

<a href="#datajoint.external.ExternalTable.upload_filepath" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Raise exception if an external entry already exists with a different contents checksum.
Otherwise, copy (with overwrite) file to remote and
If an external entry exists with the same checksum, then no copying should occur</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">upload_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raise exception if an external entry already exists with a different contents checksum.</span>
<span class="sd">    Otherwise, copy (with overwrite) file to remote and</span>
<span class="sd">    If an external entry exists with the same checksum, then no copying should occur</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">local_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">relative_filepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">local_filepath</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;The path </span><span class="si">{path}</span><span class="s2"> is not in stage </span><span class="si">{stage}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="n">local_filepath</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">spec</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span>
        <span class="n">init_string</span><span class="o">=</span><span class="n">relative_filepath</span>
    <span class="p">)</span>  <span class="c1"># hash relative path, not contents</span>
    <span class="n">contents_hash</span> <span class="o">=</span> <span class="n">uuid_from_file</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span>

    <span class="c1"># check if the remote file already exists and verify that it matches</span>
    <span class="n">check_hash</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">})</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;contents_hash&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">check_hash</span><span class="p">:</span>
        <span class="c1"># the tracking entry exists, check that it&#39;s the same file as before</span>
        <span class="k">if</span> <span class="n">contents_hash</span> <span class="o">!=</span> <span class="n">check_hash</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;A different version of &#39;</span><span class="si">{</span><span class="n">relative_filepath</span><span class="si">}</span><span class="s2">&#39; has already been placed.&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># upload the file and create its tracking entry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_file</span><span class="p">(</span>
            <span class="n">local_filepath</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_make_external_filepath</span><span class="p">(</span><span class="n">relative_filepath</span><span class="p">),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;contents_hash&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">contents_hash</span><span class="p">)},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO </span><span class="si">{tab}</span><span class="s2"> (hash, size, filepath, contents_hash) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">{size}</span><span class="s2">, &#39;</span><span class="si">{filepath}</span><span class="s2">&#39;, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">local_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span>
                <span class="n">filepath</span><span class="o">=</span><span class="n">relative_filepath</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span><span class="p">,</span> <span class="n">contents_hash</span><span class="o">.</span><span class="n">bytes</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">uuid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="datajoint.external.ExternalTable.used" class="doc doc-heading">
<code class="highlight language-python"><span class="n">used</span><span class="p">()</span></code>

<a href="#datajoint.external.ExternalTable.used" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>query expression for used hashes</p>
<p>:return: self restricted to elements that in use by tables in the schema</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">used</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    query expression for used hashes</span>

<span class="sd">    :return: self restricted to elements that in use by tables in the schema</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">&amp;</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;referencing_table&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
            <span class="nb">hash</span><span class="o">=</span><span class="n">ref</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">references</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="datajoint.external.subfold" class="doc doc-heading">
<code class="highlight language-python"><span class="n">subfold</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">folds</span><span class="p">)</span></code>

<a href="#datajoint.external.subfold" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>subfolding for external storage:   e.g.  subfold('aBCdefg', (2, 3))  --&gt;  ['ab','cde']</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/external.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subfold</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">folds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    subfolding for external storage:   e.g.  subfold(&#39;aBCdefg&#39;, (2, 3))  --&gt;  [&#39;ab&#39;,&#39;cde&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">name</span><span class="p">[:</span> <span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),)</span> <span class="o">+</span> <span class="n">subfold</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:],</span> <span class="n">folds</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">folds</span>
        <span class="k">else</span> <span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../expression/" class="md-footer__link md-footer__link--prev" aria-label="Previous: expression.py" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              expression.py
            </div>
          </div>
        </a>
      
      
        
        <a href="../fetch/" class="md-footer__link md-footer__link--next" aria-label="Next: fetch.py" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              fetch.py
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://www.datajoint.com/" target="_blank" rel="noopener" title="www.datajoint.com" class="md-social__link">
      <svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 479" width="451" height="479">
	<title>www.datajoint.com</title>
	<defs>
		<linearGradient id="g1" x1="0" y1="239.1" x2="1156.4" y2="239.1" gradientUnits="userSpaceOnUse">
			<stop offset="0" stop-color="#ffffff" />
			<stop offset=".2" stop-color="#ffffff" />
			<stop offset=".4" stop-color="#ffffff" />
			<stop offset="1" stop-color="#ffffff" />
		</linearGradient>
	</defs>
	<g id="Layer">
		<g id="Layer">
			<g id="Layer">
				<g id="Layer">
					<path id="Layer" class="s0"
						d="m436.7 96v82.7c8.3 1.9 14.4 9.5 14.4 18.2 0 10.3-8.4 18.7-18.7 18.7-5 0-9.8-2.1-13.3-5.6l-72.7 42q0.9 2.9 0.9 5.7c0 8.6-6 16.2-14.3 18.2v81.6c8.3 2 14.3 9.6 14.3 18.2 0 10.3-8.4 18.7-18.7 18.7-4.8 0-9.4-1.8-12.9-5.1l-82.4 47.6 24.6 41.4h-67.7l26.5-41.3-82.6-47.7c-3.4 3.2-8.1 5.1-12.8 5.1-10.3 0-18.7-8.4-18.7-18.7 0-8.5 5.9-16.1 14.2-18.1v-81.6c-8.2-2.1-14.2-9.7-14.2-18.2 0-8.5 5.9-16.1 14.2-18.1v-85.9c-8.2-2.1-14.2-9.7-14.2-18.2 0-0.8 0.1-1.7 0.2-2.5l-71.1-41.8c-3.5 3.3-8.2 5.2-13 5.2-10.3 0-18.7-8.4-18.7-18.7 0-10.4 8.4-18.7 18.7-18.7 4.9 0 9.6 2 13.1 5.4l71.4-41.2c-0.4-1.5-0.6-3-0.6-4.6 0-10.3 8.4-18.7 18.7-18.7 10.3 0 18.7 8.4 18.8 18.9 0 1.6-0.2 3.1-0.6 4.6l72.4 41.8c3.5-3.8 8.5-6 13.7-6 5 0 9.8 2 13.3 5.5l71.6-41.4c-0.4-1.5-0.6-3.1-0.6-4.6 0-10.3 8.4-18.7 18.7-18.7 10.3 0 18.7 8.4 18.7 18.7 0 1.6-0.2 3.1-0.6 4.6l72.1 41.6c3.5-3.8 8.5-5.9 13.6-5.9 10.3 0 18.7 8.4 18.7 18.7 0 8.6-6.1 16.2-14.4 18.2zm-315.6 20.9c5.8 0 11.1 2.6 14.7 7.1l71.6-41.3c-0.4-1.6-0.6-3.2-0.6-4.9q0-2.4 0.6-4.8l-72.3-41.8c-3.5 3.9-8.6 6.2-13.9 6.2-5.3 0-10.4-2.3-13.9-6.2l-70.9 40.9c0.6 1.8 0.9 3.7 0.9 5.6 0 2-0.3 4-0.9 5.9l69.7 41c3.5-4.9 9.2-7.8 15-7.7zm9.1 35.1c-1.3 0.8-2.8 1.3-4.3 1.7v86c3.2 0.8 6.1 2.4 8.5 4.7l77.9-45zm86.7 168.9l-84-48.5c-2.1 1.7-4.5 2.9-7.1 3.5v81.7c8.3 2 14.2 9.6 14.2 18.1 0 2.1-0.3 4.1-1 6l77.9 45zm0-113.7l-77.8 44.9q0.9 2.7 0.9 5.4l76.9 44.5zm3.5-111.5c-3.3-1-6.3-2.8-8.6-5.3l-72.2 41.7c0.2 1.1 0.3 2.3 0.3 3.4 0 1 0 2-0.2 3l80.7 46.6zm89.8 42.9c-0.2-1-0.3-2.1-0.3-3.1 0-1.1 0.1-2.3 0.3-3.4l-71.4-41.2c-2.6 2.5-5.9 4.3-9.4 5.1v89.3zm-77 68.8v94.5l76.6-44.3c0-1.9 0.3-3.8 0.9-5.5l-77.4-44.7zm90.9 150.2v-81.8c-2.6-0.6-4.9-1.8-7-3.4l-83.7 48.5v105.6l77.5-44.8c-0.7-1.9-1-3.9-1-6 0-8.5 5.9-16 14.1-18.1zm0-204c-1.5-0.3-2.9-0.9-4.3-1.6l-82 47.5 77.8 44.9c2.3-2.4 5.3-4 8.5-4.8zm19.2-29.7l71.2-41.1c-0.5-1.7-0.7-3.4-0.7-5.1 0-1.7 0.2-3.4 0.7-5l-71.9-41.5c-3.6 3.9-8.6 6.2-13.9 6.2-5.3 0-10.4-2.2-13.9-6.2l-71.3 41.1c0.5 1.8 0.8 3.6 0.8 5.5 0 1.8-0.3 3.6-0.8 5.4l70.5 40.7c3.5-4.5 8.8-7.1 14.6-7.1 5.7 0 11 2.6 14.7 7.1zm84.4-28c-3.4-0.9-6.4-2.7-8.8-5.2l-71.9 41.5c0.2 1.1 0.3 2.3 0.3 3.4 0 8.5-5.9 16.1-14.2 18.1v85.9c3.2 0.8 6.2 2.4 8.6 4.8l72.8-42c-0.5-1.7-0.8-3.6-0.8-5.4 0-8.4 5.9-16 14-18.1z" />
				</g>
			</g>
		</g>
	</g>
</svg>
    </a>
  
    
    
      
      
    
    <a href="https://support.djneuro.io/portal/en/home" target="_blank" rel="noopener" title="support.djneuro.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M64 64C28.7 64 0 92.7 0 128v80c26.5 0 48 21.5 48 48s-21.5 48-48 48v80c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64v-80c-26.5 0-48-21.5-48-48s21.5-48 48-48v-80c0-35.3-28.7-64-64-64H64zm64 96v192h320V160H128zm-32 0c0-17.7 14.3-32 32-32h320c17.7 0 32 14.3 32 32v192c0 17.7-14.3 32-32 32H128c-17.7 0-32-14.3-32-32V160z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://datajoint.slack.com" target="_blank" rel="noopener" title="datajoint.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/company/datajoint" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/DataJointIO" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/datajoint" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://hub.docker.com/u/datajoint" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://pypi.org/user/datajointbot" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://stackoverflow.com/questions/tagged/datajoint" target="_blank" rel="noopener" title="stackoverflow.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCdeCuFOTCXlVMRzh6Wk-lGg" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>