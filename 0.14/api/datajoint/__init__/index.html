
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../changelog/">
      
      
        <link rel="next" href="../admin/">
      
      
      <link rel="icon" href="../../../assets/images/company-logo-blue.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>__init__.py - DataJoint Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Slab";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datajoint" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DataJoint Documentation" class="md-header__button md-logo" aria-label="DataJoint Documentation" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DataJoint Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              __init__.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!-- Reference from: https://github.com/squidfunk/mkdocs-material/blob/master/src/templates/partials/nav.html -->



<!-- Determine classes -->



  


<!-- Navigation -->
<nav
  class="md-nav md-nav--primary md-nav--integrated"
  aria-label="Navigation"
  data-md-level="0"
>

  <!-- Site title -->
  <label class="md-nav__title" for="__drawer">
    <a
      href="../../.."
      title="DataJoint Documentation"
      class="md-nav__button md-logo"
      aria-label="DataJoint Documentation"
      data-md-component="logo"
    >
      
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

    </a>
    <!-- Add DataJoint home link to navigation header, otherwise unchanged -->
    <!-- DataJoint Documentation -->
    <a href="https://docs.datajoint.com" title="DataJoint">
      â¬… Home
    </a>
  </label>

  <!-- Repository information -->
  
    <div class="md-nav__source">
      <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
    </div>
  

  <!-- Navigation list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DataJoint Python
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/data-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/data-pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/teamwork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teamwork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/terminology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    System Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            System Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sysadmin/database-admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Administration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sysadmin/bulk-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bulk Storage Systems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sysadmin/external-store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Client Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Client Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/stores.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Stores
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Schema Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Schema Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Creation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Table Definition
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Table Definition
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/tiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Table Tiers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/declare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Declaration Syntax
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/primary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Primary Key
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/attributes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attributes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/lookup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lookup Tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/manual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manual Tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/blobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/attach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attachments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/filepath/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filepaths
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/customtype/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Datatypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/indexes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Indexes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/master-part/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Master-Part Relationships
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/normalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entity Normalization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/integrity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Integrity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/recall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Recall
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/drop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Drop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/alter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Modification
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../manipulation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Data Manipulations
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Data Manipulations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/insert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Insert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/delete/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Delete
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/transactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transactions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Queries
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Data Queries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/example-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/fetch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fetch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/iteration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iteration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/restrict/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restrict
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/join/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Join
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aggregation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/union/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Union
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/universals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Universal Sets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/query-caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Caching
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Computations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Computations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/make/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Make Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/populate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Populate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/key-source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Key Source
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/distributed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Computing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../publish-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publish Data
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Internals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Internals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internal/transpilation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQL Transpilation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the json type
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../develop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../citation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" checked>
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17_1" checked>
        
          
          <label class="md-nav__link" for="__nav_17_1" id="__nav_17_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    datajoint
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_17_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_17_1">
            <span class="md-nav__icon md-icon"></span>
            datajoint
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    __init__.py
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    __init__.py
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datajoint" class="md-nav__link">
    <span class="md-ellipsis">
      datajoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.kill" class="md-nav__link">
    <span class="md-ellipsis">
      kill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.AttributeAdapter" class="md-nav__link">
    <span class="md-ellipsis">
      AttributeAdapter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AttributeAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.AttributeAdapter.attribute_type" class="md-nav__link">
    <span class="md-ellipsis">
      attribute_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.AttributeAdapter.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.AttributeAdapter.put" class="md-nav__link">
    <span class="md-ellipsis">
      put
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.MatCell" class="md-nav__link">
    <span class="md-ellipsis">
      MatCell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.MatStruct" class="md-nav__link">
    <span class="md-ellipsis">
      MatStruct
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Connection" class="md-nav__link">
    <span class="md-ellipsis">
      Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.set_query_cache" class="md-nav__link">
    <span class="md-ellipsis">
      set_query_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.purge_query_cache" class="md-nav__link">
    <span class="md-ellipsis">
      purge_query_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.ping" class="md-nav__link">
    <span class="md-ellipsis">
      ping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.is_connected" class="md-nav__link">
    <span class="md-ellipsis">
      is_connected
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.get_user" class="md-nav__link">
    <span class="md-ellipsis">
      get_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.in_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      in_transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.start_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      start_transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.cancel_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.commit_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      commit_transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Connection.transaction" class="md-nav__link">
    <span class="md-ellipsis">
      transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.conn" class="md-nav__link">
    <span class="md-ellipsis">
      conn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagram">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.Diagram.from_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      from_sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Diagram.add_parts" class="md-nav__link">
    <span class="md-ellipsis">
      add_parts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Diagram.topo_sort" class="md-nav__link">
    <span class="md-ellipsis">
      topo_sort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.DataJointError" class="md-nav__link">
    <span class="md-ellipsis">
      DataJointError
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataJointError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.DataJointError.suggest" class="md-nav__link">
    <span class="md-ellipsis">
      suggest
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.AndList" class="md-nav__link">
    <span class="md-ellipsis">
      AndList
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Not" class="md-nav__link">
    <span class="md-ellipsis">
      Not
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Top" class="md-nav__link">
    <span class="md-ellipsis">
      Top
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.U" class="md-nav__link">
    <span class="md-ellipsis">
      U
    </span>
  </a>
  
    <nav class="md-nav" aria-label="U">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.U.join" class="md-nav__link">
    <span class="md-ellipsis">
      join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.U.aggr" class="md-nav__link">
    <span class="md-ellipsis">
      aggr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.key" class="md-nav__link">
    <span class="md-ellipsis">
      key
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.key_hash" class="md-nav__link">
    <span class="md-ellipsis">
      key_hash
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Schema" class="md-nav__link">
    <span class="md-ellipsis">
      Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.activate" class="md-nav__link">
    <span class="md-ellipsis">
      activate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.size_on_disk" class="md-nav__link">
    <span class="md-ellipsis">
      size_on_disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.spawn_missing_classes" class="md-nav__link">
    <span class="md-ellipsis">
      spawn_missing_classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.drop" class="md-nav__link">
    <span class="md-ellipsis">
      drop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.jobs" class="md-nav__link">
    <span class="md-ellipsis">
      jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Schema.list_tables" class="md-nav__link">
    <span class="md-ellipsis">
      list_tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.VirtualModule" class="md-nav__link">
    <span class="md-ellipsis">
      VirtualModule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.list_schemas" class="md-nav__link">
    <span class="md-ellipsis">
      list_schemas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.FreeTable" class="md-nav__link">
    <span class="md-ellipsis">
      FreeTable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Table" class="md-nav__link">
    <span class="md-ellipsis">
      Table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.declare" class="md-nav__link">
    <span class="md-ellipsis">
      declare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.alter" class="md-nav__link">
    <span class="md-ellipsis">
      alter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.from_clause" class="md-nav__link">
    <span class="md-ellipsis">
      from_clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.get_select_fields" class="md-nav__link">
    <span class="md-ellipsis">
      get_select_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.parents" class="md-nav__link">
    <span class="md-ellipsis">
      parents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.children" class="md-nav__link">
    <span class="md-ellipsis">
      children
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.descendants" class="md-nav__link">
    <span class="md-ellipsis">
      descendants
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.ancestors" class="md-nav__link">
    <span class="md-ellipsis">
      ancestors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.parts" class="md-nav__link">
    <span class="md-ellipsis">
      parts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.is_declared" class="md-nav__link">
    <span class="md-ellipsis">
      is_declared
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.full_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      full_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.update1" class="md-nav__link">
    <span class="md-ellipsis">
      update1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.insert1" class="md-nav__link">
    <span class="md-ellipsis">
      insert1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.insert" class="md-nav__link">
    <span class="md-ellipsis">
      insert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.delete_quick" class="md-nav__link">
    <span class="md-ellipsis">
      delete_quick
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.drop_quick" class="md-nav__link">
    <span class="md-ellipsis">
      drop_quick
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.drop" class="md-nav__link">
    <span class="md-ellipsis">
      drop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.size_on_disk" class="md-nav__link">
    <span class="md-ellipsis">
      size_on_disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Table.describe" class="md-nav__link">
    <span class="md-ellipsis">
      describe
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Computed" class="md-nav__link">
    <span class="md-ellipsis">
      Computed
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Imported" class="md-nav__link">
    <span class="md-ellipsis">
      Imported
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Lookup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Manual" class="md-nav__link">
    <span class="md-ellipsis">
      Manual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.Part" class="md-nav__link">
    <span class="md-ellipsis">
      Part
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.Part.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.Part.drop" class="md-nav__link">
    <span class="md-ellipsis">
      drop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    admin.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../attribute_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    attribute_adapter.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../autopopulate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    autopopulate.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    blob.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cli.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../condition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    condition.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    connection.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../declare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    declare.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dependencies.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    diagram.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    errors.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    expression.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../external/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    external.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fetch.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    hash.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../heading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    heading.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    jobs.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    logging.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    plugin.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    preview.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    s3.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    schemas.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    settings.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    table.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user_tables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    user_tables.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils.py
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    version.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>__init__.py</h1>

<div class="doc doc-object doc-module">



<a id="datajoint"></a>
    <div class="doc doc-contents first">

        <p>DataJoint for Python is a framework for building data pipelines using MySQL databases
to represent pipeline structure and bulk storage systems for large objects.
DataJoint is built on the foundation of the relational data model and prescribes a
consistent method for organizing, populating, and querying data.</p>
<p>The DataJoint data model is described in <a href="https://arxiv.org/abs/1807.11104">https://arxiv.org/abs/1807.11104</a></p>
<p>DataJoint is free software under the LGPL License. In addition, we request
that any use of DataJoint leading to a publication be acknowledged in the publication.</p>
<p>Please cite:</p>
<p>- <a href="http://biorxiv.org/content/early/2015/11/14/031658">http://biorxiv.org/content/early/2015/11/14/031658</a>
  - <a href="http://dx.doi.org/10.1101/031658">http://dx.doi.org/10.1101/031658</a></p>









  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h2 id="datajoint.kill" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kill</span><span class="p">(</span><span class="n">restriction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.kill" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>view and kill database connections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>restriction</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>restriction to be applied to processlist</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connection</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a datajoint.Connection object. Default calls datajoint.conn()</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order_by</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>order by a single attribute or the list of attributes. defaults to 'id'.  Restrictions are specified as strings and can involve any of the attributes of information_schema.processlist: ID, USER, HOST, DB, COMMAND, TIME, STATE, INFO.  Examples: dj.kill('HOST LIKE "%compute%"') lists only connections from hosts containing "compute". dj.kill('TIME &gt; 600') lists only connections in their current state for more than 10 minutes</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/admin.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="n">restriction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    view and kill database connections.</span>

<span class="sd">    :param restriction: restriction to be applied to processlist</span>
<span class="sd">    :param connection: a datajoint.Connection object. Default calls datajoint.conn()</span>
<span class="sd">    :param order_by: order by a single attribute or the list of attributes. defaults to &#39;id&#39;.</span>

<span class="sd">    Restrictions are specified as strings and can involve any of the attributes of</span>
<span class="sd">    information_schema.processlist: ID, USER, HOST, DB, COMMAND, TIME, STATE, INFO.</span>

<span class="sd">    Examples:</span>
<span class="sd">        dj.kill(&#39;HOST LIKE &quot;%compute%&quot;&#39;) lists only connections from hosts containing &quot;compute&quot;.</span>
<span class="sd">        dj.kill(&#39;TIME &gt; 600&#39;) lists only connections in their current state for more than 10 minutes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">conn</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;SELECT * FROM information_schema.processlist WHERE id &lt;&gt; CONNECTION_ID()&quot;</span>
        <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">restriction</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot; AND (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">restriction</span><span class="p">)</span>
        <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; ORDER BY </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">order_by</span> <span class="ow">or</span> <span class="s2">&quot;id&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ID USER         HOST          STATE         TIME    INFO&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;+--+ +----------+ +-----------+ +-----------+ +-----+&quot;</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{id:&gt;4d}</span><span class="s2"> </span><span class="si">{user:&lt;12s}</span><span class="s2"> </span><span class="si">{host:&lt;12s}</span><span class="s2"> </span><span class="si">{state:&lt;12s}</span><span class="s2"> </span><span class="si">{time:&gt;7d}</span><span class="s2">  </span><span class="si">{info}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="o">**</span><span class="n">process</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;process to kill or &quot;q&quot; to quit &gt; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># ignore non-numeric input</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;kill </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pid</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">InternalError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Process not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.AttributeAdapter" class="doc doc-heading">
            <code>AttributeAdapter</code>


<a href="#datajoint.AttributeAdapter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Base class for adapter objects for user-defined attribute types.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/attribute_adapter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AttributeAdapter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for adapter objects for user-defined attribute types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attribute_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: a supported DataJoint attribute type to use; e.g. &quot;longblob&quot;, &quot;blob@store&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Undefined attribute adapter&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert value retrieved from the the attribute in a table into the adapted type</span>

<span class="sd">        :param value: value from the database</span>

<span class="sd">        :return: object of the adapted type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Undefined attribute adapter&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert an object of the adapted type into a value that DataJoint can store in a table attribute</span>

<span class="sd">        :param obj: an object of the adapted type</span>
<span class="sd">        :return: value to store in the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Undefined attribute adapter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="datajoint.AttributeAdapter.attribute_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attribute_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.AttributeAdapter.attribute_type" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a supported DataJoint attribute type to use; e.g. "longblob", "blob@store"</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.AttributeAdapter.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#datajoint.AttributeAdapter.get" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>convert value retrieved from the the attribute in a table into the adapted type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value from the database</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object of the adapted type</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/attribute_adapter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert value retrieved from the the attribute in a table into the adapted type</span>

<span class="sd">    :param value: value from the database</span>

<span class="sd">    :return: object of the adapted type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Undefined attribute adapter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.AttributeAdapter.put" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">put</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

<a href="#datajoint.AttributeAdapter.put" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>convert an object of the adapted type into a value that DataJoint can store in a table attribute</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an object of the adapted type</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to store in the database</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/attribute_adapter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert an object of the adapted type into a value that DataJoint can store in a table attribute</span>

<span class="sd">    :param obj: an object of the adapted type</span>
<span class="sd">    :return: value to store in the database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Undefined attribute adapter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.MatCell" class="doc doc-heading">
            <code>MatCell</code>


<a href="#datajoint.MatCell" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="numpy.ndarray">ndarray</span></code></p>


        <p>a numpy ndarray representing a Matlab cell array</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/blob.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MatCell</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a numpy ndarray representing a Matlab cell array&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.MatStruct" class="doc doc-heading">
            <code>MatStruct</code>


<a href="#datajoint.MatStruct" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="numpy.recarray">recarray</span></code></p>


        <p>numpy.recarray representing a Matlab struct array</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/blob.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MatStruct</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">recarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;numpy.recarray representing a Matlab struct array&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Connection" class="doc doc-heading">
            <code>Connection</code>


<a href="#datajoint.Connection" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A dj.Connection object manages a connection to a database server.
It also catalogues modules, schemas, tables, and their dependencies (foreign keys).</p>
<p>Most of the parameters below should be set in the local configuration file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>host</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>host name, may include port number as hostname:port, in which case it overrides the value in port</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>user name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>password</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>password</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>port</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>port number</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_fun</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>connection initialization function (SQL)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_tls</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TLS encryption option</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>datajoint/connection.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Connection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dj.Connection object manages a connection to a database server.</span>
<span class="sd">    It also catalogues modules, schemas, tables, and their dependencies (foreign keys).</span>

<span class="sd">    Most of the parameters below should be set in the local configuration file.</span>

<span class="sd">    :param host: host name, may include port number as hostname:port, in which case it overrides the value in port</span>
<span class="sd">    :param user: user name</span>
<span class="sd">    :param password: password</span>
<span class="sd">    :param port: port number</span>
<span class="sd">    :param init_fun: connection initialization function (SQL)</span>
<span class="sd">    :param use_tls: TLS encryption option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_fun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_tls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">host_input</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">get_host_hook</span><span class="p">(</span><span class="n">host</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">host</span><span class="p">:</span>
            <span class="c1"># the port in the hostname overrides the port argument</span>
            <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.port&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_tls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">use_tls</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_tls</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;ssl&quot;</span><span class="p">:</span> <span class="p">{}}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">use_tls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">[</span><span class="s2">&quot;host_input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host_input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_fun</span> <span class="o">=</span> <span class="n">init_fun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">connect_host_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;DataJoint </span><span class="si">{version}</span><span class="s2"> connected to </span><span class="si">{user}</span><span class="s2">@</span><span class="si">{host}</span><span class="s2">:</span><span class="si">{port}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT connection_id()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">(</span>
                <span class="s2">&quot;Connection failed </span><span class="si">{user}</span><span class="s2">@</span><span class="si">{host}</span><span class="s2">:</span><span class="si">{port}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="n">Dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">conn_info</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="s2">&quot;connected&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="k">else</span> <span class="s2">&quot;disconnected&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;DataJoint connection (</span><span class="si">{connected}</span><span class="s2">) </span><span class="si">{user}</span><span class="s2">@</span><span class="si">{host}</span><span class="s2">:</span><span class="si">{port}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">connected</span><span class="o">=</span><span class="n">connected</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to the database server.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;.*deprecated.*&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="n">init_command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_fun</span><span class="p">,</span>
                    <span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,&quot;</span>
                    <span class="s2">&quot;STRICT_ALL_TABLES,NO_ENGINE_SUBSTITUTION,ONLY_FULL_GROUP_BY&quot;</span><span class="p">,</span>
                    <span class="n">charset</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;connection.charset&quot;</span><span class="p">],</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">,</span> <span class="s2">&quot;host_input&quot;</span><span class="p">]</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">InternalError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="n">init_command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_fun</span><span class="p">,</span>
                    <span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,&quot;</span>
                    <span class="s2">&quot;STRICT_ALL_TABLES,NO_ENGINE_SUBSTITUTION,ONLY_FULL_GROUP_BY&quot;</span><span class="p">,</span>
                    <span class="n">charset</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;connection.charset&quot;</span><span class="p">],</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                            <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">,</span> <span class="s2">&quot;host_input&quot;</span><span class="p">]</span>
                            <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;ssl&quot;</span>
                            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">autocommit</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_query_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When query_cache is not None, the connection switches into the query caching mode, which entails:</span>
<span class="sd">        1. Only SELECT queries are allowed.</span>
<span class="sd">        2. The results of queries are cached under the path indicated by dj.config[&#39;query_cache&#39;]</span>
<span class="sd">        3. query_cache is a string that differentiates different cache states.</span>

<span class="sd">        :param query_cache: a string to initialize the hash for query results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span> <span class="o">=</span> <span class="n">query_cache</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">purge_query_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Purges all query cache.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema</span><span class="o">.</span><span class="n">database</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ping the connection or raises an exception if the connection is closed.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">reconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return true if the object is connected to the database server.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">suppress_warnings</span><span class="p">:</span>
                    <span class="c1"># suppress all warnings arising from underlying SQL library</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">translate_query_error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="o">*</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the specified query and return the tuple generator (cursor).</span>

<span class="sd">        :param query: SQL query</span>
<span class="sd">        :param args: additional arguments for the client.cursor</span>
<span class="sd">        :param as_dict: If as_dict is set to True, the returned cursor objects returns</span>
<span class="sd">                        query results as dictionary.</span>
<span class="sd">        :param suppress_warnings: If True, suppress all warnings arising from underlying query library</span>
<span class="sd">        :param reconnect: when None, get from config, when True, attempt to reconnect if disconnected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check cache first:</span>
        <span class="n">use_query_cache</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_query_cache</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*(SELECT|SHOW)&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Only SELECT queries are allowed when query caching is on.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">use_query_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provide filepath dj.config[&#39;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">&#39;] when using query caching.&quot;</span>
                <span class="p">)</span>
            <span class="n">hash_</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span><span class="p">)</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;`\$\w+`&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
                <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cache_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">hash_</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">buffer</span> <span class="o">=</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># proceed to query the database</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">EmulatedCursor</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">reconnect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reconnect</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.reconnect&quot;</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing SQL:&quot;</span> <span class="o">+</span> <span class="n">query</span><span class="p">[:</span><span class="n">query_log_max_length</span><span class="p">])</span>
        <span class="n">cursor_class</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">Cursor</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reconnect</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Reconnecting to MySQL server.&quot;</span><span class="p">)</span>
            <span class="n">connect_host_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">(</span>
                    <span class="s2">&quot;Connection was lost during a transaction.&quot;</span>
                <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Re-executing&quot;</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_query_cache</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">cache_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">EmulatedCursor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cursor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the user name and host name provided by the client to the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT user()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># ---------- transaction processing</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">in_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if there is an open transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts a transaction error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Nested connections are not supported.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;START TRANSACTION WITH CONSISTENT SNAPSHOT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction started&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancels the current transaction and rolls back all changes made during the transaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ROLLBACK&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction cancelled. Rolling back ...&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">commit_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commit all changes made during the transaction and close it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COMMIT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction committed and closed.&quot;</span><span class="p">)</span>

    <span class="c1"># -------- context manager for transactions</span>
    <span class="nd">@property</span>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager for transactions. Opens an transaction and closes it after the with statement.</span>
<span class="sd">        If an error is caught during the transaction, the commits are automatically rolled back.</span>
<span class="sd">        All errors are raised again.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; import datajoint as dj</span>
<span class="sd">        &gt;&gt;&gt; with dj.conn().transaction as conn:</span>
<span class="sd">        &gt;&gt;&gt;     # transaction is open here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commit_transaction</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#datajoint.Connection.connect" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Connect to the database server.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connect to the database server.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;.*deprecated.*&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">init_command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_fun</span><span class="p">,</span>
                <span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,&quot;</span>
                <span class="s2">&quot;STRICT_ALL_TABLES,NO_ENGINE_SUBSTITUTION,ONLY_FULL_GROUP_BY&quot;</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;connection.charset&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">,</span> <span class="s2">&quot;host_input&quot;</span><span class="p">]</span>
                <span class="p">},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">err</span><span class="o">.</span><span class="n">InternalError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">init_command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_fun</span><span class="p">,</span>
                <span class="n">sql_mode</span><span class="o">=</span><span class="s2">&quot;NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,&quot;</span>
                <span class="s2">&quot;STRICT_ALL_TABLES,NO_ENGINE_SUBSTITUTION,ONLY_FULL_GROUP_BY&quot;</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;connection.charset&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                        <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">,</span> <span class="s2">&quot;host_input&quot;</span><span class="p">]</span>
                        <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;ssl&quot;</span>
                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn_info</span><span class="p">[</span><span class="s2">&quot;ssl_input&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="p">)</span>
                <span class="p">},</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">autocommit</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.set_query_cache" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_query_cache</span><span class="p">(</span><span class="n">query_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Connection.set_query_cache" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>When query_cache is not None, the connection switches into the query caching mode, which entails:
1. Only SELECT queries are allowed.
2. The results of queries are cached under the path indicated by dj.config['query_cache']
3. query_cache is a string that differentiates different cache states.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query_cache</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a string to initialize the hash for query results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_query_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When query_cache is not None, the connection switches into the query caching mode, which entails:</span>
<span class="sd">    1. Only SELECT queries are allowed.</span>
<span class="sd">    2. The results of queries are cached under the path indicated by dj.config[&#39;query_cache&#39;]</span>
<span class="sd">    3. query_cache is a string that differentiates different cache states.</span>

<span class="sd">    :param query_cache: a string to initialize the hash for query results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span> <span class="o">=</span> <span class="n">query_cache</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.purge_query_cache" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">purge_query_cache</span><span class="p">()</span></code>

<a href="#datajoint.Connection.purge_query_cache" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Purges all query cache.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">purge_query_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Purges all query cache.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.ping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ping</span><span class="p">()</span></code>

<a href="#datajoint.Connection.ping" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Ping the connection or raises an exception if the connection is closed.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ping the connection or raises an exception if the connection is closed.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">ping</span><span class="p">(</span><span class="n">reconnect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Connection.is_connected" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_connected</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Connection.is_connected" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return true if the object is connected to the database server.</p>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="o">*</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Connection.query" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Execute the specified query and return the tuple generator (cursor).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional arguments for the client.cursor</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If as_dict is set to True, the returned cursor objects returns query results as dictionary.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppress all warnings arising from underlying query library</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reconnect</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when None, get from config, when True, attempt to reconnect if disconnected</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="o">*</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reconnect</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the specified query and return the tuple generator (cursor).</span>

<span class="sd">    :param query: SQL query</span>
<span class="sd">    :param args: additional arguments for the client.cursor</span>
<span class="sd">    :param as_dict: If as_dict is set to True, the returned cursor objects returns</span>
<span class="sd">                    query results as dictionary.</span>
<span class="sd">    :param suppress_warnings: If True, suppress all warnings arising from underlying query library</span>
<span class="sd">    :param reconnect: when None, get from config, when True, attempt to reconnect if disconnected</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check cache first:</span>
    <span class="n">use_query_cache</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_query_cache</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*(SELECT|SHOW)&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Only SELECT queries are allowed when query caching is on.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">use_query_cache</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provide filepath dj.config[&#39;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">&#39;] when using query caching.&quot;</span>
            <span class="p">)</span>
        <span class="n">hash_</span> <span class="o">=</span> <span class="n">uuid_from_buffer</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_cache</span><span class="p">)</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;`\$\w+`&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
            <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">cache_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">cache_key</span><span class="p">])</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">hash_</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># proceed to query the database</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EmulatedCursor</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">reconnect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reconnect</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.reconnect&quot;</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing SQL:&quot;</span> <span class="o">+</span> <span class="n">query</span><span class="p">[:</span><span class="n">query_log_max_length</span><span class="p">])</span>
    <span class="n">cursor_class</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span> <span class="k">if</span> <span class="n">as_dict</span> <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">Cursor</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reconnect</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Reconnecting to MySQL server.&quot;</span><span class="p">)</span>
        <span class="n">connect_host_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">LostConnectionError</span><span class="p">(</span>
                <span class="s2">&quot;Connection was lost during a transaction.&quot;</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Re-executing&quot;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor_class</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_query_cache</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">cache_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">EmulatedCursor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cursor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.get_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_user</span><span class="p">()</span></code>

<a href="#datajoint.Connection.get_user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the user name and host name provided by the client to the server.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the user name and host name provided by the client to the server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT user()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Connection.in_transaction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">in_transaction</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Connection.in_transaction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if there is an open transaction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.start_transaction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start_transaction</span><span class="p">()</span></code>

<a href="#datajoint.Connection.start_transaction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Starts a transaction error.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts a transaction error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Nested connections are not supported.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;START TRANSACTION WITH CONSISTENT SNAPSHOT&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction started&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.cancel_transaction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cancel_transaction</span><span class="p">()</span></code>

<a href="#datajoint.Connection.cancel_transaction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Cancels the current transaction and rolls back all changes made during the transaction.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cancel_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cancels the current transaction and rolls back all changes made during the transaction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ROLLBACK&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction cancelled. Rolling back ...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Connection.commit_transaction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">commit_transaction</span><span class="p">()</span></code>

<a href="#datajoint.Connection.commit_transaction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Commit all changes made during the transaction and close it.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">commit_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Commit all changes made during the transaction and close it.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COMMIT&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_in_transaction</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction committed and closed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Connection.transaction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transaction</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Connection.transaction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Context manager for transactions. Opens an transaction and closes it after the with statement.
If an error is caught during the transaction, the commits are automatically rolled back.
All errors are raised again.</p>
<p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>import datajoint as dj
with dj.conn().transaction as conn:
    # transaction is open here</p>
</blockquote>
</blockquote>
</blockquote>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-function">


<h2 id="datajoint.conn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conn</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">init_fun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_tls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.conn" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Returns a persistent connection object to be shared by multiple modules.
If the connection is not yet established or reset=True, a new connection is set up.
If connection information is not provided, it is taken from config which takes the
information from dj_local_conf.json. If the password is not specified in that file
datajoint prompts for the password.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>host</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hostname</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mysql user</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>password</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mysql password</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_fun</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initialization function</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reset</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the connection should be reset or not</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_tls</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TLS encryption option. Valid options are: True (required), False (required no TLS), None (TLS preferred, default), dict (Manually specify values per <a href="https://dev.mysql.com/doc/refman/5.7/en/connection-options.html#encrypted-connection-options">https://dev.mysql.com/doc/refman/5.7/en/connection-options.html#encrypted-connection-options</a>).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/connection.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">conn</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">init_fun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_tls</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a persistent connection object to be shared by multiple modules.</span>
<span class="sd">    If the connection is not yet established or reset=True, a new connection is set up.</span>
<span class="sd">    If connection information is not provided, it is taken from config which takes the</span>
<span class="sd">    information from dj_local_conf.json. If the password is not specified in that file</span>
<span class="sd">    datajoint prompts for the password.</span>

<span class="sd">    :param host: hostname</span>
<span class="sd">    :param user: mysql user</span>
<span class="sd">    :param password: mysql password</span>
<span class="sd">    :param init_fun: initialization function</span>
<span class="sd">    :param reset: whether the connection should be reset or not</span>
<span class="sd">    :param use_tls: TLS encryption option. Valid options are: True (required), False</span>
<span class="sd">        (required no TLS), None (TLS preferred, default), dict (Manually specify values per</span>
<span class="sd">        https://dev.mysql.com/doc/refman/5.7/en/connection-options.html#encrypted-connection-options).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s2">&quot;connection&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">reset</span><span class="p">:</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="k">if</span> <span class="n">host</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.host&quot;</span><span class="p">]</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user</span> <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.user&quot;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">password</span> <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.password&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please enter DataJoint username: &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;Please enter DataJoint password: &quot;</span><span class="p">)</span>
        <span class="n">init_fun</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">init_fun</span> <span class="k">if</span> <span class="n">init_fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;connection.init_function&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">use_tls</span> <span class="o">=</span> <span class="n">use_tls</span> <span class="k">if</span> <span class="n">use_tls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;database.use_tls&quot;</span><span class="p">]</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">init_fun</span><span class="p">,</span> <span class="n">use_tls</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">connection</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Diagram" class="doc doc-heading">
            <code>Diagram</code>


<a href="#datajoint.Diagram" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="networkx.DiGraph">DiGraph</span></code></p>


        <p>Schema diagram showing tables and foreign keys between in the form of a directed
acyclic graph (DAG).  The diagram is derived from the connection.dependencies object.</p>
<p>Usage:</p>
<blockquote>
<blockquote>
<blockquote>
<p>diag = Diagram(source)</p>
</blockquote>
</blockquote>
</blockquote>
<p>source can be a table object, a table class, a schema, or a module that has a schema.</p>
<blockquote>
<blockquote>
<blockquote>
<p>diag.draw()</p>
</blockquote>
</blockquote>
</blockquote>
<p>draws the diagram using pyplot</p>
<p>diag1 + diag2  - combines the two diagrams.
diag1 - diag2  - difference between diagrams
diag1 * diag2  - intersection of diagrams
diag + n   - expands n levels of successors
diag - n   - expands n levels of predecessors
Thus dj.Diagram(schema.Table)+1-1 defines the diagram of immediate ancestors and descendants of schema.Table</p>
<p>Note that diagram + 1 - 1  may differ from diagram - 1 + 1 and so forth.
Only those tables that are loaded in the connection object are displayed</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/diagram.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Diagram</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schema diagram showing tables and foreign keys between in the form of a directed</span>
<span class="sd">    acyclic graph (DAG).  The diagram is derived from the connection.dependencies object.</span>

<span class="sd">    Usage:</span>

<span class="sd">    &gt;&gt;&gt;  diag = Diagram(source)</span>

<span class="sd">    source can be a table object, a table class, a schema, or a module that has a schema.</span>

<span class="sd">    &gt;&gt;&gt; diag.draw()</span>

<span class="sd">    draws the diagram using pyplot</span>

<span class="sd">    diag1 + diag2  - combines the two diagrams.</span>
<span class="sd">    diag1 - diag2  - difference between diagrams</span>
<span class="sd">    diag1 * diag2  - intersection of diagrams</span>
<span class="sd">    diag + n   - expands n levels of successors</span>
<span class="sd">    diag - n   - expands n levels of predecessors</span>
<span class="sd">    Thus dj.Diagram(schema.Table)+1-1 defines the diagram of immediate ancestors and descendants of schema.Table</span>

<span class="sd">    Note that diagram + 1 - 1  may differ from diagram - 1 + 1 and so forth.</span>
<span class="sd">    Only those tables that are loaded in the connection object are displayed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">Diagram</span><span class="p">):</span>
            <span class="c1"># copy constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">context</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># get the caller&#39;s context</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">frame</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>

        <span class="c1"># find connection in the source</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">connection</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">connection</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">connection</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Could not find database connection in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">)</span>

        <span class="c1"># initialize graph from dependencies</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>

        <span class="c1"># Enumerate nodes from all the items in the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">database</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">database</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">database</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">database</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot plot Diagram for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">database</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_sequence</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The join Diagram for all objects in sequence</span>

<span class="sd">        :param sequence: a sequence (e.g. list, tuple)</span>
<span class="sd">        :return: Diagram(arg1) + ... + Diagram(argn)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">Diagram</span><span class="p">,</span> <span class="n">sequence</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds to the diagram the part tables of all master tables already in the diagram</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_part</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param part:  `database`.`table_name`</span>
<span class="sd">            :param master:   `database`.`table_name`</span>
<span class="sd">            :return: True if part is part of master.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">part</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
            <span class="n">master</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">master</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">master</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="o">==</span> <span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span> <span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">n</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param arg: either another Diagram or a positive integer.</span>
<span class="sd">        :return: Union of the diagrams when arg is another Diagram</span>
<span class="sd">                 or an expansion downstream when arg is a positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="c1"># add nodes referenced by aliased nodes</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">new</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param arg: either another Diagram or a positive integer.</span>
<span class="sd">        :return: Difference of the diagrams when arg is another Diagram or</span>
<span class="sd">                 an expansion upstream when arg is a positive integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                    <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span>
                        <span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">new</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="c1"># add nodes referenced by aliased nodes</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span>
                            <span class="n">graph</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">new</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">())</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intersection of two diagrams</span>
<span class="sd">        :param arg: another Diagram</span>
<span class="sd">        :return: a new Diagram comprising nodes that are present in both operands.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">topo_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return nodes in lexicographical topological order&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">topo_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make the self.graph - a graph object ready for drawing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># mark &quot;distinguished&quot; tables, i.e. those that introduce new primary key</span>
        <span class="c1"># attributes</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">:</span>
            <span class="n">foreign_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">attr</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;primary&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;distinguished&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;primary_key&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">foreign_attributes</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;primary_key&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="c1"># include aliased nodes that are sandwiched between two displayed nodes</span>
        <span class="n">gaps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">node_boundary</span><span class="p">(</span>
                <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">gaps</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">)</span>
        <span class="c1"># construct subgraph and rename nodes to class names</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;node_type&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">_get_tier</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># relabel nodes to class names</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">lookup_class_name</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Some classes have identical names. The Diagram cannot be plotted.&quot;</span>
            <span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_encapsulate_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the `nx.Graph`&#39;s edge attribute `attr_map` to be a string representation</span>
<span class="sd">        of the attribute map, and encapsulates the string in double quotes.</span>
<span class="sd">        Changes the graph in place.</span>

<span class="sd">        Implements workaround described in</span>
<span class="sd">        https://github.com/pydot/pydot/issues/258#issuecomment-795798099</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">edgedata</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;attr_map&quot;</span> <span class="ow">in</span> <span class="n">edgedata</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">][</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edgedata</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_encapsulate_node_names</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the `nx.Graph`&#39;s node names string representations encapsulated in</span>
<span class="sd">        double quotes.</span>
<span class="sd">        Changes the graph in place.</span>

<span class="sd">        Implements workaround described in</span>
<span class="sd">        https://github.com/datajoint/datajoint-python/pull/1176</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span>
            <span class="n">graph</span><span class="p">,</span>
            <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()},</span>
            <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_graph</span><span class="p">()</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.2</span>  <span class="c1"># scaling factor for fonts and boxes</span>
        <span class="n">label_props</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># http://matplotlib.org/examples/color/named_colors.html</span>
            <span class="kc">None</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FFFF0040&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">8</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">_AliasNode</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FF880080&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;#FF880080&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Manual</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#00FF0030&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Lookup</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;plaintext&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#00000020&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">8</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Computed</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;ellipse&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#FF000020&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;#7F0000A0&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Imported</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;ellipse&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#00007F40&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;#00007FA0&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">Part</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;plaintext&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#0000000&quot;</span><span class="p">,</span>
                <span class="n">fontcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">8</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
                <span class="n">fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>
        <span class="n">node_props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">label_props</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;node_type&quot;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_encapsulate_node_names</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encapsulate_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_shape</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">node_props</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;fontsize&quot;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_fontcolor</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;fontcolor&quot;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_shape</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_fontname</span><span class="p">(</span><span class="s2">&quot;arial&quot;</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_fixedsize</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span> <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
                <span class="n">description</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span>
                        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
                        <span class="k">else</span> <span class="p">(</span>
                            <span class="n">q</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#8594;&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="ow">in</span> <span class="n">q</span>
                            <span class="k">else</span> <span class="n">q</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">description</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">set_tooltip</span><span class="p">(</span><span class="s2">&quot;&amp;#13;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">description</span><span class="p">))</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span>
                <span class="s2">&quot;&lt;&lt;u&gt;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/u&gt;&gt;&quot;</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;distinguished&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span>
                <span class="k">else</span> <span class="n">name</span>
            <span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">props</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;filled&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">dot</span><span class="o">.</span><span class="n">get_edges</span><span class="p">():</span>
            <span class="c1"># see https://graphviz.org/doc/info/attrs.html</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get_source</span><span class="p">()</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get_destination</span><span class="p">()</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Could not find edge with source &quot;</span>
                    <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; and destination &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">&quot;#00000040&quot;</span><span class="p">)</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;solid&quot;</span> <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s2">&quot;primary&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
            <span class="n">master_part</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dest</span><span class="p">][</span>
                <span class="s2">&quot;node_type&quot;</span>
            <span class="p">]</span> <span class="ow">is</span> <span class="n">Part</span> <span class="ow">and</span> <span class="n">dest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">src</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="mi">3</span> <span class="k">if</span> <span class="n">master_part</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">set_arrowhead</span><span class="p">(</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
            <span class="n">edge</span><span class="o">.</span><span class="n">set_penwidth</span><span class="p">(</span><span class="mf">0.75</span> <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="s2">&quot;multi&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dot</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_svg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVG</span>

        <span class="k">return</span> <span class="n">SVG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_dot</span><span class="p">()</span><span class="o">.</span><span class="n">create_svg</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_png</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_dot</span><span class="p">()</span><span class="o">.</span><span class="n">create_png</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_active</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_png</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;pyplot was not imported&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_svg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_svg</span><span class="p">()</span><span class="o">.</span><span class="n">_repr_svg_</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_active</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_image</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;pyplot was not imported&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">):</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>
            <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">):</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;svg&quot;</span>
        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_png</span><span class="p">()</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">()</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;svg&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_svg</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Unsupported file format&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pydot_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.Diagram.from_sequence" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#datajoint.Diagram.from_sequence" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>The join Diagram for all objects in sequence</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sequence</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a sequence (e.g. list, tuple)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Diagram(arg1) + ... + Diagram(argn)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/diagram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_sequence</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The join Diagram for all objects in sequence</span>

<span class="sd">    :param sequence: a sequence (e.g. list, tuple)</span>
<span class="sd">    :return: Diagram(arg1) + ... + Diagram(argn)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">Diagram</span><span class="p">,</span> <span class="n">sequence</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Diagram.add_parts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_parts</span><span class="p">()</span></code>

<a href="#datajoint.Diagram.add_parts" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adds to the diagram the part tables of all master tables already in the diagram</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/diagram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds to the diagram the part tables of all master tables already in the diagram</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_part</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param part:  `database`.`table_name`</span>
<span class="sd">        :param master:   `database`.`table_name`</span>
<span class="sd">        :return: True if part is part of master.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">part</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
        <span class="n">master</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">master</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="ow">and</span> <span class="n">master</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="o">==</span> <span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span> <span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="bp">self</span> <span class="o">=</span> <span class="n">Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># copy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">n</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_part</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_to_show</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Diagram.topo_sort" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">topo_sort</span><span class="p">()</span></code>

<a href="#datajoint.Diagram.topo_sort" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>return nodes in lexicographical topological order</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/diagram.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">topo_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return nodes in lexicographical topological order&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">topo_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.DataJointError" class="doc doc-heading">
            <code>DataJointError</code>


<a href="#datajoint.DataJointError" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base class for errors specific to DataJoint internal operation.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/errors.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DataJointError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for errors specific to DataJoint internal operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.plugin</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection_plugins</span><span class="p">,</span> <span class="n">type_plugins</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cause__</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">PluginWarning</span><span class="p">(</span><span class="s2">&quot;Unverified DataJoint plugin detected.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">any</span><span class="p">([</span><span class="ow">not</span> <span class="n">plugins</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;verified&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">plugins</span> <span class="ow">in</span> <span class="p">[</span><span class="n">connection_plugins</span><span class="p">,</span> <span class="n">type_plugins</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">plugins</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        regenerate the exception with additional arguments</span>

<span class="sd">        :param args: addition arguments</span>
<span class="sd">        :return: a new exception of the same type with the additional arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.DataJointError.suggest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">suggest</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#datajoint.DataJointError.suggest" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>regenerate the exception with additional arguments</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>addition arguments</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a new exception of the same type with the additional arguments</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/errors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    regenerate the exception with additional arguments</span>

<span class="sd">    :param args: addition arguments</span>
<span class="sd">    :return: a new exception of the same type with the additional arguments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.AndList" class="doc doc-heading">
            <code>AndList</code>


<a href="#datajoint.AndList" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="list">list</span></code></p>


        <p>A list of conditions to by applied to a query expression by logical conjunction: the
conditions are AND-ed. All other collections (lists, sets, other entity sets, etc) are
applied by logical disjunction (OR).</p>
<p>Example:
expr2 = expr &amp; dj.AndList((cond1, cond2, cond3))
is equivalent to
expr2 = expr &amp; cond1 &amp; cond2 &amp; cond3</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/condition.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AndList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list of conditions to by applied to a query expression by logical conjunction: the</span>
<span class="sd">    conditions are AND-ed. All other collections (lists, sets, other entity sets, etc) are</span>
<span class="sd">    applied by logical disjunction (OR).</span>

<span class="sd">    Example:</span>
<span class="sd">    expr2 = expr &amp; dj.AndList((cond1, cond2, cond3))</span>
<span class="sd">    is equivalent to</span>
<span class="sd">    expr2 = expr &amp; cond1 &amp; cond2 &amp; cond3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">restriction</span><span class="p">,</span> <span class="n">AndList</span><span class="p">):</span>
            <span class="c1"># extend to reduce nesting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Not" class="doc doc-heading">
            <code>Not</code>


<a href="#datajoint.Not" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>invert restriction</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/condition.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Not</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;invert restriction&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span> <span class="o">=</span> <span class="n">restriction</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Top" class="doc doc-heading">
            <code>Top</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#datajoint.Top" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A restriction to the top entities of a query.
In SQL, this corresponds to ORDER BY ... LIMIT ... OFFSET</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/condition.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Top</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A restriction to the top entities of a query.</span>
<span class="sd">    In SQL, this corresponds to ORDER BY ... LIMIT ... OFFSET</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">order_by</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;KEY&quot;</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;KEY&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Top limit must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Top order_by attributes must all be strings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The offset argument must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">999999999999</span>  <span class="c1"># arbitrary large number to allow query</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">order_by</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.U" class="doc doc-heading">
            <code>U</code>


<a href="#datajoint.U" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>dj.U objects are the universal sets representing all possible values of their attributes.
dj.U objects cannot be queried on their own but are useful for forming some queries.
dj.U('attr1', ..., 'attrn') represents the universal set with the primary key attributes attr1 ... attrn.
The universal set is the set of all possible combinations of values of the attributes.
Without any attributes, dj.U() represents the set with one element that has no attributes.</p>
<p>Restriction:</p>
<p>dj.U can be used to enumerate unique combinations of values of attributes from other expressions.</p>
<p>The following expression yields all unique combinations of contrast and brightness found in the <code>stimulus</code> set:</p>
<blockquote>
<blockquote>
<blockquote>
<p>dj.U('contrast', 'brightness') &amp; stimulus</p>
</blockquote>
</blockquote>
</blockquote>
<p>Aggregation:</p>
<p>In aggregation, dj.U is used for summary calculation over an entire set:</p>
<p>The following expression yields one element with one attribute <code>s</code> containing the total number of elements in
query expression <code>expr</code>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>dj.U().aggr(expr, n='count(*)')</p>
</blockquote>
</blockquote>
</blockquote>
<p>The following expressions both yield one element containing the number <code>n</code> of distinct values of attribute <code>attr</code> in
query expression <code>expr</code>.</p>
<blockquote>
<blockquote>
<blockquote>
<p>dj.U().aggr(expr, n='count(distinct attr)')
dj.U().aggr(dj.U('attr').aggr(expr), 'n=count(*)')</p>
</blockquote>
</blockquote>
</blockquote>
<p>The following expression yields one element and one attribute <code>s</code> containing the sum of values of attribute <code>attr</code>
over entire result set of expression <code>expr</code>:</p>
<blockquote>
<blockquote>
<blockquote>
<p>dj.U().aggr(expr, s='sum(attr)')</p>
</blockquote>
</blockquote>
</blockquote>
<p>The following expression yields the set of all unique combinations of attributes <code>attr1</code>, <code>attr2</code> and the number of
their occurrences in the result set of query expression <code>expr</code>.</p>
<blockquote>
<blockquote>
<blockquote>
<p>dj.U(attr1,attr2).aggr(expr, n='count(*)')</p>
</blockquote>
</blockquote>
</blockquote>
<p>Joins:</p>
<p>If expression <code>expr</code> has attributes 'attr1' and 'attr2', then expr * dj.U('attr1','attr2') yields the same result
as <code>expr</code> but <code>attr1</code> and <code>attr2</code> are promoted to the the primary key.  This is useful for producing a join on
non-primary key attributes.
For example, if <code>attr</code> is in both expr1 and expr2 but not in their primary keys, then expr1 * expr2 will throw
an error because in most cases, it does not make sense to join on non-primary key attributes and users must first
rename <code>attr</code> in one of the operands.  The expression dj.U('attr') * rel1 * rel2 overrides this constraint.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/expression.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">U</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dj.U objects are the universal sets representing all possible values of their attributes.</span>
<span class="sd">    dj.U objects cannot be queried on their own but are useful for forming some queries.</span>
<span class="sd">    dj.U(&#39;attr1&#39;, ..., &#39;attrn&#39;) represents the universal set with the primary key attributes attr1 ... attrn.</span>
<span class="sd">    The universal set is the set of all possible combinations of values of the attributes.</span>
<span class="sd">    Without any attributes, dj.U() represents the set with one element that has no attributes.</span>

<span class="sd">    Restriction:</span>

<span class="sd">    dj.U can be used to enumerate unique combinations of values of attributes from other expressions.</span>

<span class="sd">    The following expression yields all unique combinations of contrast and brightness found in the `stimulus` set:</span>

<span class="sd">    &gt;&gt;&gt; dj.U(&#39;contrast&#39;, &#39;brightness&#39;) &amp; stimulus</span>

<span class="sd">    Aggregation:</span>

<span class="sd">    In aggregation, dj.U is used for summary calculation over an entire set:</span>

<span class="sd">    The following expression yields one element with one attribute `s` containing the total number of elements in</span>
<span class="sd">    query expression `expr`:</span>

<span class="sd">    &gt;&gt;&gt; dj.U().aggr(expr, n=&#39;count(*)&#39;)</span>

<span class="sd">    The following expressions both yield one element containing the number `n` of distinct values of attribute `attr` in</span>
<span class="sd">    query expression `expr`.</span>

<span class="sd">    &gt;&gt;&gt; dj.U().aggr(expr, n=&#39;count(distinct attr)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; dj.U().aggr(dj.U(&#39;attr&#39;).aggr(expr), &#39;n=count(*)&#39;)</span>

<span class="sd">    The following expression yields one element and one attribute `s` containing the sum of values of attribute `attr`</span>
<span class="sd">    over entire result set of expression `expr`:</span>

<span class="sd">    &gt;&gt;&gt; dj.U().aggr(expr, s=&#39;sum(attr)&#39;)</span>

<span class="sd">    The following expression yields the set of all unique combinations of attributes `attr1`, `attr2` and the number of</span>
<span class="sd">    their occurrences in the result set of query expression `expr`.</span>

<span class="sd">    &gt;&gt;&gt; dj.U(attr1,attr2).aggr(expr, n=&#39;count(*)&#39;)</span>

<span class="sd">    Joins:</span>

<span class="sd">    If expression `expr` has attributes &#39;attr1&#39; and &#39;attr2&#39;, then expr * dj.U(&#39;attr1&#39;,&#39;attr2&#39;) yields the same result</span>
<span class="sd">    as `expr` but `attr1` and `attr2` are promoted to the the primary key.  This is useful for producing a join on</span>
<span class="sd">    non-primary key attributes.</span>
<span class="sd">    For example, if `attr` is in both expr1 and expr2 but not in their primary keys, then expr1 * expr2 will throw</span>
<span class="sd">    an error because in most cases, it does not make sense to join on non-primary key attributes and users must first</span>
<span class="sd">    rename `attr` in one of the operands.  The expression dj.U(&#39;attr&#39;) * rel1 * rel2 overrides this constraint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">primary_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primary_key</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Set U can only be restricted with a QueryExpression.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_distinct</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">set_primary_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Joining U with a query expression has the effect of promoting the attributes of U to</span>
<span class="sd">        the primary key of the other query expression.</span>

<span class="sd">        :param other: the other query expression to join with.</span>
<span class="sd">        :param left: ignored. dj.U always acts as if left=False</span>
<span class="sd">        :return: a copy of the other query expression with the primary key extended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Set U can only be joined with a QueryExpression.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">set_primary_key</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;shorthand for join&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">aggr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregation of the type U(&#39;attr1&#39;,&#39;attr2&#39;).aggr(group, computation=&quot;QueryExpression&quot;)</span>
<span class="sd">        has the primary key (&#39;attr1&#39;,&#39;attr2&#39;) and performs aggregation computations for all matching elements of `group`.</span>

<span class="sd">        :param group:  The query expression to be aggregated.</span>
<span class="sd">        :param named_attributes: computations of the form new_attribute=&quot;sql expression on attributes of group&quot;</span>
<span class="sd">        :return: The derived query expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_all_rows&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot set keep_all_rows=True when aggregating on a universal set.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Aggregation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
            <span class="o">**</span><span class="n">named_attributes</span>
        <span class="p">)</span>

    <span class="n">aggregate</span> <span class="o">=</span> <span class="n">aggr</span>  <span class="c1"># alias for aggr</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.U.join" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.U.join" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Joining U with a query expression has the effect of promoting the attributes of U to
the primary key of the other query expression.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the other query expression to join with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ignored. dj.U always acts as if left=False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a copy of the other query expression with the primary key extended.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/expression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Joining U with a query expression has the effect of promoting the attributes of U to</span>
<span class="sd">    the primary key of the other query expression.</span>

<span class="sd">    :param other: the other query expression to join with.</span>
<span class="sd">    :param left: ignored. dj.U always acts as if left=False</span>
<span class="sd">    :return: a copy of the other query expression with the primary key extended.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Set U can only be joined with a QueryExpression.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">set_primary_key</span><span class="p">(</span>
        <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.U.aggr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggr</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">)</span></code>

<a href="#datajoint.U.aggr" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Aggregation of the type U('attr1','attr2').aggr(group, computation="QueryExpression")
has the primary key ('attr1','attr2') and performs aggregation computations for all matching elements of <code>group</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>group</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query expression to be aggregated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>named_attributes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>computations of the form new_attribute="sql expression on attributes of group"</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The derived query expression</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/expression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">aggr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregation of the type U(&#39;attr1&#39;,&#39;attr2&#39;).aggr(group, computation=&quot;QueryExpression&quot;)</span>
<span class="sd">    has the primary key (&#39;attr1&#39;,&#39;attr2&#39;) and performs aggregation computations for all matching elements of `group`.</span>

<span class="sd">    :param group:  The query expression to be aggregated.</span>
<span class="sd">    :param named_attributes: computations of the form new_attribute=&quot;sql expression on attributes of group&quot;</span>
<span class="sd">    :return: The derived query expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_all_rows&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot set keep_all_rows=True when aggregating on a universal set.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">Aggregation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
        <span class="o">**</span><span class="n">named_attributes</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.key" class="doc doc-heading">
            <code>key</code>


<a href="#datajoint.key" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>object that allows requesting the primary key as an argument in expression.fetch()
The string "KEY" can be used instead of the class key</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/fetch.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">key</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    object that allows requesting the primary key as an argument in expression.fetch()</span>
<span class="sd">    The string &quot;KEY&quot; can be used instead of the class key</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>






<div class="doc doc-object doc-function">


<h2 id="datajoint.key_hash" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">key_hash</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></code>

<a href="#datajoint.key_hash" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>32-byte hash of the mapping's key values sorted by the key name.
This is often used to convert a long primary key value into a shorter hash.
For example, the JobTable in datajoint.jobs uses this function to hash the primary key of autopopulated tables.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/hash.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">key_hash</span><span class="p">(</span><span class="n">mapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    32-byte hash of the mapping&#39;s key values sorted by the key name.</span>
<span class="sd">    This is often used to convert a long primary key value into a shorter hash.</span>
<span class="sd">    For example, the JobTable in datajoint.jobs uses this function to hash the primary key of autopopulated tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hashed</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">hashed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">hashed</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Schema" class="doc doc-heading">
            <code>Schema</code>


<a href="#datajoint.Schema" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A schema object is a decorator for UserTable classes that binds them to their database.
It also specifies the namespace <code>context</code> in which other UserTable classes are defined.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/schemas.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Schema</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A schema object is a decorator for UserTable classes that binds them to their database.</span>
<span class="sd">    It also specifies the namespace `context` in which other UserTable classes are defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">create_schema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">create_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">add_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Associate database schema `schema_name`. If the schema does not exist, attempt to</span>
<span class="sd">        create it on the server.</span>

<span class="sd">        If the schema_name is omitted, then schema.activate(..) must be called later</span>
<span class="sd">        to associate with the database.</span>

<span class="sd">        :param schema_name: the database schema to associate.</span>
<span class="sd">        :param context: dictionary for looking up foreign key references, leave None to use local context.</span>
<span class="sd">        :param connection: Connection object. Defaults to datajoint.conn().</span>
<span class="sd">        :param create_schema: When False, do not create the schema and raise an error if missing.</span>
<span class="sd">        :param create_tables: When False, do not create tables and raise errors when accessing missing tables.</span>
<span class="sd">        :param add_objects: a mapping with additional objects to make available to the context in which table classes</span>
<span class="sd">        are declared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span> <span class="o">=</span> <span class="n">create_schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_tables</span> <span class="o">=</span> <span class="n">create_tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external</span> <span class="o">=</span> <span class="n">ExternalMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span> <span class="o">=</span> <span class="n">add_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">schema_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">activate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">create_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">create_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">add_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Associate database schema `schema_name`. If the schema does not exist, attempt to</span>
<span class="sd">        create it on the server.</span>

<span class="sd">        :param schema_name: the database schema to associate.</span>
<span class="sd">            schema_name=None is used to assert that the schema has already been activated.</span>
<span class="sd">        :param connection: Connection object. Defaults to datajoint.conn().</span>
<span class="sd">        :param create_schema: If False, do not create the schema and raise an error if missing.</span>
<span class="sd">        :param create_tables: If False, do not create tables and raise errors when attempting</span>
<span class="sd">            to access missing tables.</span>
<span class="sd">        :param add_objects: a mapping with additional objects to make available to the context</span>
<span class="sd">            in which table classes are declared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Please provide a schema_name to activate the schema.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">schema_name</span><span class="p">:</span>  <span class="c1"># already activated</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The schema is already activated for schema </span><span class="si">{db}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">conn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">schema_name</span>
        <span class="k">if</span> <span class="n">create_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span> <span class="o">=</span> <span class="n">create_schema</span>
        <span class="k">if</span> <span class="n">create_tables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_tables</span> <span class="o">=</span> <span class="n">create_tables</span>
        <span class="k">if</span> <span class="n">add_objects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span> <span class="o">=</span> <span class="n">add_objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Database `</span><span class="si">{name}</span><span class="s2">` has not yet been declared. &quot;</span>
                    <span class="s2">&quot;Set argument create_schema=True to create it.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">schema_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># create database</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating schema `</span><span class="si">{name}</span><span class="s2">`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="s2">&quot;CREATE DATABASE `</span><span class="si">{name}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Schema `</span><span class="si">{name}</span><span class="s2">` does not exist and could not be created. &quot;</span>
                    <span class="s2">&quot;Check permissions.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># decorate all tables already decorated</span>
        <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declare_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_master</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_assert_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="n">message</span>
                <span class="ow">or</span> <span class="s2">&quot;Schema `</span><span class="si">{db}</span><span class="s2">` has not been created.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Binds the supplied class to a schema. This is intended to be used as a decorator.</span>

<span class="sd">        :param cls: class to decorate.</span>
<span class="sd">        :param context: supplied when called from spawn_missing_classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_locals</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Part</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The schema decorator should not be applied to Part tables.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_activated</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_master</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declare_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_decorate_master</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param cls: the master class to process</span>
<span class="sd">        :param context: the class&#39; declaration context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_table</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="bp">cls</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="c1"># Process part tables</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">ordered_dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="n">part</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">Part</span><span class="p">):</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">_master</span> <span class="o">=</span> <span class="bp">cls</span>
                    <span class="c1"># allow addressing master by name or keyword &#39;master&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_table</span><span class="p">(</span>
                        <span class="n">part</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">context</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="bp">cls</span><span class="p">}</span>
                        <span class="p">),</span>
                    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_decorate_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_class</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">assert_declared</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assign schema properties to the table class and declare the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_class</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">table_class</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span>
        <span class="n">table_class</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">table_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">conn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="n">table_name</span><span class="o">=</span><span class="n">table_class</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">table_class</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_class</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">]</span>
        <span class="n">table_class</span><span class="o">.</span><span class="n">declaration_context</span> <span class="o">=</span> <span class="n">context</span>

        <span class="c1"># instantiate the class, declare the table if not already</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">table_class</span><span class="p">()</span>
        <span class="n">is_declared</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">is_declared</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_declared</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">assert_declared</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_tables</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">is_declared</span> <span class="o">=</span> <span class="n">is_declared</span> <span class="ow">or</span> <span class="n">instance</span><span class="o">.</span><span class="n">is_declared</span>

        <span class="c1"># add table definition to the doc string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_class</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">table_class</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">table_class</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table definition:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">table_class</span><span class="o">.</span><span class="n">definition</span>
            <span class="p">)</span>

        <span class="c1"># fill values in Lookup tables from their contents property</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">Lookup</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">is_declared</span>
        <span class="p">):</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">instance</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">has_autoincrement</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="s2">&quot;Contents has changed but cannot be inserted because &quot;</span>
                            <span class="s2">&quot;</span><span class="si">{table}</span><span class="s2"> has autoincrement.&quot;</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">instance</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">Log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Schema `</span><span class="si">{name}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">size_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: size of the entire schema in bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            SELECT SUM(data_length + index_length)</span>
<span class="sd">            FROM information_schema.tables WHERE table_schema=&#39;{db}&#39;</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">spawn_missing_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the appropriate python user table classes from tables in the schema and places them</span>
<span class="sd">        in the context.</span>

<span class="sd">        :param context: alternative context to place the missing classes into, e.g. locals()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if context is missing, use the calling namespace</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
                <span class="k">del</span> <span class="n">frame</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SHOW TABLES in `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lookup_class_name</span><span class="p">(</span>
                <span class="s2">&quot;`</span><span class="si">{db}</span><span class="s2">`.`</span><span class="si">{tab}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">context</span><span class="p">,</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="n">master_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">Lookup</span><span class="p">,</span> <span class="n">Manual</span><span class="p">,</span> <span class="n">Imported</span><span class="p">,</span> <span class="n">Computed</span><span class="p">)</span>
        <span class="n">part_tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">class_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="bp">cls</span>
                        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">master_classes</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">Part</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
                        <span class="n">part_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># declare and decorate master table classes</span>
                    <span class="n">context</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span>
                        <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">()),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span>
                    <span class="p">)</span>

        <span class="c1"># attach parts to masters</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">part_tables</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">Part</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="s2">&quot;part&quot;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">master_class</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="n">to_camel_case</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">])]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;The table </span><span class="si">%s</span><span class="s2"> does not follow DataJoint naming conventions&quot;</span>
                    <span class="o">%</span> <span class="n">table_name</span>
                <span class="p">)</span>
            <span class="n">part_class</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="n">Part</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">definition</span><span class="o">=...</span><span class="p">))</span>
            <span class="n">part_class</span><span class="o">.</span><span class="n">_master</span> <span class="o">=</span> <span class="n">master_class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_table</span><span class="p">(</span><span class="n">part_class</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">assert_declared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">master_class</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">part_class</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop the associated schema if it exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Schema named `</span><span class="si">{database}</span><span class="s2">` does not exist. Doing nothing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">force</span>
            <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span>
                <span class="s2">&quot;Proceed to delete entire schema `</span><span class="si">%s</span><span class="s2">`?&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
            <span class="p">)</span>
            <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dropping `</span><span class="si">{database}</span><span class="s2">`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="s2">&quot;DROP DATABASE `</span><span class="si">{database}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Schema `</span><span class="si">{database}</span><span class="s2">` was dropped successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AccessError</span><span class="p">(</span>
                    <span class="s2">&quot;An attempt to drop schema `</span><span class="si">{database}</span><span class="s2">` &quot;</span>
                    <span class="s2">&quot;has failed. Check permissions.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: true if the associated schema exists on the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Schema must be activated first.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;SELECT schema_name &quot;</span>
                <span class="s2">&quot;FROM information_schema.schemata &quot;</span>
                <span class="s2">&quot;WHERE schema_name = &#39;</span><span class="si">{database}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rowcount</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        schema.jobs provides a view of the job reservation table for the schema</span>

<span class="sd">        :return: jobs table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span> <span class="o">=</span> <span class="n">JobTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the code for a module that recreates the schema.</span>
<span class="sd">        This method is in preparation for a future release and is not officially supported.</span>

<span class="sd">        :return: a string containing the body of a complete Python module defining this schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
        <span class="n">module_count</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="c1"># add virtual modules for referenced modules with names vmod0, vmod1, ...</span>
        <span class="n">module_lookup</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;vmod&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">module_count</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">make_class_definition</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
            <span class="n">tier</span> <span class="o">=</span> <span class="n">_get_tier</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
                <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">indent</span> <span class="o">+=</span> <span class="s2">&quot;    &quot;</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">d</span><span class="p">,</span> <span class="n">tabs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">db</span> <span class="k">else</span> <span class="p">(</span><span class="n">module_lookup</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">to_camel_case</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="k">for</span> <span class="n">tab</span> <span class="ow">in</span> <span class="n">tabs</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&quot;Part&quot;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@schema</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{indent}</span><span class="s2">class </span><span class="si">{class_name}</span><span class="s2">(dj.</span><span class="si">{tier}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s1">&#39;</span><span class="si">{indent}</span><span class="s1">    definition = &quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{indent}</span><span class="s1">    </span><span class="si">{defi}</span><span class="s1">&quot;&quot;&quot;&#39;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
                <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
                <span class="n">defi</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;`([^`]+)`.`([^`]+)`&quot;</span><span class="p">,</span>
                    <span class="n">replace</span><span class="p">,</span>
                    <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">topo_sort</span><span class="p">()</span>
        <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">make_class_definition</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">)</span>
        <span class="n">python_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s1">&#39;&quot;&quot;&quot;This module was auto-generated by datajoint from an existing schema&quot;&quot;&quot;&#39;</span><span class="p">,</span>
                <span class="s2">&quot;import datajoint as dj</span><span class="se">\n\n</span><span class="s2">schema = dj.Schema(&#39;</span><span class="si">{db}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{module}</span><span class="s2"> = dj.VirtualModule(&#39;</span><span class="si">{module}</span><span class="s2">&#39;, &#39;</span><span class="si">{schema_name}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">module</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">schema_name</span><span class="o">=</span><span class="n">k</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">module_lookup</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">),</span>
                <span class="n">body</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">python_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">python_code</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">python_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">python_code</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of all tables in the schema except tables with ~ in first character such</span>
<span class="sd">        as ~logs and ~job</span>

<span class="sd">        :return: A list of table names from the database schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">t</span>
            <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">topo_sort</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.Schema.activate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">activate</span><span class="p">(</span><span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Schema.activate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Associate database schema <code>schema_name</code>. If the schema does not exist, attempt to
create it on the server.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the database schema to associate. schema_name=None is used to assert that the schema has already been activated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connection</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Connection object. Defaults to datajoint.conn().</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_schema</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False, do not create the schema and raise an error if missing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_tables</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False, do not create tables and raise errors when attempting to access missing tables.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a mapping with additional objects to make available to the context in which table classes are declared.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">activate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">schema_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">create_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">create_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">add_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Associate database schema `schema_name`. If the schema does not exist, attempt to</span>
<span class="sd">    create it on the server.</span>

<span class="sd">    :param schema_name: the database schema to associate.</span>
<span class="sd">        schema_name=None is used to assert that the schema has already been activated.</span>
<span class="sd">    :param connection: Connection object. Defaults to datajoint.conn().</span>
<span class="sd">    :param create_schema: If False, do not create the schema and raise an error if missing.</span>
<span class="sd">    :param create_tables: If False, do not create tables and raise errors when attempting</span>
<span class="sd">        to access missing tables.</span>
<span class="sd">    :param add_objects: a mapping with additional objects to make available to the context</span>
<span class="sd">        in which table classes are declared.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Please provide a schema_name to activate the schema.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">schema_name</span><span class="p">:</span>  <span class="c1"># already activated</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;The schema is already activated for schema </span><span class="si">{db}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">conn</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">schema_name</span>
    <span class="k">if</span> <span class="n">create_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span> <span class="o">=</span> <span class="n">create_schema</span>
    <span class="k">if</span> <span class="n">create_tables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_tables</span> <span class="o">=</span> <span class="n">create_tables</span>
    <span class="k">if</span> <span class="n">add_objects</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span> <span class="o">=</span> <span class="n">add_objects</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_schema</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Database `</span><span class="si">{name}</span><span class="s2">` has not yet been declared. &quot;</span>
                <span class="s2">&quot;Set argument create_schema=True to create it.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">schema_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># create database</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating schema `</span><span class="si">{name}</span><span class="s2">`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;CREATE DATABASE `</span><span class="si">{name}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Schema `</span><span class="si">{name}</span><span class="s2">` does not exist and could not be created. &quot;</span>
                <span class="s2">&quot;Check permissions.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># decorate all tables already decorated</span>
    <span class="k">for</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declare_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">add_objects</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_master</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Schema.size_on_disk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size_on_disk</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Schema.size_on_disk" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>size of the entire schema in bytes</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Schema.spawn_missing_classes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spawn_missing_classes</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Schema.spawn_missing_classes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates the appropriate python user table classes from tables in the schema and places them
in the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>alternative context to place the missing classes into, e.g. locals()</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">spawn_missing_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the appropriate python user table classes from tables in the schema and places them</span>
<span class="sd">    in the context.</span>

<span class="sd">    :param context: alternative context to place the missing classes into, e.g. locals()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if context is missing, use the calling namespace</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
            <span class="k">del</span> <span class="n">frame</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SHOW TABLES in `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lookup_class_name</span><span class="p">(</span>
            <span class="s2">&quot;`</span><span class="si">{db}</span><span class="s2">`.`</span><span class="si">{tab}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">context</span><span class="p">,</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="ow">is</span> <span class="kc">None</span>
    <span class="p">]</span>
    <span class="n">master_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">Lookup</span><span class="p">,</span> <span class="n">Manual</span><span class="p">,</span> <span class="n">Imported</span><span class="p">,</span> <span class="n">Computed</span><span class="p">)</span>
    <span class="n">part_tables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">class_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="bp">cls</span>
                    <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">master_classes</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">Part</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
                    <span class="n">part_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># declare and decorate master table classes</span>
                <span class="n">context</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">()),</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span>
                <span class="p">)</span>

    <span class="c1"># attach parts to masters</span>
    <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">part_tables</span><span class="p">:</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">Part</span><span class="o">.</span><span class="n">tier_regexp</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="s2">&quot;part&quot;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">master_class</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="n">to_camel_case</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">])]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The table </span><span class="si">%s</span><span class="s2"> does not follow DataJoint naming conventions&quot;</span>
                <span class="o">%</span> <span class="n">table_name</span>
            <span class="p">)</span>
        <span class="n">part_class</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="p">(</span><span class="n">Part</span><span class="p">,),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">definition</span><span class="o">=...</span><span class="p">))</span>
        <span class="n">part_class</span><span class="o">.</span><span class="n">_master</span> <span class="o">=</span> <span class="n">master_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decorate_table</span><span class="p">(</span><span class="n">part_class</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">assert_declared</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">master_class</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">part_class</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Schema.drop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Schema.drop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Drop the associated schema if it exists</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop the associated schema if it exists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Schema named `</span><span class="si">{database}</span><span class="s2">` does not exist. Doing nothing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span>
        <span class="ow">or</span> <span class="n">force</span>
        <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span>
            <span class="s2">&quot;Proceed to delete entire schema `</span><span class="si">%s</span><span class="s2">`?&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
        <span class="p">)</span>
        <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dropping `</span><span class="si">{database}</span><span class="s2">`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;DROP DATABASE `</span><span class="si">{database}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Schema `</span><span class="si">{database}</span><span class="s2">` was dropped successfully.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AccessError</span><span class="p">(</span>
                <span class="s2">&quot;An attempt to drop schema `</span><span class="si">{database}</span><span class="s2">` &quot;</span>
                <span class="s2">&quot;has failed. Check permissions.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Schema.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Schema.exists" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>true if the associated schema exists on the server</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Schema.jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">jobs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Schema.jobs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>schema.jobs provides a view of the job reservation table for the schema</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jobs table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Schema.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">python_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Schema.save" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate the code for a module that recreates the schema.
This method is in preparation for a future release and is not officially supported.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a string containing the body of a complete Python module defining this schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate the code for a module that recreates the schema.</span>
<span class="sd">    This method is in preparation for a future release and is not officially supported.</span>

<span class="sd">    :return: a string containing the body of a complete Python module defining this schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_exists</span><span class="p">()</span>
    <span class="n">module_count</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="c1"># add virtual modules for referenced modules with names vmod0, vmod1, ...</span>
    <span class="n">module_lookup</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;vmod&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">module_count</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_class_definition</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
        <span class="n">tier</span> <span class="o">=</span> <span class="n">_get_tier</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">indent</span> <span class="o">+=</span> <span class="s2">&quot;    &quot;</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">tabs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">db</span> <span class="k">else</span> <span class="p">(</span><span class="n">module_lookup</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">to_camel_case</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> <span class="k">for</span> <span class="n">tab</span> <span class="ow">in</span> <span class="n">tabs</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&quot;Part&quot;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">@schema</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{indent}</span><span class="s2">class </span><span class="si">{class_name}</span><span class="s2">(dj.</span><span class="si">{tier}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s1">&#39;</span><span class="si">{indent}</span><span class="s1">    definition = &quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="si">{indent}</span><span class="s1">    </span><span class="si">{defi}</span><span class="s1">&quot;&quot;&quot;&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">tier</span><span class="p">,</span>
            <span class="n">defi</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;`([^`]+)`.`([^`]+)`&quot;</span><span class="p">,</span>
                <span class="n">replace</span><span class="p">,</span>
                <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    &quot;</span> <span class="o">+</span> <span class="n">indent</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">topo_sort</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">make_class_definition</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">)</span>
    <span class="n">python_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="s1">&#39;&quot;&quot;&quot;This module was auto-generated by datajoint from an existing schema&quot;&quot;&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;import datajoint as dj</span><span class="se">\n\n</span><span class="s2">schema = dj.Schema(&#39;</span><span class="si">{db}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">),</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{module}</span><span class="s2"> = dj.VirtualModule(&#39;</span><span class="si">{module}</span><span class="s2">&#39;, &#39;</span><span class="si">{schema_name}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">schema_name</span><span class="o">=</span><span class="n">k</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">module_lookup</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">body</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">python_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">python_code</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">python_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">python_code</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Schema.list_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_tables</span><span class="p">()</span></code>

<a href="#datajoint.Schema.list_tables" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return a list of all tables in the schema except tables with ~ in first character such
as ~logs and ~job</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of table names from the database schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of all tables in the schema except tables with ~ in first character such</span>
<span class="sd">    as ~logs and ~job</span>

<span class="sd">    :return: A list of table names from the database schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">t</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">topo_sort</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.VirtualModule" class="doc doc-heading">
            <code>VirtualModule</code>


<a href="#datajoint.VirtualModule" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="types.ModuleType">ModuleType</span></code></p>


        <p>A virtual module imitates a Python module representing a DataJoint schema from table definitions in the database.
It declares the schema objects and a class for each table.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/schemas.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">VirtualModule</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A virtual module imitates a Python module representing a DataJoint schema from table definitions in the database.</span>
<span class="sd">    It declares the schema objects and a class for each table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">module_name</span><span class="p">,</span>
        <span class="n">schema_name</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">create_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">create_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">add_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a python module with the given name from the name of a schema on the server and</span>
<span class="sd">        automatically adds classes to it corresponding to the tables in the schema.</span>

<span class="sd">        :param module_name: displayed module name</span>
<span class="sd">        :param schema_name: name of the database in mysql</span>
<span class="sd">        :param create_schema: if True, create the schema on the database server</span>
<span class="sd">        :param create_tables: if True, module.schema can be used as the decorator for declaring new</span>
<span class="sd">        :param connection: a dj.Connection object to pass into the schema</span>
<span class="sd">        :param add_objects: additional objects to add to the module</span>
<span class="sd">        :return: the python module containing classes from the schema object and the table classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VirtualModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">module_name</span><span class="p">)</span>
        <span class="n">_schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
            <span class="n">schema_name</span><span class="p">,</span>
            <span class="n">create_schema</span><span class="o">=</span><span class="n">create_schema</span><span class="p">,</span>
            <span class="n">create_tables</span><span class="o">=</span><span class="n">create_tables</span><span class="p">,</span>
            <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">add_objects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_objects</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_schema</span>
        <span class="n">_schema</span><span class="o">.</span><span class="n">spawn_missing_classes</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-function">


<h2 id="datajoint.list_schemas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_schemas</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.list_schemas" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>connection</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dj.Connection object</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of all accessible schemas on the server</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/schemas.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_schemas</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param connection: a dj.Connection object</span>
<span class="sd">    :return: list of all accessible schemas on the server</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">(</span><span class="n">connection</span> <span class="ow">or</span> <span class="n">conn</span><span class="p">())</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT schema_name &quot;</span>
            <span class="s2">&quot;FROM information_schema.schemata &quot;</span>
            <span class="s1">&#39;WHERE schema_name &lt;&gt; &quot;information_schema&quot;&#39;</span>
        <span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.FreeTable" class="doc doc-heading">
            <code>FreeTable</code>


<a href="#datajoint.FreeTable" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Table (datajoint.table.Table)" href="../table/#datajoint.table.Table">Table</a></code></p>


        <p>A base table without a dedicated class. Each instance is associated with a table
specified by full_table_name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dj.Connection object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_table_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in format <code>database</code>.<code>table_name</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>datajoint/table.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FreeTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base table without a dedicated class. Each instance is associated with a table</span>
<span class="sd">    specified by full_table_name.</span>

<span class="sd">    :param conn:  a dj.Connection object</span>
<span class="sd">    :param full_table_name: in format `database`.`table_name`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">full_table_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="n">full_table_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">table_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;FreeTable(`</span><span class="si">%s</span><span class="s2">`.`</span><span class="si">%s</span><span class="s2">`)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Table" class="doc doc-heading">
            <code>Table</code>


<a href="#datajoint.Table" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="QueryExpression (datajoint.expression.QueryExpression)" href="../expression/#datajoint.expression.QueryExpression">QueryExpression</a></code></p>


        <p>Table is an abstract class that represents a table in the schema.
It implements insert and delete methods and inherits query functionality.
To make it a concrete class, override the abstract properties specifying the connection,
table name, database, and definition.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/table.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Table</span><span class="p">(</span><span class="n">QueryExpression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Table is an abstract class that represents a table in the schema.</span>
<span class="sd">    It implements insert and delete methods and inherits query functionality.</span>
<span class="sd">    To make it a concrete class, override the abstract properties specifying the connection,</span>
<span class="sd">    table name, database, and definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_table_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># must be defined in subclass</span>
    <span class="n">_log_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># placeholder for the Log table object</span>

    <span class="c1"># These properties must be set by the schema decorator (schemas.py) at class level</span>
    <span class="c1"># or by FreeTable at instance level</span>
    <span class="n">database</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declaration_context</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Subclasses of Table must implement the `definition` property&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">declare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Declare the table in the schema based on self.definition.</span>

<span class="sd">        :param context: the context for foreign key resolution. If None, foreign keys are</span>
<span class="sd">            not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot declare new tables inside a transaction, &quot;</span>
                <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Enforce strict CamelCase #1150</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_camel_case</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Table class name `</span><span class="si">{name}</span><span class="s2">` is invalid. Please use CamelCase. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;Classes defining tables should be formatted in strict CamelCase.&quot;</span>
            <span class="p">)</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># declare all external tables before declaring main table</span>
            <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
            <span class="c1"># skip if no create privilege</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Declared &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">alter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alter the table definition from self.definition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot update table declaration inside a transaction, &quot;</span>
                <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">frame</span>
        <span class="n">old_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">alter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sql</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Nothing to alter.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE </span><span class="si">{tab}</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Execute?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># declare all external tables before declaring main table</span>
                    <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                    <span class="c1"># skip if no create privilege</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># reset heading</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
                        <span class="n">table_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_info</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Table altered&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Altered &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">from_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the FROM clause of SQL SELECT statements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_select_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the selected attributes from the SQL SELECT statement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">select_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">select_fields</span><span class="p">)</span><span class="o">.</span><span class="n">as_sql</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param primary: if None, then all parents are returned. If True, then only foreign keys composed of</span>
<span class="sd">            primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">            secondary attribute.</span>
<span class="sd">        :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">        :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">        :return: list of parents as table names or table objects</span>
<span class="sd">            with (optional) foreign key information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">parents</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param primary: if None, then all children are returned. If True, then only foreign keys composed of</span>
<span class="sd">            primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">            secondary attribute.</span>
<span class="sd">        :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">        :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">        :return: list of children as table names or table objects</span>
<span class="sd">            with (optional) foreign key information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">children</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">        :return: list of tables descendants in topological order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">        :return: list of tables ancestors in topological order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return part tables either as entries in a dict with foreign key information or a list of objects</span>

<span class="sd">        :param as_objects: if False (default), the output is a dict describing the foreign keys. If True, return table objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">nodes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">nodes</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_declared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True is the table is declared in the schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s1">&#39;SHOW TABLES in `</span><span class="si">{database}</span><span class="s1">` LIKE &quot;</span><span class="si">{table_name}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rowcount</span>
            <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: full table name in the schema</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;`</span><span class="si">{0:s}</span><span class="s2">`.`</span><span class="si">{1:s}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span> <span class="o">=</span> <span class="n">Log</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="n">skip_logging</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">external</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``update1`` updates one existing entry in the table.</span>
<span class="sd">        Caution: In DataJoint the primary modes for data manipulation is to ``insert`` and</span>
<span class="sd">        ``delete`` entire records since referential integrity works on the level of records,</span>
<span class="sd">        not fields. Therefore, updates are reserved for corrective operations outside of main</span>
<span class="sd">        workflow. Use UPDATE methods sparingly with full awareness of potential violations of</span>
<span class="sd">        assumptions.</span>

<span class="sd">        :param row: a ``dict`` containing the primary key values and the attributes to update.</span>
<span class="sd">            Setting an attribute value to None will reset it to the default value (if any).</span>

<span class="sd">        The primary key attributes must always be provided.</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: 3})  # update value in record with id=1</span>
<span class="sd">        &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: None})  # reset value to default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># argument validations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of update1 must be dict-like.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The argument of update1 must supply all primary key values.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># ok</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update cannot be applied to a restricted table.&quot;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update can only be applied to one existing entry.&quot;</span><span class="p">)</span>
        <span class="c1"># UPDATE query</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">{table}</span><span class="s2"> SET </span><span class="si">{assignments}</span><span class="s2"> WHERE </span><span class="si">{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
            <span class="n">assignments</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="p">),</span>
            <span class="n">where</span><span class="o">=</span><span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">set</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>

<span class="sd">        :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="sd">            as one row.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">,</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a collection of rows.</span>

<span class="sd">        :param rows: Either (a) an iterable where an element is a numpy record, a</span>
<span class="sd">            dict-like object, a pandas.DataFrame, a sequence, or a query expression with</span>
<span class="sd">            the same heading as self, or (b) a pathlib.Path object specifying a path</span>
<span class="sd">            relative to the current directory with a CSV file, the contents of which</span>
<span class="sd">            will be inserted.</span>
<span class="sd">        :param replace: If True, replaces the existing tuple.</span>
<span class="sd">        :param skip_duplicates: If True, silently skip duplicate inserts.</span>
<span class="sd">        :param ignore_extra_fields: If False, fields that are not in the heading raise error.</span>
<span class="sd">        :param allow_direct_insert: Only applies in auto-populated tables. If False (default),</span>
<span class="sd">            insert may only be called from inside the make callback.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; Table.insert([</span>
<span class="sd">            &gt;&gt;&gt;     dict(subject_id=7, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-01&quot;),</span>
<span class="sd">            &gt;&gt;&gt;     dict(subject_id=8, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-02&quot;)])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="c1"># drop &#39;extra&#39; synthetic index for 1-field index case -</span>
            <span class="c1"># frames with more advanced indices should be prepared by user.</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
                <span class="n">drop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

        <span class="c1"># prohibit direct inserts into auto-populated tables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_direct_insert</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_allow_insert&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Inserts into an auto-populated table can only be done inside &quot;</span>
                <span class="s2">&quot;its make method during a populate call.&quot;</span>
                <span class="s2">&quot; To override, set keyword argument allow_direct_insert=True.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="c1"># insert from select</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Attribute </span><span class="si">%s</span><span class="s2"> not found. To ignore extra attributes in insert, &quot;</span>
                        <span class="s2">&quot;set ignore_extra_fields=True.&quot;</span>
                        <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{table}</span><span class="s2"> (</span><span class="si">{fields}</span><span class="s2">) </span><span class="si">{select}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
                <span class="n">select</span><span class="o">=</span><span class="n">rows</span><span class="o">.</span><span class="n">make_sql</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
                <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=</span><span class="si">{table}</span><span class="s2">.`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">skip_duplicates</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># collects the field list from first row (passed by reference)</span>
        <span class="n">field_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__make_row_to_insert</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{destination}</span><span class="s2">(`</span><span class="si">{fields}</span><span class="s2">`) VALUES </span><span class="si">{placeholders}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                    <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
                    <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_list</span><span class="p">),</span>
                    <span class="n">placeholders</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
                    <span class="p">),</span>
                    <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">skip_duplicates</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
                        <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">UnknownAttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                    <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">DuplicateError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                    <span class="s2">&quot;To ignore duplicate entries in insert, set skip_duplicates=True&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the table without cascading and without user prompt.</span>
<span class="sd">        If this table has populated dependent tables, this will fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT ROW_COUNT()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">get_count</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">safemode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_parts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">force_masters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the contents of the table and its dependent tables, recursively.</span>

<span class="sd">        Args:</span>
<span class="sd">            transaction: If `True`, use of the entire delete becomes an atomic transaction.</span>
<span class="sd">                This is the default and recommended behavior. Set to `False` if this delete is</span>
<span class="sd">                nested within another transaction.</span>
<span class="sd">            safemode: If `True`, prohibit nested transactions and prompt to confirm. Default</span>
<span class="sd">                is `dj.config[&#39;safemode&#39;]`.</span>
<span class="sd">            force_parts: Delete from parts even when not deleting from their masters.</span>
<span class="sd">            force_masters: If `True`, include part/master pairs in the cascade.</span>
<span class="sd">                Default is `False`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of deleted rows (excluding those from dependent tables).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DataJointError: Delete exceeds maximum number of delete attempts.</span>
<span class="sd">            DataJointError: When deleting within an existing transaction.</span>
<span class="sd">            DataJointError: Deleting a part table before its master.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">visited_masters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">cascade</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;service function to perform cascading deletes recursively.&quot;&quot;&quot;</span>
            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">delete_count</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">foreign_key_error_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                            <span class="s2">&quot;Cascading deletes failed because the error message is missing foreign key information.&quot;</span>
                            <span class="s2">&quot;Make sure you have REFERENCES privilege to all dependent tables.&quot;</span>
                        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                    <span class="c1"># if schema name missing, use table</span>
                    <span class="k">if</span> <span class="s2">&quot;`.`&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]:</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>  <span class="c1"># fully matched, adjusting the keys</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="p">]</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># only partially matched, querying with constraint to determine keys</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="nb">list</span><span class="p">,</span>
                                <span class="nb">zip</span><span class="p">(</span>
                                    <span class="o">*</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                                        <span class="n">constraint_info_query</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                                            <span class="k">match</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">),</span>
                                            <span class="o">*</span><span class="p">[</span>
                                                <span class="n">_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;`.`&quot;</span><span class="p">)</span>
                                            <span class="p">],</span>
                                        <span class="p">),</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                                <span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Restrict child by table if</span>
                    <span class="c1">#   1. if table&#39;s restriction attributes are not in child&#39;s primary key</span>
                    <span class="c1">#   2. if child renames any attributes</span>
                    <span class="c1"># Otherwise restrict child by table&#39;s restriction.</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_restriction</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]:</span>
                        <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                            <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]))</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span>

                    <span class="n">master_name</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">force_masters</span>
                        <span class="ow">and</span> <span class="n">master_name</span>
                        <span class="ow">and</span> <span class="n">master_name</span> <span class="o">!=</span> <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                        <span class="ow">and</span> <span class="n">master_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_masters</span>
                    <span class="p">):</span>
                        <span class="n">master</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">master_name</span><span class="p">)</span>
                        <span class="n">master</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="n">master</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">make_condition</span><span class="p">(</span>  <span class="c1"># &amp;= may cause in target tables in subquery</span>
                                <span class="n">master</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">child</span><span class="o">.</span><span class="n">proj</span><span class="p">())</span><span class="o">.</span><span class="n">fetch</span><span class="p">(),</span>
                                <span class="n">master</span><span class="o">.</span><span class="n">_restriction_attributes</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">]</span>
                        <span class="n">visited_masters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">master_name</span><span class="p">)</span>
                        <span class="n">cascade</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cascade</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Deleting </span><span class="si">{count}</span><span class="s2"> rows from </span><span class="si">{table}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">count</span><span class="o">=</span><span class="n">delete_count</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Exceeded maximum number of delete attempts.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">delete_count</span>

        <span class="n">safemode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">safemode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">safemode</span>

        <span class="c1"># Start transaction</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">transaction</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Delete cannot use a transaction within an ongoing transaction. &quot;</span>
                        <span class="s2">&quot;Set transaction=False or safemode=False).&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Cascading delete</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delete_count</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">force_parts</span><span class="p">:</span>
            <span class="c1"># Avoid deleting from child before master (See issue #151)</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Attempt to delete part table </span><span class="si">{part}</span><span class="s2"> before deleting from &quot;</span>
                        <span class="s2">&quot;its master </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># Confirm and commit</span>
        <span class="k">if</span> <span class="n">delete_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Nothing to delete.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Delete completed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Commit deletes?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit_transaction</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Delete committed.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Delete cancelled&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delete_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drops the table without cascading to dependent tables and without user prompt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DROP TABLE </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped table </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Nothing to drop: table </span><span class="si">%s</span><span class="s2"> is not declared&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop the table and all tables that reference it, recursively.</span>
<span class="sd">        User is prompted for confirmation if config[&#39;safemode&#39;] is set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;A table with an applied restriction cannot be dropped.&quot;</span>
                <span class="s2">&quot; Call drop() on the unrestricted Table.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">do_drop</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">table</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># avoid dropping part tables without their masters: See issue #374</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attempt to drop part table </span><span class="si">{part}</span><span class="s2"> before dropping &quot;</span>
                    <span class="s2">&quot;its master. Drop </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="n">table</span> <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">%d</span><span class="s2"> tuples)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">do_drop</span> <span class="o">=</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">if</span> <span class="n">do_drop</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>
                <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tables dropped. Restart kernel.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">size_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: size of data and indices in bytes on the storage device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s1">&#39;SHOW TABLE STATUS FROM `</span><span class="si">{database}</span><span class="s1">` WHERE NAME=&quot;</span><span class="si">{table}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span>
            <span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;Data_length&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;Index_length&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return:  the definition string for the query using DataJoint DDL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">frame</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">(</span><span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">in_key</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">attributes_thus_far</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">attributes_declared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">in_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">in_key</span><span class="p">:</span>
                <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">in_key</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">do_include</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">fk_props</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]:</span>
                    <span class="n">do_include</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]):</span>
                        <span class="c1"># foreign key properties</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]))</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">index_props</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot; [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_props</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">index_props</span>
                                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;aliased&quot;</span><span class="p">]:</span>
                            <span class="c1"># simple foreign key</span>
                            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># projected foreign key</span>
                            <span class="n">definition</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="s2">.proj(</span><span class="si">{proj_list}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                    <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                    <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                                    <span class="n">proj_list</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="n">ref</span> <span class="o">!=</span> <span class="n">attr</span>
                                    <span class="p">),</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">attributes_declared</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">do_include</span><span class="p">:</span>
                <span class="n">attributes_declared</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> : </span><span class="si">%-28s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">attr</span><span class="o">.</span><span class="n">name</span>
                        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot; auto_increment&quot;</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># add remaining indexes</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{unique}</span><span class="s2">INDEX (</span><span class="si">{attrs}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;UNIQUE &quot;</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;unique&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">printout</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">definition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">definition</span>

    <span class="c1"># --- private helper functions ----</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">__make_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given attribute `name` with `value`, return its processed value or value placeholder</span>
<span class="sd">        as a string to be included in the query and the value, if any, to be submitted for</span>
<span class="sd">        processing by mysql API.</span>

<span class="sd">        :param name:  name of attribute to be inserted</span>
<span class="sd">        :param value: value of attribute to be inserted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ignore_extra_fields</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">adapter</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">numeric</span> <span class="ow">and</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)))):</span>
            <span class="c1"># set default value</span>
            <span class="n">placeholder</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># not NULL</span>
            <span class="n">placeholder</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                            <span class="s2">&quot;badly formed UUID value </span><span class="si">{v}</span><span class="s2"> for attribute `</span><span class="si">{n}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">v</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">name</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">bytes</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_blob</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_external</span>
                    <span class="k">else</span> <span class="n">value</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_attachment</span><span class="p">:</span>
                <span class="n">attachment_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_external</span><span class="p">:</span>
                    <span class="c1"># value is hash of contents</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">upload_attachment</span><span class="p">(</span><span class="n">attachment_path</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">bytes</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># value is filename + contents</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">attachment_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="n">attachment_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_filepath</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">upload_filepath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">numeric</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__make_row_to_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function for insert and update</span>

<span class="sd">        :param row:  A tuple to insert</span>
<span class="sd">        :return: a dict with fields &#39;names&#39;, &#39;placeholders&#39;, &#39;values&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Validates that all items in `fields` are valid attributes in the heading</span>

<span class="sd">            :param fields: field names of a tuple</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                <span class="s2">&quot;`</span><span class="si">{0:s}</span><span class="s2">` is not in the table heading&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                            <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">field_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Attempt to insert rows with different fields.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">):</span>  <span class="c1"># np.array</span>
            <span class="n">check_fields</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>  <span class="c1"># dict-based</span>
            <span class="n">check_fields</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># positional</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Invalid insert argument. Incorrect number of attributes: &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{given}</span><span class="s2"> given; </span><span class="si">{expected}</span><span class="s2"> expected&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">given</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">expected</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Datatype </span><span class="si">%s</span><span class="s2"> cannot be inserted&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="p">]</span>
        <span class="k">if</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">),</span> <span class="s2">&quot;Empty tuple&quot;</span>
        <span class="n">row_to_insert</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="s2">&quot;placeholders&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">field_list</span><span class="p">:</span>
            <span class="c1"># first row sets the composition of the field list</span>
            <span class="n">field_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#  reorder attributes in row_to_insert to match field_list</span>
            <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span>
            <span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row_to_insert</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.declare" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">declare</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Table.declare" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Declare the table in the schema based on self.definition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the context for foreign key resolution. If None, foreign keys are not allowed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">declare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare the table in the schema based on self.definition.</span>

<span class="sd">    :param context: the context for foreign key resolution. If None, foreign keys are</span>
<span class="sd">        not allowed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot declare new tables inside a transaction, &quot;</span>
            <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
        <span class="p">)</span>
    <span class="c1"># Enforce strict CamelCase #1150</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_camel_case</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Table class name `</span><span class="si">{name}</span><span class="s2">` is invalid. Please use CamelCase. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;Classes defining tables should be formatted in strict CamelCase.&quot;</span>
        <span class="p">)</span>
    <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># declare all external tables before declaring main table</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
        <span class="c1"># skip if no create privilege</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Declared &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.alter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">alter</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Table.alter" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Alter the table definition from self.definition</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Alter the table definition from self.definition</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot update table declaration inside a transaction, &quot;</span>
            <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">frame</span>
    <span class="n">old_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">alter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Nothing to alter.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE </span><span class="si">{tab}</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Execute?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># declare all external tables before declaring main table</span>
                <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                <span class="c1"># skip if no create privilege</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reset heading</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
                    <span class="n">table_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_info</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Table altered&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Altered &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.from_clause" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_clause</span><span class="p">()</span></code>

<a href="#datajoint.Table.from_clause" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the FROM clause of SQL SELECT statements.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">from_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the FROM clause of SQL SELECT statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.get_select_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_select_fields</span><span class="p">(</span><span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Table.get_select_fields" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selected attributes from the SQL SELECT statement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_select_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the selected attributes from the SQL SELECT statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">select_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">select_fields</span><span class="p">)</span><span class="o">.</span><span class="n">as_sql</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.parents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parents</span><span class="p">(</span><span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.parents" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>primary</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if None, then all parents are returned. If True, then only foreign keys composed of primary key attributes are considered.  If False, return foreign keys including at least one secondary attribute.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False, return table names. If True, return table objects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>foreign_key_info</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, each element in result also includes foreign key info.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of parents as table names or table objects with (optional) foreign key information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param primary: if None, then all parents are returned. If True, then only foreign keys composed of</span>
<span class="sd">        primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">        secondary attribute.</span>
<span class="sd">    :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">    :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">    :return: list of parents as table names or table objects</span>
<span class="sd">        with (optional) foreign key information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">parents</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.children" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">children</span><span class="p">(</span><span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.children" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>primary</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if None, then all children are returned. If True, then only foreign keys composed of primary key attributes are considered.  If False, return foreign keys including at least one secondary attribute.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False, return table names. If True, return table objects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>foreign_key_info</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, each element in result also includes foreign key info.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of children as table names or table objects with (optional) foreign key information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param primary: if None, then all children are returned. If True, then only foreign keys composed of</span>
<span class="sd">        primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">        secondary attribute.</span>
<span class="sd">    :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">    :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">    :return: list of children as table names or table objects</span>
<span class="sd">        with (optional) foreign key information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">children</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.descendants" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">descendants</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.descendants" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>False - a list of table names; True - a list of table objects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of tables descendants in topological order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">    :return: list of tables descendants in topological order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.ancestors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ancestors</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.ancestors" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>False - a list of table names; True - a list of table objects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of tables ancestors in topological order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">    :return: list of tables ancestors in topological order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.parts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parts</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.parts" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>return part tables either as entries in a dict with foreign key information or a list of objects</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_objects</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False (default), the output is a dict describing the foreign keys. If True, return table objects.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return part tables either as entries in a dict with foreign key information or a list of objects</span>

<span class="sd">    :param as_objects: if False (default), the output is a dict describing the foreign keys. If True, return table objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">nodes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Table.is_declared" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_declared</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Table.is_declared" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True is the table is declared in the schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Table.full_table_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_table_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Table.full_table_name" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>full table name in the schema</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.update1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update1</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></code>

<a href="#datajoint.Table.update1" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p><code>update1</code> updates one existing entry in the table.
Caution: In DataJoint the primary modes for data manipulation is to <code>insert</code> and
<code>delete</code> entire records since referential integrity works on the level of records,
not fields. Therefore, updates are reserved for corrective operations outside of main
workflow. Use UPDATE methods sparingly with full awareness of potential violations of
assumptions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a <code>dict</code> containing the primary key values and the attributes to update. Setting an attribute value to None will reset it to the default value (if any).  The primary key attributes must always be provided.  Examples:  &gt;&gt;&gt; table.update1({'id': 1, 'value': 3})  # update value in record with id=1 &gt;&gt;&gt; table.update1({'id': 1, 'value': None})  # reset value to default</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``update1`` updates one existing entry in the table.</span>
<span class="sd">    Caution: In DataJoint the primary modes for data manipulation is to ``insert`` and</span>
<span class="sd">    ``delete`` entire records since referential integrity works on the level of records,</span>
<span class="sd">    not fields. Therefore, updates are reserved for corrective operations outside of main</span>
<span class="sd">    workflow. Use UPDATE methods sparingly with full awareness of potential violations of</span>
<span class="sd">    assumptions.</span>

<span class="sd">    :param row: a ``dict`` containing the primary key values and the attributes to update.</span>
<span class="sd">        Setting an attribute value to None will reset it to the default value (if any).</span>

<span class="sd">    The primary key attributes must always be provided.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: 3})  # update value in record with id=1</span>
<span class="sd">    &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: None})  # reset value to default</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># argument validations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of update1 must be dict-like.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;The argument of update1 must supply all primary key values.&quot;</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># ok</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update cannot be applied to a restricted table.&quot;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update can only be applied to one existing entry.&quot;</span><span class="p">)</span>
    <span class="c1"># UPDATE query</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
    <span class="p">]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">{table}</span><span class="s2"> SET </span><span class="si">{assignments}</span><span class="s2"> WHERE </span><span class="si">{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
        <span class="n">assignments</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="p">),</span>
        <span class="n">where</span><span class="o">=</span><span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">set</span><span class="p">()),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.insert1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert1</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#datajoint.Table.insert1" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Insert one data record into the table. For <code>kwargs</code>, see <code>insert()</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a numpy record, a dict-like object, or an ordered sequence to be inserted as one row.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>

<span class="sd">    :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="sd">        as one row.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.insert" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.Table.insert" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Insert a collection of rows.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rows</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either (a) an iterable where an element is a numpy record, a dict-like object, a pandas.DataFrame, a sequence, or a query expression with the same heading as self, or (b) a pathlib.Path object specifying a path relative to the current directory with a CSV file, the contents of which will be inserted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>replace</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, replaces the existing tuple.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_duplicates</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, silently skip duplicate inserts.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_extra_fields</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If False, fields that are not in the heading raise error.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_direct_insert</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only applies in auto-populated tables. If False (default), insert may only be called from inside the make callback.  Example:  &gt;&gt;&gt; Table.insert([ &gt;&gt;&gt;     dict(subject_id=7, species="mouse", date_of_birth="2014-09-01"), &gt;&gt;&gt;     dict(subject_id=8, species="mouse", date_of_birth="2014-09-02")])</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">rows</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert a collection of rows.</span>

<span class="sd">    :param rows: Either (a) an iterable where an element is a numpy record, a</span>
<span class="sd">        dict-like object, a pandas.DataFrame, a sequence, or a query expression with</span>
<span class="sd">        the same heading as self, or (b) a pathlib.Path object specifying a path</span>
<span class="sd">        relative to the current directory with a CSV file, the contents of which</span>
<span class="sd">        will be inserted.</span>
<span class="sd">    :param replace: If True, replaces the existing tuple.</span>
<span class="sd">    :param skip_duplicates: If True, silently skip duplicate inserts.</span>
<span class="sd">    :param ignore_extra_fields: If False, fields that are not in the heading raise error.</span>
<span class="sd">    :param allow_direct_insert: Only applies in auto-populated tables. If False (default),</span>
<span class="sd">        insert may only be called from inside the make callback.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; Table.insert([</span>
<span class="sd">        &gt;&gt;&gt;     dict(subject_id=7, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-01&quot;),</span>
<span class="sd">        &gt;&gt;&gt;     dict(subject_id=8, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-02&quot;)])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="c1"># drop &#39;extra&#39; synthetic index for 1-field index case -</span>
        <span class="c1"># frames with more advanced indices should be prepared by user.</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
            <span class="n">drop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

    <span class="c1"># prohibit direct inserts into auto-populated tables</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_direct_insert</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_allow_insert&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Inserts into an auto-populated table can only be done inside &quot;</span>
            <span class="s2">&quot;its make method during a populate call.&quot;</span>
            <span class="s2">&quot; To override, set keyword argument allow_direct_insert=True.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="c1"># insert from select</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attribute </span><span class="si">%s</span><span class="s2"> not found. To ignore extra attributes in insert, &quot;</span>
                    <span class="s2">&quot;set ignore_extra_fields=True.&quot;</span>
                    <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{table}</span><span class="s2"> (</span><span class="si">{fields}</span><span class="s2">) </span><span class="si">{select}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
            <span class="n">select</span><span class="o">=</span><span class="n">rows</span><span class="o">.</span><span class="n">make_sql</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
            <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=</span><span class="si">{table}</span><span class="s2">.`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">skip_duplicates</span>
                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># collects the field list from first row (passed by reference)</span>
    <span class="n">field_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_row_to_insert</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{destination}</span><span class="s2">(`</span><span class="si">{fields}</span><span class="s2">`) VALUES </span><span class="si">{placeholders}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_list</span><span class="p">),</span>
                <span class="n">placeholders</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
                <span class="p">),</span>
                <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">skip_duplicates</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">UnknownAttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                <span class="s2">&quot;To ignore duplicate entries in insert, set skip_duplicates=True&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.delete_quick" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.delete_quick" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Deletes the table without cascading and without user prompt.
If this table has populated dependent tables, this will fail.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes the table without cascading and without user prompt.</span>
<span class="sd">    If this table has populated dependent tables, this will fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT ROW_COUNT()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">get_count</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">safemode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_parts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_masters</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.delete" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Deletes the contents of the table and its dependent tables, recursively.</p>
<p>Args:
    transaction: If <code>True</code>, use of the entire delete becomes an atomic transaction.
        This is the default and recommended behavior. Set to <code>False</code> if this delete is
        nested within another transaction.
    safemode: If <code>True</code>, prohibit nested transactions and prompt to confirm. Default
        is <code>dj.config['safemode']</code>.
    force_parts: Delete from parts even when not deleting from their masters.
    force_masters: If <code>True</code>, include part/master pairs in the cascade.
        Default is <code>False</code>.</p>
<p>Returns:
    Number of deleted rows (excluding those from dependent tables).</p>
<p>Raises:
    DataJointError: Delete exceeds maximum number of delete attempts.
    DataJointError: When deleting within an existing transaction.
    DataJointError: Deleting a part table before its master.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">safemode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_parts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">force_masters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes the contents of the table and its dependent tables, recursively.</span>

<span class="sd">    Args:</span>
<span class="sd">        transaction: If `True`, use of the entire delete becomes an atomic transaction.</span>
<span class="sd">            This is the default and recommended behavior. Set to `False` if this delete is</span>
<span class="sd">            nested within another transaction.</span>
<span class="sd">        safemode: If `True`, prohibit nested transactions and prompt to confirm. Default</span>
<span class="sd">            is `dj.config[&#39;safemode&#39;]`.</span>
<span class="sd">        force_parts: Delete from parts even when not deleting from their masters.</span>
<span class="sd">        force_masters: If `True`, include part/master pairs in the cascade.</span>
<span class="sd">            Default is `False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of deleted rows (excluding those from dependent tables).</span>

<span class="sd">    Raises:</span>
<span class="sd">        DataJointError: Delete exceeds maximum number of delete attempts.</span>
<span class="sd">        DataJointError: When deleting within an existing transaction.</span>
<span class="sd">        DataJointError: Deleting a part table before its master.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">visited_masters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cascade</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;service function to perform cascading deletes recursively.&quot;&quot;&quot;</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">delete_count</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">foreign_key_error_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Cascading deletes failed because the error message is missing foreign key information.&quot;</span>
                        <span class="s2">&quot;Make sure you have REFERENCES privilege to all dependent tables.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="c1"># if schema name missing, use table</span>
                <span class="k">if</span> <span class="s2">&quot;`.`&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]:</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># fully matched, adjusting the keys</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># only partially matched, querying with constraint to determine keys</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">,</span>
                            <span class="nb">zip</span><span class="p">(</span>
                                <span class="o">*</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                                    <span class="n">constraint_info_query</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">),</span>
                                        <span class="o">*</span><span class="p">[</span>
                                            <span class="n">_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
                                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;`.`&quot;</span><span class="p">)</span>
                                        <span class="p">],</span>
                                    <span class="p">),</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Restrict child by table if</span>
                <span class="c1">#   1. if table&#39;s restriction attributes are not in child&#39;s primary key</span>
                <span class="c1">#   2. if child renames any attributes</span>
                <span class="c1"># Otherwise restrict child by table&#39;s restriction.</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_restriction</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span>
                <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]:</span>
                    <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                        <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]))</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span>

                <span class="n">master_name</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">force_masters</span>
                    <span class="ow">and</span> <span class="n">master_name</span>
                    <span class="ow">and</span> <span class="n">master_name</span> <span class="o">!=</span> <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                    <span class="ow">and</span> <span class="n">master_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited_masters</span>
                <span class="p">):</span>
                    <span class="n">master</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">master_name</span><span class="p">)</span>
                    <span class="n">master</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="n">master</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">make_condition</span><span class="p">(</span>  <span class="c1"># &amp;= may cause in target tables in subquery</span>
                            <span class="n">master</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">child</span><span class="o">.</span><span class="n">proj</span><span class="p">())</span><span class="o">.</span><span class="n">fetch</span><span class="p">(),</span>
                            <span class="n">master</span><span class="o">.</span><span class="n">_restriction_attributes</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">visited_masters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">master_name</span><span class="p">)</span>
                    <span class="n">cascade</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cascade</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Deleting </span><span class="si">{count}</span><span class="s2"> rows from </span><span class="si">{table}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">count</span><span class="o">=</span><span class="n">delete_count</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Exceeded maximum number of delete attempts.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delete_count</span>

    <span class="n">safemode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">safemode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">safemode</span>

    <span class="c1"># Start transaction</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">transaction</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Delete cannot use a transaction within an ongoing transaction. &quot;</span>
                    <span class="s2">&quot;Set transaction=False or safemode=False).&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Cascading delete</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">delete_count</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
        <span class="k">raise</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force_parts</span><span class="p">:</span>
        <span class="c1"># Avoid deleting from child before master (See issue #151)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attempt to delete part table </span><span class="si">{part}</span><span class="s2"> before deleting from &quot;</span>
                    <span class="s2">&quot;its master </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Confirm and commit</span>
    <span class="k">if</span> <span class="n">delete_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Nothing to delete.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">transaction</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Delete completed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Commit deletes?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit_transaction</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Delete committed.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Delete cancelled&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delete_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.drop_quick" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_quick</span><span class="p">()</span></code>

<a href="#datajoint.Table.drop_quick" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Drops the table without cascading to dependent tables and without user prompt.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drops the table without cascading to dependent tables and without user prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DROP TABLE </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped table </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Nothing to drop: table </span><span class="si">%s</span><span class="s2"> is not declared&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.drop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop</span><span class="p">()</span></code>

<a href="#datajoint.Table.drop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Drop the table and all tables that reference it, recursively.
User is prompted for confirmation if config['safemode'] is set to True.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop the table and all tables that reference it, recursively.</span>
<span class="sd">    User is prompted for confirmation if config[&#39;safemode&#39;] is set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;A table with an applied restriction cannot be dropped.&quot;</span>
            <span class="s2">&quot; Call drop() on the unrestricted Table.&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">do_drop</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">table</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="c1"># avoid dropping part tables without their masters: See issue #374</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
        <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attempt to drop part table </span><span class="si">{part}</span><span class="s2"> before dropping &quot;</span>
                <span class="s2">&quot;its master. Drop </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="n">table</span> <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">%d</span><span class="s2"> tuples)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">do_drop</span> <span class="o">=</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
    <span class="k">if</span> <span class="n">do_drop</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tables dropped. Restart kernel.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.Table.size_on_disk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">size_on_disk</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.Table.size_on_disk" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>size of data and indices in bytes on the storage device</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Table.describe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Table.describe" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the definition string for the query using DataJoint DDL.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>datajoint/table.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return:  the definition string for the query using DataJoint DDL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">frame</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">(</span><span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">in_key</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">attributes_thus_far</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">attributes_declared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">in_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">in_key</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">in_key</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">do_include</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">fk_props</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]:</span>
                <span class="n">do_include</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]):</span>
                    <span class="c1"># foreign key properties</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">index_props</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot; [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_props</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">index_props</span>
                            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;aliased&quot;</span><span class="p">]:</span>
                        <span class="c1"># simple foreign key</span>
                        <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                            <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># projected foreign key</span>
                        <span class="n">definition</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="s2">.proj(</span><span class="si">{proj_list}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                                <span class="n">proj_list</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="n">ref</span> <span class="o">!=</span> <span class="n">attr</span>
                                <span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">attributes_declared</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">do_include</span><span class="p">:</span>
            <span class="n">attributes_declared</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> : </span><span class="si">%-28s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot; auto_increment&quot;</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="c1"># add remaining indexes</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{unique}</span><span class="s2">INDEX (</span><span class="si">{attrs}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;UNIQUE &quot;</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;unique&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">printout</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">definition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">definition</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Computed" class="doc doc-heading">
            <code>Computed</code>


<a href="#datajoint.Computed" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UserTable (datajoint.user_tables.UserTable)" href="../user_tables/#datajoint.user_tables.UserTable">UserTable</a></code>, <code><a class="autorefs autorefs-internal" title="AutoPopulate (datajoint.autopopulate.AutoPopulate)" href="../autopopulate/#datajoint.autopopulate.AutoPopulate">AutoPopulate</a></code></p>


        <p>Inherit from this class if the table's values are computed from other tables in the schema.
The inherited class must at least provide the function <code>_make_tuples</code>.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/user_tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Computed</span><span class="p">(</span><span class="n">UserTable</span><span class="p">,</span> <span class="n">AutoPopulate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this class if the table&#39;s values are computed from other tables in the schema.</span>
<span class="sd">    The inherited class must at least provide the function `_make_tuples`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_prefix</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span>
    <span class="n">tier_regexp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?P&lt;computed&gt;&quot;</span> <span class="o">+</span> <span class="n">_prefix</span> <span class="o">+</span> <span class="n">_base_regexp</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Imported" class="doc doc-heading">
            <code>Imported</code>


<a href="#datajoint.Imported" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UserTable (datajoint.user_tables.UserTable)" href="../user_tables/#datajoint.user_tables.UserTable">UserTable</a></code>, <code><a class="autorefs autorefs-internal" title="AutoPopulate (datajoint.autopopulate.AutoPopulate)" href="../autopopulate/#datajoint.autopopulate.AutoPopulate">AutoPopulate</a></code></p>


        <p>Inherit from this class if the table's values are imported from external data sources.
The inherited class must at least provide the function <code>_make_tuples</code>.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/user_tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Imported</span><span class="p">(</span><span class="n">UserTable</span><span class="p">,</span> <span class="n">AutoPopulate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this class if the table&#39;s values are imported from external data sources.</span>
<span class="sd">    The inherited class must at least provide the function `_make_tuples`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_prefix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>
    <span class="n">tier_regexp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?P&lt;imported&gt;&quot;</span> <span class="o">+</span> <span class="n">_prefix</span> <span class="o">+</span> <span class="n">_base_regexp</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Lookup" class="doc doc-heading">
            <code>Lookup</code>


<a href="#datajoint.Lookup" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UserTable (datajoint.user_tables.UserTable)" href="../user_tables/#datajoint.user_tables.UserTable">UserTable</a></code></p>


        <p>Inherit from this class if the table's values are for lookup. This is
currently equivalent to defining the table as Manual and serves semantic
purposes only.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/user_tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Lookup</span><span class="p">(</span><span class="n">UserTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this class if the table&#39;s values are for lookup. This is</span>
<span class="sd">    currently equivalent to defining the table as Manual and serves semantic</span>
<span class="sd">    purposes only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_prefix</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
    <span class="n">tier_regexp</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;lookup&gt;&quot;</span> <span class="o">+</span> <span class="n">_prefix</span> <span class="o">+</span> <span class="n">_base_regexp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;TIER&quot;</span><span class="p">,</span> <span class="s2">&quot;lookup&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Manual" class="doc doc-heading">
            <code>Manual</code>


<a href="#datajoint.Manual" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UserTable (datajoint.user_tables.UserTable)" href="../user_tables/#datajoint.user_tables.UserTable">UserTable</a></code></p>


        <p>Inherit from this class if the table's values are entered manually.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/user_tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Manual</span><span class="p">(</span><span class="n">UserTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this class if the table&#39;s values are entered manually.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_prefix</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;</span>
    <span class="n">tier_regexp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?P&lt;manual&gt;&quot;</span> <span class="o">+</span> <span class="n">_prefix</span> <span class="o">+</span> <span class="n">_base_regexp</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.Part" class="doc doc-heading">
            <code>Part</code>


<a href="#datajoint.Part" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="UserTable (datajoint.user_tables.UserTable)" href="../user_tables/#datajoint.user_tables.UserTable">UserTable</a></code></p>


        <p>Inherit from this class if the table's values are details of an entry in another table
and if this table is populated by the other table. For example, the entries inheriting from
dj.Part could be single entries of a matrix, while the parent table refers to the entire matrix.
Part tables are implemented as classes inside classes.</p>







              <details class="quote">
                <summary>Source code in <code>datajoint/user_tables.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Part</span><span class="p">(</span><span class="n">UserTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this class if the table&#39;s values are details of an entry in another table</span>
<span class="sd">    and if this table is populated by the other table. For example, the entries inheriting from</span>
<span class="sd">    dj.Part could be single entries of a matrix, while the parent table refers to the entire matrix.</span>
<span class="sd">    Part tables are implemented as classes inside classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_master</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">tier_regexp</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;(?P&lt;master&gt;&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">tier_regexp</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Manual</span><span class="p">,</span> <span class="n">Lookup</span><span class="p">,</span> <span class="n">Imported</span><span class="p">,</span> <span class="n">Computed</span><span class="p">)])</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;){1,1}&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;__&quot;</span>
        <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(?P&lt;part&gt;&quot;</span>
        <span class="o">+</span> <span class="n">_base_regexp</span>
        <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="p">)</span>

    <span class="nd">@ClassProperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">connection</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_connection</span>

    <span class="nd">@ClassProperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_table_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;`</span><span class="si">{0:s}</span><span class="s2">`.`</span><span class="si">{1:s}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@ClassProperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">master</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_master</span>

    <span class="nd">@ClassProperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">table_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">master</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">cls</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">table_name</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span> <span class="o">+</span> <span class="n">from_camel_case</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unless force is True, prohibits direct deletes from parts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">force_parts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot delete from a Part directly. Delete from master instead&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unless force is True, prohibits direct deletes from parts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot drop a Part directly.  Delete from master instead&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">alter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># without context, use declaration context which maps master keyword to master table</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration_context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="datajoint.Part.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Part.delete" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>unless force is True, prohibits direct deletes from parts.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/user_tables.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    unless force is True, prohibits direct deletes from parts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">force_parts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot delete from a Part directly. Delete from master instead&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="datajoint.Part.drop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.Part.drop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>unless force is True, prohibits direct deletes from parts.</p>


            <details class="quote">
              <summary>Source code in <code>datajoint/user_tables.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    unless force is True, prohibits direct deletes from parts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot drop a Part directly.  Delete from master instead&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




































































































  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.datajoint.com" target="_blank" rel="noopener" title="DataJoint" class="md-social__link">
      <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>
    </a>
  
    
    
    
    
    <a href="https://datajoint.slack.com" target="_blank" rel="noopener" title="Slack" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/datajoint" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/datajoint" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/datajoint" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://hub.docker.com/u/datajoint" target="_blank" rel="noopener" title="DockerHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://pypi.org/user/datajointbot" target="_blank" rel="noopener" title="PyPI" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
    
    
    
    
    <a href="https://stackoverflow.com/questions/tagged/datajoint" target="_blank" rel="noopener" title="StackOverflow" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCdeCuFOTCXlVMRzh6Wk-lGg" target="_blank" rel="noopener" title="YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>