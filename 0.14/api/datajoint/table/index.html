
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../settings/">
      
      
        <link rel="next" href="../user_tables/">
      
      <link rel="icon" href="../../../assets/images/company-logo-blue.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>table.py - DataJoint Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Slab";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datajoint.table" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DataJoint Documentation" class="md-header__button md-logo" aria-label="DataJoint Documentation" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DataJoint Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              table.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="" data-md-level="0">
    <label class="md-nav__title" for="__drawer">
        <a href="../../.." title="DataJoint Documentation"
            class="md-nav__button md-logo" aria-label="DataJoint Documentation" data-md-component="logo">
            
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

        </a><a href="https://datajoint.com/docs/core/" title="DataJoint">
            ⬅ Home
        </a>
    </label>
    
    <div class="md-nav__source">
        <a href="https://github.com/datajoint/datajoint-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/datajoint-python
  </div>
</a>
    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        DataJoint Python
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/principles/" class="md-nav__link">
        Principles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          System Administration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          System Administration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sysadmin/dba/" class="md-nav__link">
        Database Administration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sysadmin/filestore/" class="md-nav__link">
        File Storage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Client Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Client Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/install/" class="md-nav__link">
        Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/creds/" class="md-nav__link">
        Credentials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../client/stores/" class="md-nav__link">
        File Stores
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Schema Design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Schema Design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/schema/" class="md-nav__link">
        Schema Creation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Table Definition
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Table Definition
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/tiers/" class="md-nav__link">
        Table Tiers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/declare/" class="md-nav__link">
        Declaration Syntax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/primary/" class="md-nav__link">
        Primary Key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/attributes/" class="md-nav__link">
        Attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/lookup/" class="md-nav__link">
        Lookup Tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/blobs/" class="md-nav__link">
        Blobs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/attach/" class="md-nav__link">
        Attachments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/filepath/" class="md-nav__link">
        Filepaths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/customtype/" class="md-nav__link">
        Custom Datatypes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/dependencies/" class="md-nav__link">
        Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/indexes/" class="md-nav__link">
        Indexes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tables/master-part/" class="md-nav__link">
        Master-Part Relationships
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/diagrams/" class="md-nav__link">
        Schema Diagrams
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/normalization/" class="md-nav__link">
        Entity Normalization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/integrity/" class="md-nav__link">
        Data Integrity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/recall/" class="md-nav__link">
        Schema Recall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/drop/" class="md-nav__link">
        Schema Drop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/alter/" class="md-nav__link">
        Schema Modification
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Data Manipulations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Data Manipulations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/insert/" class="md-nav__link">
        Insert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/delete/" class="md-nav__link">
        Delete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/update/" class="md-nav__link">
        Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../manipulation/transactions/" class="md-nav__link">
        Transactions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Data Queries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Data Queries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/common-commands/" class="md-nav__link">
        Common Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/fetch/" class="md-nav__link">
        Fetch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/iteration/" class="md-nav__link">
        Iteration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/operators/" class="md-nav__link">
        Operators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/restrict/" class="md-nav__link">
        Restrict
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/project/" class="md-nav__link">
        Projection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/join/" class="md-nav__link">
        Join
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/aggregation/" class="md-nav__link">
        Aggregation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/union/" class="md-nav__link">
        Union
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/universals/" class="md-nav__link">
        Universal Sets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../query/query-caching/" class="md-nav__link">
        Query Caching
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Computations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Computations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/make/" class="md-nav__link">
        Make Method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/populate/" class="md-nav__link">
        Populate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/key-source/" class="md-nav__link">
        Key Source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute/distributed/" class="md-nav__link">
        Distributed Computing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Internals
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Internals
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../internal/transpilation/" class="md-nav__link">
        SQL Transpilation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Reproducibility
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Reproducibility
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reproduce/table-tiers/" class="md-nav__link">
        Table Tiers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reproduce/make-method/" class="md-nav__link">
        Make Method
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../existing-pipelines/" class="md-nav__link">
        Existing Pipelines
      </a>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/json/" class="md-nav__link">
        Using the json type
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../develop/" class="md-nav__link">
        Develop
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../citation/" class="md-nav__link">
        Citation
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

        
        
        
        

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" checked>
      
      
      
        <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_18_1" id="__nav_18_1_label" tabindex="0">
          datajoint
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_18_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_18_1">
          <span class="md-nav__icon md-icon"></span>
          datajoint
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../__init__/" class="md-nav__link">
        __init__.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin/" class="md-nav__link">
        admin.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../attribute_adapter/" class="md-nav__link">
        attribute_adapter.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autopopulate/" class="md-nav__link">
        autopopulate.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../blob/" class="md-nav__link">
        blob.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../condition/" class="md-nav__link">
        condition.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connection/" class="md-nav__link">
        connection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../declare/" class="md-nav__link">
        declare.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        dependencies.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diagram/" class="md-nav__link">
        diagram.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../errors/" class="md-nav__link">
        errors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../expression/" class="md-nav__link">
        expression.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../external/" class="md-nav__link">
        external.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fetch/" class="md-nav__link">
        fetch.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hash/" class="md-nav__link">
        hash.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../heading/" class="md-nav__link">
        heading.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jobs/" class="md-nav__link">
        jobs.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        logging.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugin/" class="md-nav__link">
        plugin.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../preview/" class="md-nav__link">
        preview.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        s3.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/" class="md-nav__link">
        schemas.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        settings.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          table.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        table.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datajoint.table" class="md-nav__link">
    datajoint.table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.DataJointError" class="md-nav__link">
    DataJointError
  </a>
  
    <nav class="md-nav" aria-label="DataJointError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.errors.DataJointError.suggest" class="md-nav__link">
    suggest()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.user_choice" class="md-nav__link">
    user_choice()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.QueryExpression" class="md-nav__link">
    QueryExpression
  </a>
  
    <nav class="md-nav" aria-label="QueryExpression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.connection" class="md-nav__link">
    connection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.support" class="md-nav__link">
    support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.heading" class="md-nav__link">
    heading
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.original_heading" class="md-nav__link">
    original_heading
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.restriction" class="md-nav__link">
    restriction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.restriction_attributes" class="md-nav__link">
    restriction_attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.make_sql" class="md-nav__link">
    make_sql()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.make_subquery" class="md-nav__link">
    make_subquery()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.restrict" class="md-nav__link">
    restrict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.join" class="md-nav__link">
    join()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.proj" class="md-nav__link">
    proj()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.aggr" class="md-nav__link">
    aggr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.head" class="md-nav__link">
    head()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.tail" class="md-nav__link">
    tail()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.cursor" class="md-nav__link">
    cursor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.expression.QueryExpression.preview" class="md-nav__link">
    preview()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.get_master" class="md-nav__link">
    get_master()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.Table" class="md-nav__link">
    Table
  </a>
  
    <nav class="md-nav" aria-label="Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.declare" class="md-nav__link">
    declare()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.alter" class="md-nav__link">
    alter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.from_clause" class="md-nav__link">
    from_clause()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.get_select_fields" class="md-nav__link">
    get_select_fields()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.parents" class="md-nav__link">
    parents()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.children" class="md-nav__link">
    children()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.descendants" class="md-nav__link">
    descendants()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.ancestors" class="md-nav__link">
    ancestors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.parts" class="md-nav__link">
    parts()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.is_declared" class="md-nav__link">
    is_declared
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.full_table_name" class="md-nav__link">
    full_table_name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.update1" class="md-nav__link">
    update1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.insert1" class="md-nav__link">
    insert1()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.insert" class="md-nav__link">
    insert()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.delete_quick" class="md-nav__link">
    delete_quick()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.delete" class="md-nav__link">
    delete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.drop_quick" class="md-nav__link">
    drop_quick()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.drop" class="md-nav__link">
    drop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.size_on_disk" class="md-nav__link">
    size_on_disk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Table.describe" class="md-nav__link">
    describe()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.AccessError" class="md-nav__link">
    AccessError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.DuplicateError" class="md-nav__link">
    DuplicateError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.IntegrityError" class="md-nav__link">
    IntegrityError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.Heading" class="md-nav__link">
    Heading
  </a>
  
    <nav class="md-nav" aria-label="Heading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.as_dtype" class="md-nav__link">
    as_dtype
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.as_sql" class="md-nav__link">
    as_sql()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.select" class="md-nav__link">
    select()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.join" class="md-nav__link">
    join()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.set_primary_key" class="md-nav__link">
    set_primary_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.heading.Heading.make_subquery_heading" class="md-nav__link">
    make_subquery_heading()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.UnknownAttributeError" class="md-nav__link">
    UnknownAttributeError
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.make_condition" class="md-nav__link">
    make_condition()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.declare" class="md-nav__link">
    declare()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.alter" class="md-nav__link">
    alter()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.lookup_class_name" class="md-nav__link">
    lookup_class_name()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.FreeTable" class="md-nav__link">
    FreeTable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datajoint.table.Log" class="md-nav__link">
    Log
  </a>
  
    <nav class="md-nav" aria-label="Log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Log.delete" class="md-nav__link">
    delete()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datajoint.table.Log.drop" class="md-nav__link">
    drop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user_tables/" class="md-nav__link">
        user_tables.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../version/" class="md-nav__link">
        version.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>table.py</h1>

<div class="doc doc-object doc-module">


<a id="datajoint.table"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h2 id="datajoint.table.DataJointError" class="doc doc-heading">
        <code>DataJointError</code>


<a href="#datajoint.table.DataJointError" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>Exception</code></p>

  
      <p>Base class for errors specific to DataJoint internal operation.</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/errors.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DataJointError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for errors specific to DataJoint internal operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.plugin</span> <span class="kn">import</span> <span class="n">connection_plugins</span><span class="p">,</span> <span class="n">type_plugins</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cause__</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">PluginWarning</span><span class="p">(</span><span class="s2">&quot;Unverified DataJoint plugin detected.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">any</span><span class="p">([</span><span class="ow">not</span> <span class="n">plugins</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;verified&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">plugins</span> <span class="ow">in</span> <span class="p">[</span><span class="n">connection_plugins</span><span class="p">,</span> <span class="n">type_plugins</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">plugins</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        regenerate the exception with additional arguments</span>

<span class="sd">        :param args: addition arguments</span>
<span class="sd">        :return: a new exception of the same type with the additional arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="datajoint.errors.DataJointError.suggest" class="doc doc-heading">
<code class="highlight language-python"><span class="n">suggest</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#datajoint.errors.DataJointError.suggest" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>regenerate the exception with additional arguments</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>args</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>addition arguments</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a new exception of the same type with the additional arguments</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/errors.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">suggest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    regenerate the exception with additional arguments</span>

<span class="sd">    :param args: addition arguments</span>
<span class="sd">    :return: a new exception of the same type with the additional arguments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.user_choice" class="doc doc-heading">
<code class="highlight language-python"><span class="n">user_choice</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.table.user_choice" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Prompts the user for confirmation.  The default value, if any, is capitalized.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>prompt</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Information to display to the user.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>choices</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an iterable of possible choices.</p>
            </div>
          </td>
          <td>
                <code>(&#39;yes&#39;, &#39;no&#39;)</code>
          </td>
        </tr>
        <tr>
          <td><code>default</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>default choice</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the user's choice</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">user_choice</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompts the user for confirmation.  The default value, if any, is capitalized.</span>

<span class="sd">    :param prompt: Information to display to the user.</span>
<span class="sd">    :param choices: an iterable of possible choices.</span>
<span class="sd">    :param default: default choice</span>
<span class="sd">    :return: the user&#39;s choice</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">choices</span>
    <span class="n">choice_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">(</span><span class="n">choice</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">default</span> <span class="k">else</span> <span class="n">choice</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">response</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">choice_list</span> <span class="o">+</span> <span class="s2">&quot;]: &quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">response</span> <span class="k">else</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.QueryExpression" class="doc doc-heading">
        <code>QueryExpression</code>


<a href="#datajoint.table.QueryExpression" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">

  
      <p>QueryExpression implements query operators to derive new entity set from its input.
A QueryExpression object generates a SELECT statement in SQL.
QueryExpression operators are restrict, join, proj, aggr, and union.</p>
<p>A QueryExpression object has a support, a restriction (an AndList), and heading.
Property <code>heading</code> (type dj.Heading) contains information about the attributes.
It is loaded from the database and updated by proj.</p>
<p>Property <code>support</code> is the list of table names or other QueryExpressions to be joined.</p>
<p>The restriction is applied first without having access to the attributes generated by the projection.
Then projection is applied by selecting modifying the heading attribute.</p>
<p>Application of operators does not always lead to the creation of a subquery.
A subquery is generated when:
    1. A restriction is applied on any computed or renamed attributes
    2. A projection is applied remapping remapped attributes
    3. Subclasses: Join, Aggregation, and Union have additional specific rules.</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/expression.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">QueryExpression</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QueryExpression implements query operators to derive new entity set from its input.</span>
<span class="sd">    A QueryExpression object generates a SELECT statement in SQL.</span>
<span class="sd">    QueryExpression operators are restrict, join, proj, aggr, and union.</span>

<span class="sd">    A QueryExpression object has a support, a restriction (an AndList), and heading.</span>
<span class="sd">    Property `heading` (type dj.Heading) contains information about the attributes.</span>
<span class="sd">    It is loaded from the database and updated by proj.</span>

<span class="sd">    Property `support` is the list of table names or other QueryExpressions to be joined.</span>

<span class="sd">    The restriction is applied first without having access to the attributes generated by the projection.</span>
<span class="sd">    Then projection is applied by selecting modifying the heading attribute.</span>

<span class="sd">    Application of operators does not always lead to the creation of a subquery.</span>
<span class="sd">    A subquery is generated when:</span>
<span class="sd">        1. A restriction is applied on any computed or renamed attributes</span>
<span class="sd">        2. A projection is applied remapping remapped attributes</span>
<span class="sd">        3. Subclasses: Join, Aggregation, and Union have additional specific rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_restriction</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_left</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of booleans True for left joins, False for inner joins</span>
    <span class="n">_original_heading</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># heading before projections</span>

    <span class="c1"># subclasses or instantiators must provide values</span>
    <span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_heading</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_support</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If the query will be using distinct</span>
    <span class="n">_distinct</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a dj.Connection object&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A list of table names or subqueries to from the FROM clause&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a dj.Heading object, reflects the effects of the projection operator .proj&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">original_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a dj.Heading object reflecting the attributes before projection&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_heading</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restriction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a AndList object of restrictions applied to input to produce the result&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restriction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">AndList</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restriction</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restriction_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the set of attribute names invoked in the WHERE clause&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restriction_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restriction_attributes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">primary_key</span>

    <span class="n">_subquery_alias_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>  <span class="c1"># count for alias names used in the FROM clause</span>

    <span class="k">def</span> <span class="nf">from_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">support</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">src</span><span class="o">.</span><span class="n">make_sql</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;) as `$</span><span class="si">%x</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subquery_alias_count</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">src</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span>
        <span class="p">)</span>
        <span class="n">clause</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">support</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">left</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">support</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span><span class="p">):</span>
            <span class="n">clause</span> <span class="o">+=</span> <span class="s2">&quot; NATURAL</span><span class="si">{left}</span><span class="s2"> JOIN </span><span class="si">{clause}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="s2">&quot; LEFT&quot;</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">clause</span><span class="o">=</span><span class="n">s</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">clause</span>

    <span class="k">def</span> <span class="nf">where_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span>
            <span class="k">else</span> <span class="s2">&quot; WHERE (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;)AND(&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make the SQL SELECT statement.</span>

<span class="sd">        :param fields: used to explicitly set the select attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;SELECT </span><span class="si">{distinct}{fields}</span><span class="s2"> FROM </span><span class="si">{from_}{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">distinct</span><span class="o">=</span><span class="s2">&quot;DISTINCT &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distinct</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">as_sql</span><span class="p">(</span><span class="n">fields</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
            <span class="n">from_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
            <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="c1"># --------- query operators -----------</span>
    <span class="k">def</span> <span class="nf">make_subquery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create a new SELECT statement where self is the FROM clause&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">QueryExpression</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">make_subquery_heading</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a new expression with the new restriction applied.</span>
<span class="sd">        rel.restrict(restriction)  is equivalent to  rel &amp; restriction.</span>
<span class="sd">        rel.restrict(Not(restriction))  is equivalent to  rel - restriction</span>
<span class="sd">        The primary key of the result is unaffected.</span>
<span class="sd">        Successive restrictions are combined as logical AND:   r &amp; a &amp; b  is equivalent to r &amp; AndList((a, b))</span>
<span class="sd">        Any QueryExpression, collection, or sequence other than an AndList are treated as OrLists</span>
<span class="sd">        (logical disjunction of conditions)</span>
<span class="sd">        Inverse restriction is accomplished by either using the subtraction operator or the Not class.</span>

<span class="sd">        The expressions in each row equivalent:</span>

<span class="sd">        rel &amp; True                          rel</span>
<span class="sd">        rel &amp; False                         the empty entity set</span>
<span class="sd">        rel &amp; &#39;TRUE&#39;                        rel</span>
<span class="sd">        rel &amp; &#39;FALSE&#39;                       the empty entity set</span>
<span class="sd">        rel - cond                          rel &amp; Not(cond)</span>
<span class="sd">        rel - &#39;TRUE&#39;                        rel &amp; False</span>
<span class="sd">        rel - &#39;FALSE&#39;                       rel</span>
<span class="sd">        rel &amp; AndList((cond1,cond2))        rel &amp; cond1 &amp; cond2</span>
<span class="sd">        rel &amp; AndList()                     rel</span>
<span class="sd">        rel &amp; [cond1, cond2]                rel &amp; OrList((cond1, cond2))</span>
<span class="sd">        rel &amp; []                            rel &amp; False</span>
<span class="sd">        rel &amp; None                          rel &amp; False</span>
<span class="sd">        rel &amp; any_empty_entity_set          rel &amp; False</span>
<span class="sd">        rel - AndList((cond1,cond2))        rel &amp; [Not(cond1), Not(cond2)]</span>
<span class="sd">        rel - [cond1, cond2]                rel &amp; Not(cond1) &amp; Not(cond2)</span>
<span class="sd">        rel - AndList()                     rel &amp; False</span>
<span class="sd">        rel - []                            rel</span>
<span class="sd">        rel - None                          rel</span>
<span class="sd">        rel - any_empty_entity_set          rel</span>

<span class="sd">        When arg is another QueryExpression, the restriction  rel &amp; arg  restricts rel to elements that match at least</span>
<span class="sd">        one element in arg (hence arg is treated as an OrList).</span>
<span class="sd">        Conversely,  rel - arg  restricts rel to elements that do not match any elements in arg.</span>
<span class="sd">        Two elements match when their common attributes have equal values or when they have no common attributes.</span>
<span class="sd">        All shared attributes must be in the primary key of either rel or arg or both or an error will be raised.</span>

<span class="sd">        QueryExpression.restrict is the only access point that modifies restrictions. All other operators must</span>
<span class="sd">        ultimately call restrict()</span>

<span class="sd">        :param restriction: a sequence or an array (treated as OR list), another QueryExpression, an SQL condition</span>
<span class="sd">        string, or an AndList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">new_condition</span> <span class="o">=</span> <span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_condition</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>  <span class="c1"># restriction has no effect, return the same object</span>
        <span class="c1"># check that all attributes in condition are present in the query</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` is not found in query.&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>
        <span class="c1"># If the new condition uses any new attributes, a subquery is required.</span>
        <span class="c1"># However, Aggregation&#39;s HAVING statement works fine with aliased attributes.</span>
        <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">need_subquery</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">AndList</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span>
            <span class="p">)</span>  <span class="c1"># copy to preserve the original</span>
        <span class="n">result</span><span class="o">.</span><span class="n">restriction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_condition</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">restrict_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restriction operator e.g. ``q1 &amp; q2``.</span>
<span class="sd">        :return: a restricted copy of the input argument</span>
<span class="sd">        See QueryExpression.restrict for more detail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Permissive restriction operator ignoring compatibility check  e.g. ``q1 ^ q2``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">restriction</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">restriction</span> <span class="o">=</span> <span class="n">restriction</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">restriction</span><span class="p">,</span> <span class="n">Not</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">Not</span><span class="p">(</span><span class="n">PromiscuousOperand</span><span class="p">(</span><span class="n">restriction</span><span class="o">.</span><span class="n">restriction</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">PromiscuousOperand</span><span class="p">(</span><span class="n">restriction</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverted restriction e.g. ``q1 - q2``.</span>
<span class="sd">        :return: a restricted copy of the input argument</span>
<span class="sd">        See QueryExpression.restrict for more detail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">Not</span><span class="p">(</span><span class="n">restriction</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert between restriction and inverted restriction e.g. ``-q1``.</span>
<span class="sd">        :return: target restriction</span>
<span class="sd">        See QueryExpression.restrict for more detail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Not</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span>
        <span class="k">return</span> <span class="n">Not</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        join of query expressions `self` and `other` e.g. ``q1 * q2``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Permissive join of query expressions `self` and `other` ignoring compatibility check</span>
<span class="sd">            e.g. ``q1 @ q2``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">semantic_check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">semantic_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create the joined QueryExpression.</span>
<span class="sd">        a * b  is short for A.join(B)</span>
<span class="sd">        a @ b  is short for A.join(B, semantic_check=False)</span>
<span class="sd">        Additionally, left=True will retain the rows of self, effectively performing a left join.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># trigger subqueries if joining on renamed attributes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of join must be a QueryExpression&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">semantic_check</span><span class="p">:</span>
            <span class="n">assert_join_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">join_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="c1"># needs subquery if self&#39;s FROM clause has common attributes with other&#39;s FROM clause</span>
        <span class="n">need_subquery1</span> <span class="o">=</span> <span class="n">need_subquery2</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
            <span class="o">-</span> <span class="n">join_attributes</span>
        <span class="p">)</span>
        <span class="c1"># need subquery if any of the join attributes are derived</span>
        <span class="n">need_subquery1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">need_subquery1</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">join_attributes</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">need_subquery2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">need_subquery2</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">join_attributes</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">need_subquery1</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">need_subquery2</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">QueryExpression</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">support</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">+</span> <span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">_left</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">AndList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">restriction</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_original_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">original_heading</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">support</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">_left</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;union e.g. ``q1 + q2``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Union</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Projection operator.</span>

<span class="sd">        :param attributes:  attributes to be included in the result. (The primary key is already included).</span>
<span class="sd">        :param named_attributes: new attributes computed or renamed from existing attributes.</span>
<span class="sd">        :return: the projected expression.</span>
<span class="sd">        Primary key attributes cannot be excluded but may be renamed.</span>
<span class="sd">        If the attribute list contains an Ellipsis ..., then all secondary attributes are included too</span>
<span class="sd">        Prefixing an attribute name with a dash &#39;-attr&#39; removes the attribute from the list if present.</span>
<span class="sd">        Keyword arguments can be used to rename attributes as in name=&#39;attr&#39;, duplicate them as in name=&#39;(attr)&#39;, or</span>
<span class="sd">        self.proj(...) or self.proj(Ellipsis) -- include all attributes (return self)</span>
<span class="sd">        self.proj() -- include only primary key</span>
<span class="sd">        self.proj(&#39;attr1&#39;, &#39;attr2&#39;)  -- include primary key and attributes attr1 and attr2</span>
<span class="sd">        self.proj(..., &#39;-attr1&#39;, &#39;-attr2&#39;)  -- include all attributes except attr1 and attr2</span>
<span class="sd">        self.proj(name1=&#39;attr1&#39;) -- include primary key and &#39;attr1&#39; renamed as name1</span>
<span class="sd">        self.proj(&#39;attr1&#39;, dup=&#39;(attr1)&#39;) -- include primary key and attribute attr1 twice, with the duplicate &#39;dup&#39;</span>
<span class="sd">        self.proj(k=&#39;abs(attr1)&#39;) adds the new attribute k with the value computed as an expression (SQL syntax)</span>
<span class="sd">        from other attributes available before the projection.</span>
<span class="sd">        Each attribute name can only be used once.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">named_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">translate_attribute</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># new attributes in parentheses are included again with the new name without removing original</span>
        <span class="n">duplication_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">rf</span><span class="s1">&#39;^\s*\(\s*(?!</span><span class="si">{</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CONSTANT_LITERALS</span><span class="p">)</span><span class="si">}</span><span class="s1">)(?P&lt;name&gt;[a-zA-Z_]\w*)\s*\)\s*$&#39;</span>
        <span class="p">)</span>
        <span class="c1"># attributes without parentheses renamed</span>
        <span class="n">rename_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">rf</span><span class="s1">&#39;^\s*(?!</span><span class="si">{</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CONSTANT_LITERALS</span><span class="p">)</span><span class="si">}</span><span class="s1">)(?P&lt;name&gt;[a-zA-Z_]\w*)\s*$&#39;</span>
        <span class="p">)</span>
        <span class="n">replicate_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">duplication_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span>
        <span class="p">}</span>
        <span class="n">rename_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">rename_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span>
        <span class="p">}</span>
        <span class="n">compute_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">duplication_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rename_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="c1"># include primary key</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="c1"># include all secondary attributes with Ellipsis</span>
        <span class="k">if</span> <span class="bp">Ellipsis</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">a</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">secondary_attributes</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid data type for an attribute in .proj&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># normal case</span>
        <span class="c1"># remove excluded attributes, specified as `-attr&#39;</span>
        <span class="n">excluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span>
        <span class="n">excluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">excluded</span><span class="p">)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot exclude primary key attribute </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">excluded</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>
        <span class="c1"># check that all attributes exist in heading</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>

        <span class="c1"># check that all mentioned names are present in heading</span>
        <span class="n">mentions</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute &#39;</span><span class="si">%s</span><span class="s2">&#39; not found.&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mentions</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>

        <span class="c1"># check that newly created attributes do not clash with any other selected attributes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="n">a</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rename_map</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">compute_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="n">a</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">compute_map</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="n">a</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">replicate_map</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">compute_map</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># all ok</span>

        <span class="c1"># need a subquery if the projection remaps any remapped attributes</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">q</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">compute_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">extract_column_names</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="n">used</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">used</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replicate_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">used</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">need_subquery</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
            <span class="c1"># need a subquery if the restriction applies to attributes that have been renamed</span>
            <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction_attributes</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span> <span class="k">if</span> <span class="n">need_subquery</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_original_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">original_heading</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">attributes</span><span class="p">,</span>
            <span class="n">rename_map</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">rename_map</span><span class="p">,</span> <span class="o">**</span><span class="n">replicate_map</span><span class="p">),</span>
            <span class="n">compute_map</span><span class="o">=</span><span class="n">compute_map</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">aggr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregation of the type U(&#39;attr1&#39;,&#39;attr2&#39;).aggr(group, computation=&quot;QueryExpression&quot;)</span>
<span class="sd">        has the primary key (&#39;attr1&#39;,&#39;attr2&#39;) and performs aggregation computations for all matching elements of `group`.</span>

<span class="sd">        :param group:  The query expression to be aggregated.</span>
<span class="sd">        :param keep_all_rows: True=keep all the rows from self. False=keep only rows that match entries in group.</span>
<span class="sd">        :param named_attributes: computations of the form new_attribute=&quot;sql expression on attributes of group&quot;</span>
<span class="sd">        :return: The derived query expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">Ellipsis</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="c1"># expand ellipsis to include only attributes from the left table</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">secondary_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Aggregation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="n">keep_all_rows</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
            <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span>
        <span class="p">)</span>

    <span class="n">aggregate</span> <span class="o">=</span> <span class="n">aggr</span>  <span class="c1"># alias for aggr</span>

    <span class="c1"># ---------- Fetch operators --------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fetch1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Fetch1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        shortcut to fetch the first few entries from query expression.</span>
<span class="sd">        Equivalent to fetch(order_by=&quot;KEY&quot;, limit=25)</span>

<span class="sd">        :param limit:  number of entries</span>
<span class="sd">        :param fetch_kwargs: kwargs for fetch</span>
<span class="sd">        :return: query result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        shortcut to fetch the last few entries from query expression.</span>
<span class="sd">        Equivalent to fetch(order_by=&quot;KEY DESC&quot;, limit=25)[::-1]</span>

<span class="sd">        :param limit:  number of entries</span>
<span class="sd">        :param fetch_kwargs: kwargs for fetch</span>
<span class="sd">        :return: query result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;KEY DESC&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:return: number of elements in the result set e.g. ``len(q1)``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT </span><span class="si">{select_}</span><span class="s2"> FROM </span><span class="si">{from_}{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">select_</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;count(*)&quot;</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_left</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;count(DISTINCT </span><span class="si">{fields}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">as_sql</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span> <span class="n">include_aliases</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="n">from_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
                <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if the result is not empty. Equivalent to len(self) &gt; 0 but often</span>
<span class="sd">            faster e.g. ``bool(q1)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;SELECT EXISTS(SELECT 1 FROM </span><span class="si">{from_}{where}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">from_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span> <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns True if the restriction in item matches any entries in self</span>
<span class="sd">            e.g. ``restriction in q1``.</span>

<span class="sd">        :param item: any restriction</span>
<span class="sd">        (item in query_expression) is equivalent to bool(query_expression &amp; item) but may be</span>
<span class="sd">        executed more efficiently.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span>  <span class="c1"># May be optimized e.g. using an EXISTS query</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns an iterator-compatible QueryExpression object e.g. ``iter(q1)``.</span>

<span class="sd">        :param self: iterator-compatible QueryExpression object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_only_key</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">in_key</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;KEY&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the next record on an iterator-compatible QueryExpression object</span>
<span class="sd">            e.g. ``next(q1)``.</span>

<span class="sd">        :param self: A query expression</span>
<span class="sd">        :type self: :class:`QueryExpression`</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_keys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># self._iter_keys is missing because __iter__ has not been called.</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;A QueryExpression object is not an iterator. &quot;</span>
                <span class="s2">&quot;Use iter(obj) to create an iterator.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_only_key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">DataJointError</span><span class="p">:</span>
                    <span class="c1"># The data may have been deleted since the moment the keys were fetched</span>
                    <span class="c1"># -- move on to next entry.</span>
                    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See expression.fetch() for input description.</span>
<span class="sd">        :return: query cursor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">and</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;limit is required when offset is set&quot;</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sql</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; LIMIT </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">limit</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; OFFSET </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">offset</span> <span class="k">if</span> <span class="n">offset</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="n">as_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the string representation of a QueryExpression object e.g. ``str(q1)``.</span>

<span class="sd">        :param self: A query expression</span>
<span class="sd">        :type self: :class:`QueryExpression`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;loglevel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;debug&quot;</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:return: a string of preview of the contents of the query.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:return: HTML to display table in Jupyter notebook.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">repr_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.connection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">connection</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.connection" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>a dj.Connection object</p>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.support" class="doc doc-heading">
<code class="highlight language-python"><span class="n">support</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.support" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>A list of table names or subqueries to from the FROM clause</p>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.heading" class="doc doc-heading">
<code class="highlight language-python"><span class="n">heading</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.heading" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>a dj.Heading object, reflects the effects of the projection operator .proj</p>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.original_heading" class="doc doc-heading">
<code class="highlight language-python"><span class="n">original_heading</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.original_heading" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>a dj.Heading object reflecting the attributes before projection</p>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.restriction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">restriction</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.restriction" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>a AndList object of restrictions applied to input to produce the result</p>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.expression.QueryExpression.restriction_attributes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">restriction_attributes</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.expression.QueryExpression.restriction_attributes" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>the set of attribute names invoked in the WHERE clause</p>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.make_sql" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_sql</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.make_sql" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Make the SQL SELECT statement.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fields</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used to explicitly set the select attributes</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the SQL SELECT statement.</span>

<span class="sd">    :param fields: used to explicitly set the select attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;SELECT </span><span class="si">{distinct}{fields}</span><span class="s2"> FROM </span><span class="si">{from_}{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">distinct</span><span class="o">=</span><span class="s2">&quot;DISTINCT &quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distinct</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">as_sql</span><span class="p">(</span><span class="n">fields</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
        <span class="n">from_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
        <span class="n">where</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.make_subquery" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_subquery</span><span class="p">()</span></code>

<a href="#datajoint.expression.QueryExpression.make_subquery" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>create a new SELECT statement where self is the FROM clause</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_subquery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;create a new SELECT statement where self is the FROM clause&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">QueryExpression</span><span class="p">()</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">make_subquery_heading</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.restrict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">restrict</span><span class="p">(</span><span class="n">restriction</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.restrict" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Produces a new expression with the new restriction applied.
rel.restrict(restriction)  is equivalent to  rel &amp; restriction.
rel.restrict(Not(restriction))  is equivalent to  rel - restriction
The primary key of the result is unaffected.
Successive restrictions are combined as logical AND:   r &amp; a &amp; b  is equivalent to r &amp; AndList((a, b))
Any QueryExpression, collection, or sequence other than an AndList are treated as OrLists
(logical disjunction of conditions)
Inverse restriction is accomplished by either using the subtraction operator or the Not class.</p>
<p>The expressions in each row equivalent:</p>
<p>rel &amp; True                          rel
rel &amp; False                         the empty entity set
rel &amp; 'TRUE'                        rel
rel &amp; 'FALSE'                       the empty entity set
rel - cond                          rel &amp; Not(cond)
rel - 'TRUE'                        rel &amp; False
rel - 'FALSE'                       rel
rel &amp; AndList((cond1,cond2))        rel &amp; cond1 &amp; cond2
rel &amp; AndList()                     rel
rel &amp; [cond1, cond2]                rel &amp; OrList((cond1, cond2))
rel &amp; []                            rel &amp; False
rel &amp; None                          rel &amp; False
rel &amp; any_empty_entity_set          rel &amp; False
rel - AndList((cond1,cond2))        rel &amp; [Not(cond1), Not(cond2)]
rel - [cond1, cond2]                rel &amp; Not(cond1) &amp; Not(cond2)
rel - AndList()                     rel &amp; False
rel - []                            rel
rel - None                          rel
rel - any_empty_entity_set          rel</p>
<p>When arg is another QueryExpression, the restriction  rel &amp; arg  restricts rel to elements that match at least
one element in arg (hence arg is treated as an OrList).
Conversely,  rel - arg  restricts rel to elements that do not match any elements in arg.
Two elements match when their common attributes have equal values or when they have no common attributes.
All shared attributes must be in the primary key of either rel or arg or both or an error will be raised.</p>
<p>QueryExpression.restrict is the only access point that modifies restrictions. All other operators must
ultimately call restrict()</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>restriction</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a sequence or an array (treated as OR list), another QueryExpression, an SQL condition string, or an AndList.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a new expression with the new restriction applied.</span>
<span class="sd">    rel.restrict(restriction)  is equivalent to  rel &amp; restriction.</span>
<span class="sd">    rel.restrict(Not(restriction))  is equivalent to  rel - restriction</span>
<span class="sd">    The primary key of the result is unaffected.</span>
<span class="sd">    Successive restrictions are combined as logical AND:   r &amp; a &amp; b  is equivalent to r &amp; AndList((a, b))</span>
<span class="sd">    Any QueryExpression, collection, or sequence other than an AndList are treated as OrLists</span>
<span class="sd">    (logical disjunction of conditions)</span>
<span class="sd">    Inverse restriction is accomplished by either using the subtraction operator or the Not class.</span>

<span class="sd">    The expressions in each row equivalent:</span>

<span class="sd">    rel &amp; True                          rel</span>
<span class="sd">    rel &amp; False                         the empty entity set</span>
<span class="sd">    rel &amp; &#39;TRUE&#39;                        rel</span>
<span class="sd">    rel &amp; &#39;FALSE&#39;                       the empty entity set</span>
<span class="sd">    rel - cond                          rel &amp; Not(cond)</span>
<span class="sd">    rel - &#39;TRUE&#39;                        rel &amp; False</span>
<span class="sd">    rel - &#39;FALSE&#39;                       rel</span>
<span class="sd">    rel &amp; AndList((cond1,cond2))        rel &amp; cond1 &amp; cond2</span>
<span class="sd">    rel &amp; AndList()                     rel</span>
<span class="sd">    rel &amp; [cond1, cond2]                rel &amp; OrList((cond1, cond2))</span>
<span class="sd">    rel &amp; []                            rel &amp; False</span>
<span class="sd">    rel &amp; None                          rel &amp; False</span>
<span class="sd">    rel &amp; any_empty_entity_set          rel &amp; False</span>
<span class="sd">    rel - AndList((cond1,cond2))        rel &amp; [Not(cond1), Not(cond2)]</span>
<span class="sd">    rel - [cond1, cond2]                rel &amp; Not(cond1) &amp; Not(cond2)</span>
<span class="sd">    rel - AndList()                     rel &amp; False</span>
<span class="sd">    rel - []                            rel</span>
<span class="sd">    rel - None                          rel</span>
<span class="sd">    rel - any_empty_entity_set          rel</span>

<span class="sd">    When arg is another QueryExpression, the restriction  rel &amp; arg  restricts rel to elements that match at least</span>
<span class="sd">    one element in arg (hence arg is treated as an OrList).</span>
<span class="sd">    Conversely,  rel - arg  restricts rel to elements that do not match any elements in arg.</span>
<span class="sd">    Two elements match when their common attributes have equal values or when they have no common attributes.</span>
<span class="sd">    All shared attributes must be in the primary key of either rel or arg or both or an error will be raised.</span>

<span class="sd">    QueryExpression.restrict is the only access point that modifies restrictions. All other operators must</span>
<span class="sd">    ultimately call restrict()</span>

<span class="sd">    :param restriction: a sequence or an array (treated as OR list), another QueryExpression, an SQL condition</span>
<span class="sd">    string, or an AndList.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">new_condition</span> <span class="o">=</span> <span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_condition</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>  <span class="c1"># restriction has no effect, return the same object</span>
    <span class="c1"># check that all attributes in condition are present in the query</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` is not found in query.&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>
    <span class="c1"># If the new condition uses any new attributes, a subquery is required.</span>
    <span class="c1"># However, Aggregation&#39;s HAVING statement works fine with aliased attributes.</span>
    <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">need_subquery</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">AndList</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span>
        <span class="p">)</span>  <span class="c1"># copy to preserve the original</span>
    <span class="n">result</span><span class="o">.</span><span class="n">restriction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_condition</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.join" class="doc doc-heading">
<code class="highlight language-python"><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">semantic_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.join" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>create the joined QueryExpression.
a * b  is short for A.join(B)
a @ b  is short for A.join(B, semantic_check=False)
Additionally, left=True will retain the rows of self, effectively performing a left join.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">semantic_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create the joined QueryExpression.</span>
<span class="sd">    a * b  is short for A.join(B)</span>
<span class="sd">    a @ b  is short for A.join(B, semantic_check=False)</span>
<span class="sd">    Additionally, left=True will retain the rows of self, effectively performing a left join.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># trigger subqueries if joining on renamed attributes</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>  <span class="c1"># instantiate</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of join must be a QueryExpression&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">semantic_check</span><span class="p">:</span>
        <span class="n">assert_join_compatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="n">join_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="c1"># needs subquery if self&#39;s FROM clause has common attributes with other&#39;s FROM clause</span>
    <span class="n">need_subquery1</span> <span class="o">=</span> <span class="n">need_subquery2</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
        <span class="o">-</span> <span class="n">join_attributes</span>
    <span class="p">)</span>
    <span class="c1"># need subquery if any of the join attributes are derived</span>
    <span class="n">need_subquery1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">need_subquery1</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">join_attributes</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">need_subquery2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">need_subquery2</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">join_attributes</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">need_subquery1</span><span class="p">:</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">need_subquery2</span><span class="p">:</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">QueryExpression</span><span class="p">()</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">support</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">+</span> <span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">_left</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">AndList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_restriction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">restriction</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_original_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_heading</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">original_heading</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">support</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">_left</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.proj" class="doc doc-heading">
<code class="highlight language-python"><span class="n">proj</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.proj" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Projection operator.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>attributes</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>attributes to be included in the result. (The primary key is already included).</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>named_attributes</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>new attributes computed or renamed from existing attributes.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the projected expression. Primary key attributes cannot be excluded but may be renamed. If the attribute list contains an Ellipsis ..., then all secondary attributes are included too Prefixing an attribute name with a dash '-attr' removes the attribute from the list if present. Keyword arguments can be used to rename attributes as in name='attr', duplicate them as in name='(attr)', or self.proj(...) or self.proj(Ellipsis) -- include all attributes (return self) self.proj() -- include only primary key self.proj('attr1', 'attr2')  -- include primary key and attributes attr1 and attr2 self.proj(..., '-attr1', '-attr2')  -- include all attributes except attr1 and attr2 self.proj(name1='attr1') -- include primary key and 'attr1' renamed as name1 self.proj('attr1', dup='(attr1)') -- include primary key and attribute attr1 twice, with the duplicate 'dup' self.proj(k='abs(attr1)') adds the new attribute k with the value computed as an expression (SQL syntax) from other attributes available before the projection. Each attribute name can only be used once.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Projection operator.</span>

<span class="sd">    :param attributes:  attributes to be included in the result. (The primary key is already included).</span>
<span class="sd">    :param named_attributes: new attributes computed or renamed from existing attributes.</span>
<span class="sd">    :return: the projected expression.</span>
<span class="sd">    Primary key attributes cannot be excluded but may be renamed.</span>
<span class="sd">    If the attribute list contains an Ellipsis ..., then all secondary attributes are included too</span>
<span class="sd">    Prefixing an attribute name with a dash &#39;-attr&#39; removes the attribute from the list if present.</span>
<span class="sd">    Keyword arguments can be used to rename attributes as in name=&#39;attr&#39;, duplicate them as in name=&#39;(attr)&#39;, or</span>
<span class="sd">    self.proj(...) or self.proj(Ellipsis) -- include all attributes (return self)</span>
<span class="sd">    self.proj() -- include only primary key</span>
<span class="sd">    self.proj(&#39;attr1&#39;, &#39;attr2&#39;)  -- include primary key and attributes attr1 and attr2</span>
<span class="sd">    self.proj(..., &#39;-attr1&#39;, &#39;-attr2&#39;)  -- include all attributes except attr1 and attr2</span>
<span class="sd">    self.proj(name1=&#39;attr1&#39;) -- include primary key and &#39;attr1&#39; renamed as name1</span>
<span class="sd">    self.proj(&#39;attr1&#39;, dup=&#39;(attr1)&#39;) -- include primary key and attribute attr1 twice, with the duplicate &#39;dup&#39;</span>
<span class="sd">    self.proj(k=&#39;abs(attr1)&#39;) adds the new attribute k with the value computed as an expression (SQL syntax)</span>
<span class="sd">    from other attributes available before the projection.</span>
<span class="sd">    Each attribute name can only be used once.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">named_attributes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">translate_attribute</span><span class="p">(</span><span class="n">v</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1"># new attributes in parentheses are included again with the new name without removing original</span>
    <span class="n">duplication_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">rf</span><span class="s1">&#39;^\s*\(\s*(?!</span><span class="si">{</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CONSTANT_LITERALS</span><span class="p">)</span><span class="si">}</span><span class="s1">)(?P&lt;name&gt;[a-zA-Z_]\w*)\s*\)\s*$&#39;</span>
    <span class="p">)</span>
    <span class="c1"># attributes without parentheses renamed</span>
    <span class="n">rename_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">rf</span><span class="s1">&#39;^\s*(?!</span><span class="si">{</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CONSTANT_LITERALS</span><span class="p">)</span><span class="si">}</span><span class="s1">)(?P&lt;name&gt;[a-zA-Z_]\w*)\s*$&#39;</span>
    <span class="p">)</span>
    <span class="n">replicate_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">duplication_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span>
    <span class="p">}</span>
    <span class="n">rename_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">rename_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span>
    <span class="p">}</span>
    <span class="n">compute_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">named_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplication_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rename_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="c1"># include primary key</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="c1"># include all secondary attributes with Ellipsis</span>
    <span class="k">if</span> <span class="bp">Ellipsis</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">a</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">secondary_attributes</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid data type for an attribute in .proj&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># normal case</span>
    <span class="c1"># remove excluded attributes, specified as `-attr&#39;</span>
    <span class="n">excluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span>
    <span class="n">excluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">excluded</span><span class="p">)</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">excluded</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot exclude primary key attribute </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">excluded</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>
    <span class="c1"># check that all attributes exist in heading</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>

    <span class="c1"># check that all mentioned names are present in heading</span>
    <span class="n">mentions</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute &#39;</span><span class="si">%s</span><span class="s2">&#39; not found.&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mentions</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>

    <span class="c1"># check that newly created attributes do not clash with any other selected attributes</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">a</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rename_map</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">compute_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">a</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">compute_map</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">replicate_map</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` already exists&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">a</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">replicate_map</span>
                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">rename_map</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">compute_map</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># all ok</span>

    <span class="c1"># need a subquery if the projection remaps any remapped attributes</span>
    <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">q</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">compute_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">extract_column_names</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">used</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rename_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">used</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">replicate_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">used</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Union</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">used</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">need_subquery</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
        <span class="c1"># need a subquery if the restriction applies to attributes that have been renamed</span>
        <span class="n">need_subquery</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction_attributes</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">new_attributes</span>
        <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span> <span class="k">if</span> <span class="n">need_subquery</span> <span class="k">else</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_original_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">original_heading</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">attributes</span><span class="p">,</span>
        <span class="n">rename_map</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">rename_map</span><span class="p">,</span> <span class="o">**</span><span class="n">replicate_map</span><span class="p">),</span>
        <span class="n">compute_map</span><span class="o">=</span><span class="n">compute_map</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.aggr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aggr</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.aggr" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Aggregation of the type U('attr1','attr2').aggr(group, computation="QueryExpression")
has the primary key ('attr1','attr2') and performs aggregation computations for all matching elements of <code>group</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>group</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The query expression to be aggregated.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>keep_all_rows</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True=keep all the rows from self. False=keep only rows that match entries in group.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>named_attributes</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>computations of the form new_attribute="sql expression on attributes of group"</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The derived query expression</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregation of the type U(&#39;attr1&#39;,&#39;attr2&#39;).aggr(group, computation=&quot;QueryExpression&quot;)</span>
<span class="sd">    has the primary key (&#39;attr1&#39;,&#39;attr2&#39;) and performs aggregation computations for all matching elements of `group`.</span>

<span class="sd">    :param group:  The query expression to be aggregated.</span>
<span class="sd">    :param keep_all_rows: True=keep all the rows from self. False=keep only rows that match entries in group.</span>
<span class="sd">    :param named_attributes: computations of the form new_attribute=&quot;sql expression on attributes of group&quot;</span>
<span class="sd">    :return: The derived query expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">Ellipsis</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="c1"># expand ellipsis to include only attributes from the left table</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">Ellipsis</span><span class="p">)</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">secondary_attributes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Aggregation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">keep_all_rows</span><span class="o">=</span><span class="n">keep_all_rows</span><span class="p">)</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
        <span class="o">*</span><span class="n">attributes</span><span class="p">,</span> <span class="o">**</span><span class="n">named_attributes</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.head" class="doc doc-heading">
<code class="highlight language-python"><span class="n">head</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.head" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>shortcut to fetch the first few entries from query expression.
Equivalent to fetch(order_by="KEY", limit=25)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>limit</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of entries</p>
            </div>
          </td>
          <td>
                <code>25</code>
          </td>
        </tr>
        <tr>
          <td><code>fetch_kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>kwargs for fetch</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>query result</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    shortcut to fetch the first few entries from query expression.</span>
<span class="sd">    Equivalent to fetch(order_by=&quot;KEY&quot;, limit=25)</span>

<span class="sd">    :param limit:  number of entries</span>
<span class="sd">    :param fetch_kwargs: kwargs for fetch</span>
<span class="sd">    :return: query result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;KEY&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.tail" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tail</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.tail" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>shortcut to fetch the last few entries from query expression.
Equivalent to fetch(order_by="KEY DESC", limit=25)[::-1]</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>limit</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of entries</p>
            </div>
          </td>
          <td>
                <code>25</code>
          </td>
        </tr>
        <tr>
          <td><code>fetch_kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>kwargs for fetch</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>query result</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    shortcut to fetch the last few entries from query expression.</span>
<span class="sd">    Equivalent to fetch(order_by=&quot;KEY DESC&quot;, limit=25)[::-1]</span>

<span class="sd">    :param limit:  number of entries</span>
<span class="sd">    :param fetch_kwargs: kwargs for fetch</span>
<span class="sd">    :return: query result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;KEY DESC&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">fetch_kwargs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.cursor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cursor</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.cursor" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>See expression.fetch() for input description.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>query cursor</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See expression.fetch() for input description.</span>
<span class="sd">    :return: query cursor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="ow">and</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;limit is required when offset is set&quot;</span><span class="p">)</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_sql</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; LIMIT </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">limit</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; OFFSET </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">offset</span> <span class="k">if</span> <span class="n">offset</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="n">as_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.expression.QueryExpression.preview" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preview</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.expression.QueryExpression.preview" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a string of preview of the contents of the query.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/expression.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:return: a string of preview of the contents of the query.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.get_master" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_master</span><span class="p">(</span><span class="n">full_table_name</span><span class="p">)</span></code>

<a href="#datajoint.table.get_master" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>If the table name is that of a part table, then return what the master table name would be.
This follows DataJoint's table naming convention where a master and a part must be in the
same schema and the part table is prefixed with the master table name + <code>__</code>.</p>
<p>Example:
   <code>ephys</code>.<code>session</code>    -- master
   <code>ephys</code>.<code>session__recording</code>  -- part</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>full_table_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Full table name including part.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Supposed master full table name or empty string if not a part table name.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_master</span><span class="p">(</span><span class="n">full_table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the table name is that of a part table, then return what the master table name would be.</span>
<span class="sd">    This follows DataJoint&#39;s table naming convention where a master and a part must be in the</span>
<span class="sd">    same schema and the part table is prefixed with the master table name + ``__``.</span>

<span class="sd">    Example:</span>
<span class="sd">       `ephys`.`session`    -- master</span>
<span class="sd">       `ephys`.`session__recording`  -- part</span>

<span class="sd">    :param full_table_name: Full table name including part.</span>
<span class="sd">    :type full_table_name: str</span>
<span class="sd">    :return: Supposed master full table name or empty string if not a part table name.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;master&gt;`\w+`.`\w+)__(?P&lt;part&gt;\w+)`&quot;</span><span class="p">,</span> <span class="n">full_table_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span> <span class="k">if</span> <span class="n">match</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.Table" class="doc doc-heading">
        <code>Table</code>


<a href="#datajoint.table.Table" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.expression.QueryExpression" href="../expression/#datajoint.expression.QueryExpression">QueryExpression</a></code></p>

  
      <p>Table is an abstract class that represents a table in the schema.
It implements insert and delete methods and inherits query functionality.
To make it a concrete class, override the abstract properties specifying the connection,
table name, database, and definition.</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/table.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Table</span><span class="p">(</span><span class="n">QueryExpression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Table is an abstract class that represents a table in the schema.</span>
<span class="sd">    It implements insert and delete methods and inherits query functionality.</span>
<span class="sd">    To make it a concrete class, override the abstract properties specifying the connection,</span>
<span class="sd">    table name, database, and definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_table_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># must be defined in subclass</span>
    <span class="n">_log_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># placeholder for the Log table object</span>

    <span class="c1"># These properties must be set by the schema decorator (schemas.py) at class level</span>
    <span class="c1"># or by FreeTable at instance level</span>
    <span class="n">database</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">declaration_context</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Subclasses of Table must implement the `definition` property&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">declare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Declare the table in the schema based on self.definition.</span>

<span class="sd">        :param context: the context for foreign key resolution. If None, foreign keys are</span>
<span class="sd">            not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot declare new tables inside a transaction, &quot;</span>
                <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
            <span class="p">)</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># declare all external tables before declaring main table</span>
            <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
            <span class="c1"># skip if no create privilege</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Declared &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">alter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alter the table definition from self.definition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot update table declaration inside a transaction, &quot;</span>
                <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">frame</span>
        <span class="n">old_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">alter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sql</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Nothing to alter.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE </span><span class="si">{tab}</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Execute?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># declare all external tables before declaring main table</span>
                    <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                    <span class="c1"># skip if no create privilege</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># reset heading</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
                        <span class="n">table_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_info</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Table altered&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Altered &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the FROM clause of SQL SELECT statements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>

    <span class="k">def</span> <span class="nf">get_select_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the selected attributes from the SQL SELECT statement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">select_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">select_fields</span><span class="p">)</span><span class="o">.</span><span class="n">as_sql</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param primary: if None, then all parents are returned. If True, then only foreign keys composed of</span>
<span class="sd">            primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">            secondary attribute.</span>
<span class="sd">        :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">        :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">        :return: list of parents as table names or table objects</span>
<span class="sd">            with (optional) foreign key information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">parents</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param primary: if None, then all children are returned. If True, then only foreign keys composed of</span>
<span class="sd">            primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">            secondary attribute.</span>
<span class="sd">        :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">        :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">        :return: list of children as table names or table objects</span>
<span class="sd">            with (optional) foreign key information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">children</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span> <span class="nf">descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">        :return: list of tables descendants in topological order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">        :return: list of tables ancestors in topological order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return part tables either as entries in a dict with foreign key informaiton or a list of objects</span>

<span class="sd">        :param as_objects: if False (default), the output is a dict describing the foreign keys. If True, return table objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">nodes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">nodes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_declared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True is the table is declared in the schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s1">&#39;SHOW TABLES in `</span><span class="si">{database}</span><span class="s1">` LIKE &quot;</span><span class="si">{table_name}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rowcount</span>
            <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: full table name in the schema</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;`</span><span class="si">{0:s}</span><span class="s2">`.`</span><span class="si">{1:s}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span> <span class="o">=</span> <span class="n">Log</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="n">skip_logging</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">external</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span>

    <span class="k">def</span> <span class="nf">update1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ``update1`` updates one existing entry in the table.</span>
<span class="sd">        Caution: In DataJoint the primary modes for data manipulation is to ``insert`` and</span>
<span class="sd">        ``delete`` entire records since referential integrity works on the level of records,</span>
<span class="sd">        not fields. Therefore, updates are reserved for corrective operations outside of main</span>
<span class="sd">        workflow. Use UPDATE methods sparingly with full awareness of potential violations of</span>
<span class="sd">        assumptions.</span>

<span class="sd">        :param row: a ``dict`` containing the primary key values and the attributes to update.</span>
<span class="sd">            Setting an attribute value to None will reset it to the default value (if any).</span>

<span class="sd">        The primary key attributes must always be provided.</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: 3})  # update value in record with id=1</span>
<span class="sd">        &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: None})  # reset value to default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># argument validations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of update1 must be dict-like.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The argument of update1 must supply all primary key values.&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
                <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># ok</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update cannot be applied to a restricted table.&quot;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update can only be applied to one existing entry.&quot;</span><span class="p">)</span>
        <span class="c1"># UPDATE query</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">{table}</span><span class="s2"> SET </span><span class="si">{assignments}</span><span class="s2"> WHERE </span><span class="si">{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
            <span class="n">assignments</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="p">),</span>
            <span class="n">where</span><span class="o">=</span><span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">set</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>

<span class="sd">        :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="sd">            as one row.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">,</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a collection of rows.</span>

<span class="sd">        :param rows: Either (a) an iterable where an element is a numpy record, a</span>
<span class="sd">            dict-like object, a pandas.DataFrame, a sequence, or a query expression with</span>
<span class="sd">            the same heading as self, or (b) a pathlib.Path object specifying a path</span>
<span class="sd">            relative to the current directory with a CSV file, the contents of which</span>
<span class="sd">            will be inserted.</span>
<span class="sd">        :param replace: If True, replaces the existing tuple.</span>
<span class="sd">        :param skip_duplicates: If True, silently skip duplicate inserts.</span>
<span class="sd">        :param ignore_extra_fields: If False, fields that are not in the heading raise error.</span>
<span class="sd">        :param allow_direct_insert: Only applies in auto-populated tables. If False (default),</span>
<span class="sd">            insert may only be called from inside the make callback.</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; Table.insert([</span>
<span class="sd">            &gt;&gt;&gt;     dict(subject_id=7, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-01&quot;),</span>
<span class="sd">            &gt;&gt;&gt;     dict(subject_id=8, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-02&quot;)])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="c1"># drop &#39;extra&#39; synthetic index for 1-field index case -</span>
            <span class="c1"># frames with more advanced indices should be prepared by user.</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
                <span class="n">drop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

        <span class="c1"># prohibit direct inserts into auto-populated tables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_direct_insert</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_allow_insert&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Inserts into an auto-populated table can only be done inside &quot;</span>
                <span class="s2">&quot;its make method during a populate call.&quot;</span>
                <span class="s2">&quot; To override, set keyword argument allow_direct_insert=True.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
            <span class="c1"># insert from select</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Attribute </span><span class="si">%s</span><span class="s2"> not found. To ignore extra attributes in insert, &quot;</span>
                        <span class="s2">&quot;set ignore_extra_fields=True.&quot;</span>
                        <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{table}</span><span class="s2"> (</span><span class="si">{fields}</span><span class="s2">) </span><span class="si">{select}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span>
                <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
                <span class="n">select</span><span class="o">=</span><span class="n">rows</span><span class="o">.</span><span class="n">make_sql</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
                <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=</span><span class="si">{table}</span><span class="s2">.`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">skip_duplicates</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">field_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collects the field list from first row (passed by reference)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__make_row_to_insert</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{destination}</span><span class="s2">(`</span><span class="si">{fields}</span><span class="s2">`) VALUES </span><span class="si">{placeholders}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                    <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
                    <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_list</span><span class="p">),</span>
                    <span class="n">placeholders</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
                    <span class="p">),</span>
                    <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">skip_duplicates</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
                        <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">UnknownAttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                    <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">DuplicateError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                    <span class="s2">&quot;To ignore duplicate entries in insert, set skip_duplicates=True&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the table without cascading and without user prompt.</span>
<span class="sd">        If this table has populated dependent tables, this will fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT ROW_COUNT()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">get_count</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">safemode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_parts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the contents of the table and its dependent tables, recursively.</span>

<span class="sd">        Args:</span>
<span class="sd">            transaction: If `True`, use of the entire delete becomes an atomic transaction.</span>
<span class="sd">                This is the default and recommended behavior. Set to `False` if this delete is</span>
<span class="sd">                nested within another transaction.</span>
<span class="sd">            safemode: If `True`, prohibit nested transactions and prompt to confirm. Default</span>
<span class="sd">                is `dj.config[&#39;safemode&#39;]`.</span>
<span class="sd">            force_parts: Delete from parts even when not deleting from their masters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of deleted rows (excluding those from dependent tables).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DataJointError: Delete exceeds maximum number of delete attempts.</span>
<span class="sd">            DataJointError: When deleting within an existing transaction.</span>
<span class="sd">            DataJointError: Deleting a part table before its master.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">cascade</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;service function to perform cascading deletes recursively.&quot;&quot;&quot;</span>
            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">delete_count</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">foreign_key_error_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s2">&quot;`.`&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]:</span>  <span class="c1"># if schema name missing, use table</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>  <span class="c1"># fully matched, adjusting the keys</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="p">]</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># only partially matched, querying with constraint to determine keys</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="nb">map</span><span class="p">(</span>
                                <span class="nb">list</span><span class="p">,</span>
                                <span class="nb">zip</span><span class="p">(</span>
                                    <span class="o">*</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                                        <span class="n">constraint_info_query</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                                            <span class="k">match</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">),</span>
                                            <span class="o">*</span><span class="p">[</span>
                                                <span class="n">_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;`.`&quot;</span><span class="p">)</span>
                                            <span class="p">],</span>
                                        <span class="p">),</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                                <span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Restrict child by table if</span>
                    <span class="c1">#   1. if table&#39;s restriction attributes are not in child&#39;s primary key</span>
                    <span class="c1">#   2. if child renames any attributes</span>
                    <span class="c1"># Otherwise restrict child by table&#39;s restriction.</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_restriction</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]:</span>
                        <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                            <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]))</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span>
                    <span class="n">cascade</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Deleting </span><span class="si">{count}</span><span class="s2"> rows from </span><span class="si">{table}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">count</span><span class="o">=</span><span class="n">delete_count</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Exceeded maximum number of delete attempts.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">delete_count</span>

        <span class="n">safemode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">safemode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">safemode</span>

        <span class="c1"># Start transaction</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">transaction</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Delete cannot use a transaction within an ongoing transaction. &quot;</span>
                        <span class="s2">&quot;Set transaction=False or safemode=False).&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Cascading delete</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">delete_count</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">force_parts</span><span class="p">:</span>
            <span class="c1"># Avoid deleting from child before master (See issue #151)</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Attempt to delete part table </span><span class="si">{part}</span><span class="s2"> before deleting from &quot;</span>
                        <span class="s2">&quot;its master </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="c1"># Confirm and commit</span>
        <span class="k">if</span> <span class="n">delete_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Nothing to delete.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Commit deletes?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit_transaction</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deletes committed.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Deletes cancelled&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delete_count</span>

    <span class="k">def</span> <span class="nf">drop_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drops the table without cascading to dependent tables and without user prompt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DROP TABLE </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped table </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Nothing to drop: table </span><span class="si">%s</span><span class="s2"> is not declared&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop the table and all tables that reference it, recursively.</span>
<span class="sd">        User is prompted for confirmation if config[&#39;safemode&#39;] is set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;A table with an applied restriction cannot be dropped.&quot;</span>
                <span class="s2">&quot; Call drop() on the unrestricted Table.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">do_drop</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">table</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># avoid dropping part tables without their masters: See issue #374</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attempt to drop part table </span><span class="si">{part}</span><span class="s2"> before dropping &quot;</span>
                    <span class="s2">&quot;its master. Drop </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="n">table</span> <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">%d</span><span class="s2"> tuples)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">do_drop</span> <span class="o">=</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">if</span> <span class="n">do_drop</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>
                <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tables dropped. Restart kernel.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size_on_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: size of data and indices in bytes on the storage device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s1">&#39;SHOW TABLE STATUS FROM `</span><span class="si">{database}</span><span class="s1">` WHERE NAME=&quot;</span><span class="si">{table}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span>
            <span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;Data_length&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;Index_length&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">show_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;show_definition is deprecated. Use the describe method instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return:  the definition string for the query using DataJoint DDL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">frame</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">(</span><span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">in_key</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">attributes_thus_far</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">attributes_declared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">in_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">in_key</span><span class="p">:</span>
                <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">in_key</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">do_include</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">fk_props</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]:</span>
                    <span class="n">do_include</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]):</span>
                        <span class="c1"># foreign key properties</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]))</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">index_props</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                            <span class="n">index_props</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot; [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_props</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">index_props</span>
                                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;aliased&quot;</span><span class="p">]:</span>
                            <span class="c1"># simple foreign key</span>
                            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># projected foreign key</span>
                            <span class="n">definition</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="s2">.proj(</span><span class="si">{proj_list}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                    <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                    <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                                    <span class="n">proj_list</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                        <span class="k">if</span> <span class="n">ref</span> <span class="o">!=</span> <span class="n">attr</span>
                                    <span class="p">),</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">attributes_declared</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">do_include</span><span class="p">:</span>
                <span class="n">attributes_declared</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> : </span><span class="si">%-28s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span><span class="p">),</span>
                    <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot; auto_increment&quot;</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="c1"># add remaining indexes</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{unique}</span><span class="s2">INDEX (</span><span class="si">{attrs}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;UNIQUE &quot;</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;unique&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">printout</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">definition</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">definition</span>

    <span class="c1"># --- private helper functions ----</span>
    <span class="k">def</span> <span class="nf">__make_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a given attribute `name` with `value`, return its processed value or value placeholder</span>
<span class="sd">        as a string to be included in the query and the value, if any, to be submitted for</span>
<span class="sd">        processing by mysql API.</span>

<span class="sd">        :param name:  name of attribute to be inserted</span>
<span class="sd">        :param value: value of attribute to be inserted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ignore_extra_fields</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">adapter</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">numeric</span> <span class="ow">and</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)))):</span>
            <span class="c1"># set default value</span>
            <span class="n">placeholder</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># not NULL</span>
            <span class="n">placeholder</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                            <span class="s2">&quot;badly formed UUID value </span><span class="si">{v}</span><span class="s2"> for attribute `</span><span class="si">{n}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">v</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">name</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">bytes</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_blob</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">blob</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_external</span>
                    <span class="k">else</span> <span class="n">value</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_attachment</span><span class="p">:</span>
                <span class="n">attachment_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_external</span><span class="p">:</span>
                    <span class="c1"># value is hash of contents</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">upload_attachment</span><span class="p">(</span><span class="n">attachment_path</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">bytes</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># value is filename + contents</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">attachment_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="n">attachment_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">is_filepath</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">upload_filepath</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">numeric</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__make_row_to_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function for insert and update</span>

<span class="sd">        :param row:  A tuple to insert</span>
<span class="sd">        :return: a dict with fields &#39;names&#39;, &#39;placeholders&#39;, &#39;values&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">check_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Validates that all items in `fields` are valid attributes in the heading</span>

<span class="sd">            :param fields: field names of a tuple</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                <span class="s2">&quot;`</span><span class="si">{0:s}</span><span class="s2">` is not in the table heading&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                            <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">field_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Attempt to insert rows with different fields.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">):</span>  <span class="c1"># np.array</span>
            <span class="n">check_fields</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>  <span class="c1"># dict-based</span>
            <span class="n">check_fields</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">row</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># positional</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Invalid insert argument. Incorrect number of attributes: &quot;</span>
                        <span class="s2">&quot;</span><span class="si">{given}</span><span class="s2"> given; </span><span class="si">{expected}</span><span class="s2"> expected&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">given</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">expected</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Datatype </span><span class="si">%s</span><span class="s2"> cannot be inserted&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
                <span class="p">]</span>
        <span class="k">if</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">),</span> <span class="s2">&quot;Empty tuple&quot;</span>
        <span class="n">row_to_insert</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="s2">&quot;placeholders&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">),</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">attributes</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">field_list</span><span class="p">:</span>
            <span class="c1"># first row sets the composition of the field list</span>
            <span class="n">field_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#  reorder attributes in row_to_insert to match field_list</span>
            <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">field_list</span><span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span>
            <span class="p">)</span>
            <span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_to_insert</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row_to_insert</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.declare" class="doc doc-heading">
<code class="highlight language-python"><span class="n">declare</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.declare" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Declare the table in the schema based on self.definition.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>context</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the context for foreign key resolution. If None, foreign keys are not allowed.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">declare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Declare the table in the schema based on self.definition.</span>

<span class="sd">    :param context: the context for foreign key resolution. If None, foreign keys are</span>
<span class="sd">        not allowed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot declare new tables inside a transaction, &quot;</span>
            <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
        <span class="p">)</span>
    <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">declare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># declare all external tables before declaring main table</span>
        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
        <span class="c1"># skip if no create privilege</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Declared &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.alter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">alter</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.alter" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Alter the table definition from self.definition</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">alter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Alter the table definition from self.definition</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot update table declaration inside a transaction, &quot;</span>
            <span class="s2">&quot;e.g. from inside a populate/make call&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">frame</span>
    <span class="n">old_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="n">sql</span><span class="p">,</span> <span class="n">external_stores</span> <span class="o">=</span> <span class="n">alter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sql</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Nothing to alter.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE </span><span class="si">{tab}</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">tab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Execute?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># declare all external tables before declaring main table</span>
                <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">external_stores</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">]</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="n">store</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AccessError</span><span class="p">:</span>
                <span class="c1"># skip if no create privilege</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reset heading</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
                    <span class="n">table_info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_info</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">prompt</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Table altered&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="s2">&quot;Altered &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.from_clause" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_clause</span><span class="p">()</span></code>

<a href="#datajoint.table.Table.from_clause" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the FROM clause of SQL SELECT statements.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_clause</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the FROM clause of SQL SELECT statements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.get_select_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_select_fields</span><span class="p">(</span><span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.get_select_fields" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the selected attributes from the SQL SELECT statement.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_select_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the selected attributes from the SQL SELECT statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;*&quot;</span> <span class="k">if</span> <span class="n">select_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">select_fields</span><span class="p">)</span><span class="o">.</span><span class="n">as_sql</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.parents" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parents</span><span class="p">(</span><span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.parents" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>primary</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if None, then all parents are returned. If True, then only foreign keys composed of primary key attributes are considered.  If False, return foreign keys including at least one secondary attribute.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>as_objects</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if False, return table names. If True, return table objects.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>foreign_key_info</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if True, each element in result also includes foreign key info.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of parents as table names or table objects with (optional) foreign key information.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param primary: if None, then all parents are returned. If True, then only foreign keys composed of</span>
<span class="sd">        primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">        secondary attribute.</span>
<span class="sd">    :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">    :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">    :return: list of parents as table names or table objects</span>
<span class="sd">        with (optional) foreign key information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">parents</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.children" class="doc doc-heading">
<code class="highlight language-python"><span class="n">children</span><span class="p">(</span><span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.children" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>primary</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if None, then all children are returned. If True, then only foreign keys composed of primary key attributes are considered.  If False, return foreign keys including at least one secondary attribute.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>as_objects</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if False, return table names. If True, return table objects.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>foreign_key_info</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if True, each element in result also includes foreign key info.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of children as table names or table objects with (optional) foreign key information.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param primary: if None, then all children are returned. If True, then only foreign keys composed of</span>
<span class="sd">        primary key attributes are considered.  If False, return foreign keys including at least one</span>
<span class="sd">        secondary attribute.</span>
<span class="sd">    :param as_objects: if False, return table names. If True, return table objects.</span>
<span class="sd">    :param foreign_key_info: if True, each element in result also includes foreign key info.</span>
<span class="sd">    :return: list of children as table names or table objects</span>
<span class="sd">        with (optional) foreign key information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">children</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">get_edge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">primary</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">as_objects</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">props</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">foreign_key_info</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.descendants" class="doc doc-heading">
<code class="highlight language-python"><span class="n">descendants</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.descendants" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>as_objects</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>False - a list of table names; True - a list of table objects.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of tables descendants in topological order.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">    :return: list of tables descendants in topological order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.ancestors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ancestors</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.ancestors" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>as_objects</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>False - a list of table names; True - a list of table objects.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of tables ancestors in topological order.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param as_objects: False - a list of table names; True - a list of table objects.</span>
<span class="sd">    :return: list of tables ancestors in topological order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.parts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parts</span><span class="p">(</span><span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.parts" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>return part tables either as entries in a dict with foreign key informaiton or a list of objects</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>as_objects</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if False (default), the output is a dict describing the foreign keys. If True, return table objects.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return part tables either as entries in a dict with foreign key informaiton or a list of objects</span>

<span class="sd">    :param as_objects: if False (default), the output is a dict describing the foreign keys. If True, return table objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">node</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">nodes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;__&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span> <span class="k">if</span> <span class="n">as_objects</span> <span class="k">else</span> <span class="n">nodes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.table.Table.is_declared" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_declared</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.table.Table.is_declared" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True is the table is declared in the schema.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.table.Table.full_table_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">full_table_name</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.table.Table.full_table_name" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>full table name in the schema</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.update1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update1</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.update1" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p><code>update1</code> updates one existing entry in the table.
Caution: In DataJoint the primary modes for data manipulation is to <code>insert</code> and
<code>delete</code> entire records since referential integrity works on the level of records,
not fields. Therefore, updates are reserved for corrective operations outside of main
workflow. Use UPDATE methods sparingly with full awareness of potential violations of
assumptions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>row</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a <code>dict</code> containing the primary key values and the attributes to update. Setting an attribute value to None will reset it to the default value (if any).  The primary key attributes must always be provided.  Examples:  &gt;&gt;&gt; table.update1({'id': 1, 'value': 3})  # update value in record with id=1 &gt;&gt;&gt; table.update1({'id': 1, 'value': None})  # reset value to default</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``update1`` updates one existing entry in the table.</span>
<span class="sd">    Caution: In DataJoint the primary modes for data manipulation is to ``insert`` and</span>
<span class="sd">    ``delete`` entire records since referential integrity works on the level of records,</span>
<span class="sd">    not fields. Therefore, updates are reserved for corrective operations outside of main</span>
<span class="sd">    workflow. Use UPDATE methods sparingly with full awareness of potential violations of</span>
<span class="sd">    assumptions.</span>

<span class="sd">    :param row: a ``dict`` containing the primary key values and the attributes to update.</span>
<span class="sd">        Setting an attribute value to None will reset it to the default value (if any).</span>

<span class="sd">    The primary key attributes must always be provided.</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: 3})  # update value in record with id=1</span>
<span class="sd">    &gt;&gt;&gt; table.update1({&#39;id&#39;: 1, &#39;value&#39;: None})  # reset value to default</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># argument validations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;The argument of update1 must be dict-like.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;The argument of update1 must supply all primary key values.&quot;</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Attribute `</span><span class="si">%s</span><span class="s2">` not found.&quot;</span>
            <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># ok</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update cannot be applied to a restricted table.&quot;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Update can only be applied to one existing entry.&quot;</span><span class="p">)</span>
    <span class="c1"># UPDATE query</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_placeholder</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
    <span class="p">]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE </span><span class="si">{table}</span><span class="s2"> SET </span><span class="si">{assignments}</span><span class="s2"> WHERE </span><span class="si">{where}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
        <span class="n">assignments</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="p">),</span>
        <span class="n">where</span><span class="o">=</span><span class="n">make_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">set</span><span class="p">()),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.insert1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert1</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.insert1" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Insert one data record into the table. For <code>kwargs</code>, see <code>insert()</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>row</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a numpy record, a dict-like object, or an ordered sequence to be inserted as one row.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert one data record into the table. For ``kwargs``, see ``insert()``.</span>

<span class="sd">    :param row: a numpy record, a dict-like object, or an ordered sequence to be inserted</span>
<span class="sd">        as one row.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">((</span><span class="n">row</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.insert" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.insert" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Insert a collection of rows.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>rows</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Either (a) an iterable where an element is a numpy record, a dict-like object, a pandas.DataFrame, a sequence, or a query expression with the same heading as self, or (b) a pathlib.Path object specifying a path relative to the current directory with a CSV file, the contents of which will be inserted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>replace</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, replaces the existing tuple.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>skip_duplicates</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, silently skip duplicate inserts.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>ignore_extra_fields</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If False, fields that are not in the heading raise error.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>allow_direct_insert</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Only applies in auto-populated tables. If False (default), insert may only be called from inside the make callback.  Example:  &gt;&gt;&gt; Table.insert([ &gt;&gt;&gt;     dict(subject_id=7, species="mouse", date_of_birth="2014-09-01"), &gt;&gt;&gt;     dict(subject_id=8, species="mouse", date_of_birth="2014-09-02")])</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">rows</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert a collection of rows.</span>

<span class="sd">    :param rows: Either (a) an iterable where an element is a numpy record, a</span>
<span class="sd">        dict-like object, a pandas.DataFrame, a sequence, or a query expression with</span>
<span class="sd">        the same heading as self, or (b) a pathlib.Path object specifying a path</span>
<span class="sd">        relative to the current directory with a CSV file, the contents of which</span>
<span class="sd">        will be inserted.</span>
<span class="sd">    :param replace: If True, replaces the existing tuple.</span>
<span class="sd">    :param skip_duplicates: If True, silently skip duplicate inserts.</span>
<span class="sd">    :param ignore_extra_fields: If False, fields that are not in the heading raise error.</span>
<span class="sd">    :param allow_direct_insert: Only applies in auto-populated tables. If False (default),</span>
<span class="sd">        insert may only be called from inside the make callback.</span>

<span class="sd">    Example:</span>

<span class="sd">        &gt;&gt;&gt; Table.insert([</span>
<span class="sd">        &gt;&gt;&gt;     dict(subject_id=7, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-01&quot;),</span>
<span class="sd">        &gt;&gt;&gt;     dict(subject_id=8, species=&quot;mouse&quot;, date_of_birth=&quot;2014-09-02&quot;)])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="c1"># drop &#39;extra&#39; synthetic index for 1-field index case -</span>
        <span class="c1"># frames with more advanced indices should be prepared by user.</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
            <span class="n">drop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

    <span class="c1"># prohibit direct inserts into auto-populated tables</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_direct_insert</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_allow_insert&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Inserts into an auto-populated table can only be done inside &quot;</span>
            <span class="s2">&quot;its make method during a populate call.&quot;</span>
            <span class="s2">&quot; To override, set keyword argument allow_direct_insert=True.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">()</span>  <span class="c1"># instantiate if a class</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="c1"># insert from select</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_extra_fields</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attribute </span><span class="si">%s</span><span class="s2"> not found. To ignore extra attributes in insert, &quot;</span>
                    <span class="s2">&quot;set ignore_extra_fields=True.&quot;</span>
                    <span class="o">%</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rows</span><span class="o">.</span><span class="n">heading</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{table}</span><span class="s2"> (</span><span class="si">{fields}</span><span class="s2">) </span><span class="si">{select}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span>
            <span class="n">select</span><span class="o">=</span><span class="n">rows</span><span class="o">.</span><span class="n">make_sql</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span>
            <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=</span><span class="si">{table}</span><span class="s2">.`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">skip_duplicates</span>
                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">field_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collects the field list from first row (passed by reference)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__make_row_to_insert</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">field_list</span><span class="p">,</span> <span class="n">ignore_extra_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{command}</span><span class="s2"> INTO </span><span class="si">{destination}</span><span class="s2">(`</span><span class="si">{fields}</span><span class="s2">`) VALUES </span><span class="si">{placeholders}{duplicate}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">command</span><span class="o">=</span><span class="s2">&quot;REPLACE&quot;</span> <span class="k">if</span> <span class="n">replace</span> <span class="k">else</span> <span class="s2">&quot;INSERT&quot;</span><span class="p">,</span>
                <span class="n">destination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_clause</span><span class="p">(),</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_list</span><span class="p">),</span>
                <span class="n">placeholders</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;placeholders&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
                <span class="p">),</span>
                <span class="n">duplicate</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot; ON DUPLICATE KEY UPDATE `</span><span class="si">{pk}</span><span class="s2">`=`</span><span class="si">{pk}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">skip_duplicates</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
                    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">UnknownAttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                <span class="s2">&quot;To ignore extra fields in insert, set ignore_extra_fields=True&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span><span class="o">.</span><span class="n">suggest</span><span class="p">(</span>
                <span class="s2">&quot;To ignore duplicate entries in insert, set skip_duplicates=True&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.delete_quick" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.delete_quick" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Deletes the table without cascading and without user prompt.
If this table has populated dependent tables, this will fail.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes the table without cascading and without user prompt.</span>
<span class="sd">    If this table has populated dependent tables, this will fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">where_clause</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT ROW_COUNT()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">get_count</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.delete" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">transaction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">safemode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_parts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.delete" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Deletes the contents of the table and its dependent tables, recursively.</p>
<p>Args:
    transaction: If <code>True</code>, use of the entire delete becomes an atomic transaction.
        This is the default and recommended behavior. Set to <code>False</code> if this delete is
        nested within another transaction.
    safemode: If <code>True</code>, prohibit nested transactions and prompt to confirm. Default
        is <code>dj.config['safemode']</code>.
    force_parts: Delete from parts even when not deleting from their masters.</p>
<p>Returns:
    Number of deleted rows (excluding those from dependent tables).</p>
<p>Raises:
    DataJointError: Delete exceeds maximum number of delete attempts.
    DataJointError: When deleting within an existing transaction.
    DataJointError: Deleting a part table before its master.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">safemode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">force_parts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes the contents of the table and its dependent tables, recursively.</span>

<span class="sd">    Args:</span>
<span class="sd">        transaction: If `True`, use of the entire delete becomes an atomic transaction.</span>
<span class="sd">            This is the default and recommended behavior. Set to `False` if this delete is</span>
<span class="sd">            nested within another transaction.</span>
<span class="sd">        safemode: If `True`, prohibit nested transactions and prompt to confirm. Default</span>
<span class="sd">            is `dj.config[&#39;safemode&#39;]`.</span>
<span class="sd">        force_parts: Delete from parts even when not deleting from their masters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of deleted rows (excluding those from dependent tables).</span>

<span class="sd">    Raises:</span>
<span class="sd">        DataJointError: Delete exceeds maximum number of delete attempts.</span>
<span class="sd">        DataJointError: When deleting within an existing transaction.</span>
<span class="sd">        DataJointError: Deleting a part table before its master.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deleted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cascade</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;service function to perform cascading deletes recursively.&quot;&quot;&quot;</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">delete_count</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">foreign_key_error_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;`.`&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]:</span>  <span class="c1"># if schema name missing, use table</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># fully matched, adjusting the keys</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># only partially matched, querying with constraint to determine keys</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">map</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">,</span>
                            <span class="nb">zip</span><span class="p">(</span>
                                <span class="o">*</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                                    <span class="n">constraint_info_query</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                                        <span class="k">match</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">),</span>
                                        <span class="o">*</span><span class="p">[</span>
                                            <span class="n">_</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span>
                                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;`.`&quot;</span><span class="p">)</span>
                                        <span class="p">],</span>
                                    <span class="p">),</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Restrict child by table if</span>
                <span class="c1">#   1. if table&#39;s restriction attributes are not in child&#39;s primary key</span>
                <span class="c1">#   2. if child renames any attributes</span>
                <span class="c1"># Otherwise restrict child by table&#39;s restriction.</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">FreeTable</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;child&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">restriction_attributes</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">_restriction</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_restriction</span>
                <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]:</span>
                    <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span>
                        <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="s2">&quot;fk_attrs&quot;</span><span class="p">],</span> <span class="n">match</span><span class="p">[</span><span class="s2">&quot;pk_attrs&quot;</span><span class="p">]))</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">&amp;=</span> <span class="n">table</span><span class="o">.</span><span class="n">proj</span><span class="p">()</span>
                <span class="n">cascade</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">deleted</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Deleting </span><span class="si">{count}</span><span class="s2"> rows from </span><span class="si">{table}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">count</span><span class="o">=</span><span class="n">delete_count</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">full_table_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Exceeded maximum number of delete attempts.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delete_count</span>

    <span class="n">safemode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">safemode</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">safemode</span>

    <span class="c1"># Start transaction</span>
    <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">in_transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">transaction</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Delete cannot use a transaction within an ongoing transaction. &quot;</span>
                    <span class="s2">&quot;Set transaction=False or safemode=False).&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Cascading delete</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">delete_count</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
        <span class="k">raise</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force_parts</span><span class="p">:</span>
        <span class="c1"># Avoid deleting from child before master (See issue #151)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
            <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">deleted</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Attempt to delete part table </span><span class="si">{part}</span><span class="s2"> before deleting from &quot;</span>
                    <span class="s2">&quot;its master </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># Confirm and commit</span>
    <span class="k">if</span> <span class="n">delete_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Nothing to delete.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">safemode</span> <span class="ow">or</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Commit deletes?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">commit_transaction</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deletes committed.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cancel_transaction</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">safemode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Deletes cancelled&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delete_count</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.drop_quick" class="doc doc-heading">
<code class="highlight language-python"><span class="n">drop_quick</span><span class="p">()</span></code>

<a href="#datajoint.table.Table.drop_quick" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Drops the table without cascading to dependent tables and without user prompt.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drop_quick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drops the table without cascading to dependent tables and without user prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;DROP TABLE </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped table </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Nothing to drop: table </span><span class="si">%s</span><span class="s2"> is not declared&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.drop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">drop</span><span class="p">()</span></code>

<a href="#datajoint.table.Table.drop" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Drop the table and all tables that reference it, recursively.
User is prompted for confirmation if config['safemode'] is set to True.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop the table and all tables that reference it, recursively.</span>
<span class="sd">    User is prompted for confirmation if config[&#39;safemode&#39;] is set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restriction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;A table with an applied restriction cannot be dropped.&quot;</span>
            <span class="s2">&quot; Call drop() on the unrestricted Table.&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">do_drop</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">table</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="c1"># avoid dropping part tables without their masters: See issue #374</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
        <span class="n">master</span> <span class="o">=</span> <span class="n">get_master</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">master</span> <span class="ow">and</span> <span class="n">master</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;Attempt to drop part table </span><span class="si">{part}</span><span class="s2"> before dropping &quot;</span>
                <span class="s2">&quot;its master. Drop </span><span class="si">{master}</span><span class="s2"> first.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">part</span><span class="o">=</span><span class="n">part</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="n">master</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;safemode&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="n">table</span> <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">%d</span><span class="s2"> tuples)&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">do_drop</span> <span class="o">=</span> <span class="n">user_choice</span><span class="p">(</span><span class="s2">&quot;Proceed?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
    <span class="k">if</span> <span class="n">do_drop</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tables</span><span class="p">):</span>
            <span class="n">FreeTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tables dropped. Restart kernel.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-attribute">



<h3 id="datajoint.table.Table.size_on_disk" class="doc doc-heading">
<code class="highlight language-python"><span class="n">size_on_disk</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.table.Table.size_on_disk" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>size of data and indices in bytes on the storage device</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Table.describe" class="doc doc-heading">
<code class="highlight language-python"><span class="n">describe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#datajoint.table.Table.describe" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the definition string for the query using DataJoint DDL.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return:  the definition string for the query using DataJoint DDL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">,</span> <span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">frame</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">(</span><span class="n">foreign_key_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">in_key</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">attributes_thus_far</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">attributes_declared</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">in_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">in_key</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">in_key</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">do_include</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">fk_props</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]:</span>
                <span class="n">do_include</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">attributes_thus_far</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]):</span>
                    <span class="c1"># foreign key properties</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">index_props</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
                        <span class="n">index_props</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot; [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_props</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">index_props</span>
                            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;aliased&quot;</span><span class="p">]:</span>
                        <span class="c1"># simple foreign key</span>
                        <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                            <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># projected foreign key</span>
                        <span class="n">definition</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="s2">&quot;-&gt;</span><span class="si">{props}</span><span class="s2"> </span><span class="si">{class_name}</span><span class="s2">.proj(</span><span class="si">{proj_list}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">props</span><span class="o">=</span><span class="n">index_props</span><span class="p">,</span>
                                <span class="n">class_name</span><span class="o">=</span><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="n">parent_name</span><span class="p">,</span>
                                <span class="n">proj_list</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="n">ref</span> <span class="o">!=</span> <span class="n">attr</span>
                                <span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">attributes_declared</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk_props</span><span class="p">[</span><span class="s2">&quot;attr_map&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">do_include</span><span class="p">:</span>
            <span class="n">attributes_declared</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> : </span><span class="si">%-28s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">default</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot; auto_increment&quot;</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">comment</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="c1"># add remaining indexes</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">definition</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{unique}</span><span class="s2">INDEX (</span><span class="si">{attrs}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">unique</span><span class="o">=</span><span class="s2">&quot;UNIQUE &quot;</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;unique&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">printout</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">definition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">definition</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.AccessError" class="doc doc-heading">
        <code>AccessError</code>


<a href="#datajoint.table.AccessError" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.errors.QueryError" href="../errors/#datajoint.errors.QueryError">QueryError</a></code></p>

  
      <p>User access error: insufficient privileges.</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/errors.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AccessError</span><span class="p">(</span><span class="n">QueryError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    User access error: insufficient privileges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.DuplicateError" class="doc doc-heading">
        <code>DuplicateError</code>


<a href="#datajoint.table.DuplicateError" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.errors.QueryError" href="../errors/#datajoint.errors.QueryError">QueryError</a></code></p>

  
      <p>An integrity error caused by a duplicate entry into a unique key</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/errors.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DuplicateError</span><span class="p">(</span><span class="n">QueryError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An integrity error caused by a duplicate entry into a unique key</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.IntegrityError" class="doc doc-heading">
        <code>IntegrityError</code>


<a href="#datajoint.table.IntegrityError" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.errors.QueryError" href="../errors/#datajoint.errors.QueryError">QueryError</a></code></p>

  
      <p>An integrity error triggered by foreign key constraints</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/errors.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IntegrityError</span><span class="p">(</span><span class="n">QueryError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An integrity error triggered by foreign key constraints</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.Heading" class="doc doc-heading">
        <code>Heading</code>


<a href="#datajoint.table.Heading" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">

  
      <p>Local class for table headings.
Heading contains the property attributes, which is an dict in which the keys are
the attribute names and the values are Attributes.</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/heading.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Heading</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Local class for table headings.</span>
<span class="sd">    Heading contains the property attributes, which is an dict in which the keys are</span>
<span class="sd">    the attribute names and the values are Attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_specs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param attribute_specs: a list of dicts with the same keys as Attribute</span>
<span class="sd">        :param table_info: a dict with information to load the heading from the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_info</span> <span class="o">=</span> <span class="n">table_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span>
            <span class="k">if</span> <span class="n">attribute_specs</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="nb">dict</span><span class="p">((</span><span class="n">q</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">Attribute</span><span class="p">(</span><span class="o">**</span><span class="n">q</span><span class="p">))</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">attribute_specs</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_database</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_status</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_database</span><span class="p">()</span>  <span class="c1"># lazy loading from database</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">in_key</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">secondary_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">in_key</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">blobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">is_blob</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">non_blobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">k</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">is_blob</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">is_attachment</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">is_filepath</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">new_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">attribute_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;shortcut to the attribute&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return:  heading representation in DataJoint declaration format but without foreign key expansion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">in_key</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;# &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_status</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">in_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">in_key</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">in_key</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%-20s</span><span class="s2"> : </span><span class="si">%-28s</span><span class="s2"> # </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">v</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot;auto_increment&quot;</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">v</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_autoincrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">autoincrement</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">as_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        represent the heading as a numpy dtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        represent heading as the SQL SELECT clause.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span>
            <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; as `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">if</span> <span class="n">include_aliases</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_from_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initialize heading from an existing database table.&quot;&quot;&quot;</span>
        <span class="n">conn</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_info</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;conn&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="s2">&quot;table_name&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s1">&#39;SHOW TABLE STATUS FROM `</span><span class="si">{database}</span><span class="s1">` WHERE name=&quot;</span><span class="si">{table_name}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
            <span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="s2">&quot;~log&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not create the ~log table&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                <span class="s2">&quot;The table `</span><span class="si">{database}</span><span class="s2">`.`</span><span class="si">{table_name}</span><span class="s2">` is not defined.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_status</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;SHOW FULL COLUMNS FROM `</span><span class="si">{table_name}</span><span class="s2">` IN `</span><span class="si">{database}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
            <span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="n">rename_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Field&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Null&quot;</span><span class="p">:</span> <span class="s2">&quot;nullable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="s2">&quot;in_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Comment&quot;</span><span class="p">:</span> <span class="s2">&quot;comment&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">fields_to_drop</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Privileges&quot;</span><span class="p">,</span> <span class="s2">&quot;Collation&quot;</span><span class="p">)</span>

        <span class="c1"># rename and drop attributes</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="n">rename_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">rename_map</span> <span class="k">else</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields_to_drop</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">attributes</span>
        <span class="p">]</span>
        <span class="n">numeric_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;tinyint&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;tinyint&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;smallint&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;smallint&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;mediumint&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;mediumint&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
            <span class="p">(</span><span class="s2">&quot;bigint&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">sql_literals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CURRENT_TIMESTAMP&quot;</span><span class="p">]</span>

        <span class="c1"># additional attribute properties</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">in_key</span><span class="o">=</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;in_key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PRI&quot;</span><span class="p">),</span>
                <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                <span class="n">nullable</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span><span class="p">,</span>
                <span class="n">autoincrement</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;auto_increment&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;Extra&quot;</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">numeric</span><span class="o">=</span><span class="nb">any</span><span class="p">(</span>
                    <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DECIMAL&quot;</span><span class="p">,</span> <span class="s2">&quot;INTEGER&quot;</span><span class="p">,</span> <span class="s2">&quot;FLOAT&quot;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="nb">any</span><span class="p">(</span>
                    <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ENUM&quot;</span><span class="p">,</span> <span class="s2">&quot;TEMPORAL&quot;</span><span class="p">,</span> <span class="s2">&quot;STRING&quot;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">is_blob</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="s2">&quot;INTERNAL_BLOB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])),</span>
                <span class="n">uuid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="s2">&quot;JSON&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])),</span>
                <span class="n">is_attachment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">is_filepath</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">adapter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">store</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">is_external</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">attribute_expression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;INTEGER&quot;</span><span class="p">,</span> <span class="s2">&quot;FLOAT&quot;</span><span class="p">)):</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;\(\d+\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>  <span class="c1"># strip size off integers and floats</span>
            <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;unsupported&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;is_blob&quot;</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;numeric&quot;</span><span class="p">],</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;numeric&quot;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">attr</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Extra&quot;</span><span class="p">)</span>

            <span class="c1"># process custom DataJoint types</span>
            <span class="n">special</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;:(?P&lt;type&gt;[^:]+):(?P&lt;comment&gt;.*)&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">special</span><span class="p">:</span>
                <span class="n">special</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">special</span><span class="p">)</span>
            <span class="c1"># process adapted attribute types</span>
            <span class="k">if</span> <span class="n">special</span> <span class="ow">and</span> <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="s2">&quot;ADAPTED&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]):</span>
                <span class="k">assert</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Declaration context is not set&quot;</span>
                <span class="n">adapter_name</span> <span class="o">=</span> <span class="n">special</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adapter</span><span class="o">=</span><span class="n">get_adapter</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">adapter_name</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">DataJointError</span><span class="p">:</span>
                    <span class="c1"># if no adapter, then delay the error until the first invocation</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adapter</span><span class="o">=</span><span class="n">AttributeAdapter</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;adapter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">TYPE_PATTERN</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                            <span class="s2">&quot;Invalid attribute type &#39;</span><span class="si">{type}</span><span class="s2">&#39; in adapter object &lt;</span><span class="si">{adapter_name}</span><span class="s2">&gt;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">adapter_name</span><span class="o">=</span><span class="n">adapter_name</span><span class="p">,</span> <span class="o">**</span><span class="n">attr</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">special</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">NATIVE_TYPES</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">special</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">SPECIAL_TYPES</span> <span class="k">if</span> <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;external&quot;</span><span class="p">):</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;https://docs.datajoint.io/python/admin/5-blob-config.html&quot;</span>
                            <span class="s2">&quot;#migration-between-datajoint-v0-11-and-v0-12&quot;</span>
                        <span class="p">)</span>
                        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                            <span class="s2">&quot;Legacy datatype `</span><span class="si">{type}</span><span class="s2">`. Migrate your external stores to &quot;</span>
                            <span class="s2">&quot;datajoint 0.12: </span><span class="si">{url}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">attr</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Unknown attribute type `</span><span class="si">{type}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">attr</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;FILEPATH&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_support_filepath_types</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        The filepath data type is disabled until complete validation.</span>
<span class="sd">                        To turn it on as experimental feature, set the environment variable</span>
<span class="sd">                        {env} = TRUE or upgrade datajoint.</span>
<span class="sd">                        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">FILEPATH_FEATURE_SWITCH</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">unsupported</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">is_attachment</span><span class="o">=</span><span class="n">category</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;INTERNAL_ATTACH&quot;</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL_ATTACH&quot;</span><span class="p">),</span>
                    <span class="n">is_filepath</span><span class="o">=</span><span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;FILEPATH&quot;</span><span class="p">,</span>
                    <span class="c1"># INTERNAL_BLOB is not a custom type but is included for completeness</span>
                    <span class="n">is_blob</span><span class="o">=</span><span class="n">category</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;INTERNAL_BLOB&quot;</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL_BLOB&quot;</span><span class="p">),</span>
                    <span class="n">uuid</span><span class="o">=</span><span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;UUID&quot;</span><span class="p">,</span>
                    <span class="n">is_external</span><span class="o">=</span><span class="n">category</span> <span class="ow">in</span> <span class="n">EXTERNAL_TYPES</span><span class="p">,</span>
                    <span class="n">store</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">EXTERNAL_TYPES</span>
                    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;in_key&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;is_blob&quot;</span><span class="p">],</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;is_attachment&quot;</span><span class="p">],</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;is_filepath&quot;</span><span class="p">],</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                    <span class="s2">&quot;Json, Blob, attachment, or filepath attributes are not allowed in the primary key&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sql_literals</span>
            <span class="p">):</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]:</span>  <span class="c1"># nullable fields always default to null</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>

            <span class="c1"># fill out dtype. All floats and non-nullable integers are turned into specific dtypes</span>
            <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span>
            <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;numeric&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;adapter&quot;</span><span class="p">]:</span>
                <span class="n">is_integer</span> <span class="o">=</span> <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="s2">&quot;INTEGER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="n">is_float</span> <span class="o">=</span> <span class="n">TYPE_PATTERN</span><span class="p">[</span><span class="s2">&quot;FLOAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">is_integer</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">is_float</span><span class="p">:</span>
                    <span class="n">is_unsigned</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;sunsigned&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">))</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>  <span class="c1"># remove parentheses</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; unsigned$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># remove unsigned</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">is_unsigned</span><span class="p">)</span> <span class="ow">in</span> <span class="n">numeric_types</span><span class="p">,</span> <span class="p">(</span>
                        <span class="s2">&quot;dtype not found for type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span>
                    <span class="p">)</span>
                    <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numeric_types</span><span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">is_unsigned</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;adapter&quot;</span><span class="p">]:</span>
                <span class="c1"># restore adapted type name</span>
                <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adapter_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(((</span><span class="n">q</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">Attribute</span><span class="p">(</span><span class="o">**</span><span class="n">q</span><span class="p">))</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">))</span>

        <span class="c1"># Read and tabulate secondary indexes</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s2">&quot;SHOW KEYS FROM `</span><span class="si">{db}</span><span class="s2">`.`</span><span class="si">{tab}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">table_name</span><span class="p">),</span>
            <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;Key_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;PRIMARY&quot;</span><span class="p">:</span>
                <span class="n">keys</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Key_name&quot;</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Seq_in_index&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">column</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Column_name&quot;</span><span class="p">]</span>
                    <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;Expression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">),</span>
                    <span class="n">unique</span><span class="o">=</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Non_unique&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">nullable</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Null&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;column&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">unique</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;unique&quot;</span><span class="p">],</span>
                <span class="n">nullable</span><span class="o">=</span><span class="nb">any</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">keys</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_list</span><span class="p">,</span> <span class="n">rename_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        derive a new heading by selecting, renaming, or computing attributes.</span>
<span class="sd">        In relational algebra these operators are known as project, rename, and extend.</span>

<span class="sd">        :param select_list:  the full list of existing attributes to include</span>
<span class="sd">        :param rename_map:  dictionary of renamed attributes: keys=new names, values=old names</span>
<span class="sd">        :param compute_map: a direction of computed attributes</span>
<span class="sd">        This low-level method performs no error checking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rename_map</span> <span class="o">=</span> <span class="n">rename_map</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">compute_map</span> <span class="o">=</span> <span class="n">compute_map</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">copy_attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">select_list</span><span class="p">:</span>
                <span class="n">copy_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">())</span>
            <span class="n">copy_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span>
                        <span class="n">attribute_expression</span><span class="o">=</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">old_name</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">old_name</span> <span class="o">==</span> <span class="n">name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">compute_attrs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">default_attribute_properties</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span> <span class="n">attribute_expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">compute_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">copy_attrs</span><span class="p">,</span> <span class="n">compute_attrs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Join two headings into a new one.</span>
<span class="sd">        It assumes that self and other are headings that share no common dependent attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span>
                <span class="n">other</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
            <span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_attributes</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
            <span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span>
                <span class="n">other</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">secondary_attributes</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new heading with the specified primary key.</span>
<span class="sd">        This low-level method performs no error checking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">chain</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">in_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">primary_key</span>
                <span class="p">),</span>
                <span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">in_key</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primary_key</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_subquery_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new heading with removed attribute sql_expressions.</span>
<span class="sd">        Used by subqueries, which resolve the sql_expressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">attribute_expression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="datajoint.heading.Heading.as_dtype" class="doc doc-heading">
<code class="highlight language-python"><span class="n">as_dtype</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#datajoint.heading.Heading.as_dtype" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>represent the heading as a numpy dtype</p>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.heading.Heading.as_sql" class="doc doc-heading">
<code class="highlight language-python"><span class="n">as_sql</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#datajoint.heading.Heading.as_sql" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>represent heading as the SQL SELECT clause.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/heading.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    represent heading as the SQL SELECT clause.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">attribute_expression</span>
        <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; as `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">if</span> <span class="n">include_aliases</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.heading.Heading.select" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select</span><span class="p">(</span><span class="n">select_list</span><span class="p">,</span> <span class="n">rename_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_map</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#datajoint.heading.Heading.select" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>derive a new heading by selecting, renaming, or computing attributes.
In relational algebra these operators are known as project, rename, and extend.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>select_list</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the full list of existing attributes to include</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rename_map</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary of renamed attributes: keys=new names, values=old names</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>compute_map</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a direction of computed attributes This low-level method performs no error checking.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/heading.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_list</span><span class="p">,</span> <span class="n">rename_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    derive a new heading by selecting, renaming, or computing attributes.</span>
<span class="sd">    In relational algebra these operators are known as project, rename, and extend.</span>

<span class="sd">    :param select_list:  the full list of existing attributes to include</span>
<span class="sd">    :param rename_map:  dictionary of renamed attributes: keys=new names, values=old names</span>
<span class="sd">    :param compute_map: a direction of computed attributes</span>
<span class="sd">    This low-level method performs no error checking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rename_map</span> <span class="o">=</span> <span class="n">rename_map</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">compute_map</span> <span class="o">=</span> <span class="n">compute_map</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">copy_attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">select_list</span><span class="p">:</span>
            <span class="n">copy_attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">())</span>
        <span class="n">copy_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">old_name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span>
                    <span class="n">attribute_expression</span><span class="o">=</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">old_name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">old_name</span> <span class="ow">in</span> <span class="n">rename_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">old_name</span> <span class="o">==</span> <span class="n">name</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">compute_attrs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">default_attribute_properties</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_name</span><span class="p">,</span> <span class="n">attribute_expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">compute_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">copy_attrs</span><span class="p">,</span> <span class="n">compute_attrs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.heading.Heading.join" class="doc doc-heading">
<code class="highlight language-python"><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

<a href="#datajoint.heading.Heading.join" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Join two headings into a new one.
It assumes that self and other are headings that share no common dependent attributes.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/heading.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Join two headings into a new one.</span>
<span class="sd">    It assumes that self and other are headings that share no common dependent attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span>
            <span class="n">other</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondary_attributes</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">]</span>
        <span class="o">+</span> <span class="p">[</span>
            <span class="n">other</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">secondary_attributes</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.heading.Heading.set_primary_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_primary_key</span><span class="p">(</span><span class="n">primary_key</span><span class="p">)</span></code>

<a href="#datajoint.heading.Heading.set_primary_key" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create a new heading with the specified primary key.
This low-level method performs no error checking.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/heading.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new heading with the specified primary key.</span>
<span class="sd">    This low-level method performs no error checking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
        <span class="n">chain</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">in_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">primary_key</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">in_key</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">primary_key</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.heading.Heading.make_subquery_heading" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_subquery_heading</span><span class="p">()</span></code>

<a href="#datajoint.heading.Heading.make_subquery_heading" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create a new heading with removed attribute sql_expressions.
Used by subqueries, which resolve the sql_expressions.</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/heading.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_subquery_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new heading with removed attribute sql_expressions.</span>
<span class="sd">    Used by subqueries, which resolve the sql_expressions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Heading</span><span class="p">(</span>
        <span class="nb">dict</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="n">attribute_expression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.UnknownAttributeError" class="doc doc-heading">
        <code>UnknownAttributeError</code>


<a href="#datajoint.table.UnknownAttributeError" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.errors.QueryError" href="../errors/#datajoint.errors.QueryError">QueryError</a></code></p>

  
      <p>User requests an attribute name not found in query heading</p>


        <details class="quote">
          <summary>Source code in <code>datajoint/errors.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UnknownAttributeError</span><span class="p">(</span><span class="n">QueryError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    User requests an attribute name not found in query heading</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.make_condition" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_condition</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span></code>

<a href="#datajoint.table.make_condition" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Translate the input condition into the equivalent SQL condition (a string)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query_expression</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a dj.QueryExpression object to apply condition</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>condition</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>any valid restriction object.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>columns</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a set passed by reference to collect all column names used in the condition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an SQL condition string or a boolean value.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/condition.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_condition</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate the input condition into the equivalent SQL condition (a string)</span>

<span class="sd">    :param query_expression: a dj.QueryExpression object to apply condition</span>
<span class="sd">    :param condition: any valid restriction object.</span>
<span class="sd">    :param columns: a set passed by reference to collect all column names used in the</span>
<span class="sd">        condition.</span>
<span class="sd">    :return: an SQL condition string or a boolean value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.expression</span> <span class="kn">import</span> <span class="n">QueryExpression</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">,</span> <span class="n">U</span>

    <span class="k">def</span> <span class="nf">prep_value</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare SQL condition&quot;&quot;&quot;</span>
        <span class="n">key_match</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">translate_attribute</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">`&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;attr&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">json</span>
            <span class="ow">and</span> <span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> IS NULL&quot;</span>
        <span class="k">if</span> <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="p">[</span><span class="n">key_match</span><span class="p">[</span><span class="s2">&quot;attr&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">uuid</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
                        <span class="s2">&quot;Badly formed UUID </span><span class="si">{v}</span><span class="s2"> in restriction by `</span><span class="si">{k}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=X&#39;</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%%</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">combine_conditions</span><span class="p">(</span><span class="n">negate</span><span class="p">,</span> <span class="n">conditions</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;NOT &#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">negate</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="s1">&#39;)AND(&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">negate</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">Not</span><span class="p">):</span>
        <span class="n">negate</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">negate</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">restriction</span>

    <span class="c1"># restrict by string</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extract_column_names</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">combine_conditions</span><span class="p">(</span>
            <span class="n">negate</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">condition</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%%</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="p">)</span>  <span class="c1"># escape %, see issue #376</span>

    <span class="c1"># restrict by AndList</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">AndList</span><span class="p">):</span>
        <span class="c1"># omit all conditions that evaluate to True</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">make_condition</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">condition</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">negate</span>  <span class="c1"># if any item is False, the whole thing is False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">negate</span>  <span class="c1"># and empty AndList is True</span>
        <span class="k">return</span> <span class="n">combine_conditions</span><span class="p">(</span><span class="n">negate</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="n">items</span><span class="p">)</span>

    <span class="c1"># restriction by dj.U evaluates to True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">negate</span>

    <span class="c1"># restrict by boolean</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">negate</span> <span class="o">!=</span> <span class="n">condition</span>

    <span class="c1"># restrict by a mapping/dict -- convert to an AndList of string equality conditions</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="n">common_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">common_attributes</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">negate</span>  <span class="c1"># no matching attributes -&gt; evaluates to True</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">common_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combine_conditions</span><span class="p">(</span>
            <span class="n">negate</span><span class="p">,</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span>
                <span class="n">prep_value</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">common_attributes</span>  <span class="c1"># handle json indexing</span>
            <span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># restrict by a numpy record -- convert to an AndList of string equality conditions</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">void</span><span class="p">):</span>
        <span class="n">common_attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">condition</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">common_attributes</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">negate</span>  <span class="c1"># no matching attributes -&gt; evaluate to True</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">common_attributes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combine_conditions</span><span class="p">(</span>
            <span class="n">negate</span><span class="p">,</span>
            <span class="n">conditions</span><span class="o">=</span><span class="p">[</span><span class="n">prep_value</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">condition</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">common_attributes</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># restrict by a QueryExpression subclass -- trigger instantiation and move on</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="p">()</span>

    <span class="c1"># restrict by another expression (aka semijoin and antijoin)</span>
    <span class="n">check_compatibility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">PromiscuousOperand</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">operand</span>
        <span class="n">check_compatibility</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">QueryExpression</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check_compatibility</span><span class="p">:</span>
            <span class="n">assert_join_compatibility</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="n">common_attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>
        <span class="p">]</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">common_attributes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">Aggregation</span><span class="p">):</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">make_subquery</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="c1"># without common attributes, any non-empty set matches everything</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">negate</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">negate</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">common_attributes</span>
            <span class="k">else</span> <span class="s2">&quot;(</span><span class="si">{fields}</span><span class="s2">) </span><span class="si">{not_}</span><span class="s2">in (</span><span class="si">{subquery}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common_attributes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span>
                <span class="n">not_</span><span class="o">=</span><span class="s2">&quot;not &quot;</span> <span class="k">if</span> <span class="n">negate</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">subquery</span><span class="o">=</span><span class="n">condition</span><span class="o">.</span><span class="n">make_sql</span><span class="p">(</span><span class="n">common_attributes</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># restrict by pandas.DataFrames</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span><span class="o">.</span><span class="n">to_records</span><span class="p">()</span>  <span class="c1"># convert to numpy.recarray and move on</span>

    <span class="c1"># if iterable (but not a string, a QueryExpression, or an AndList), treat as an OrList</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">or_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_condition</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">condition</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Invalid restriction type </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">or_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">or_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span>
        <span class="p">]</span>  <span class="c1"># ignore False conditions</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">or_list</span><span class="p">):</span>  <span class="c1"># if any item is True, entirely True</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">negate</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;NOT &#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">negate</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="s1">&#39; OR &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">or_list</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">if</span> <span class="n">or_list</span>
            <span class="k">else</span> <span class="n">negate</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.declare" class="doc doc-heading">
<code class="highlight language-python"><span class="n">declare</span><span class="p">(</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#datajoint.table.declare" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Parse declaration and generate the SQL CREATE TABLE code</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>full_table_name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>full name of the table</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>definition</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataJoint table definition</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary of objects that might be referred to in the table</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>SQL CREATE TABLE statement, list of external stores used</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/declare.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">declare</span><span class="p">(</span><span class="n">full_table_name</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse declaration and generate the SQL CREATE TABLE code</span>

<span class="sd">    :param full_table_name: full name of the table</span>
<span class="sd">    :param definition: DataJoint table definition</span>
<span class="sd">    :param context: dictionary of objects that might be referred to in the table</span>
<span class="sd">    :return: SQL CREATE TABLE statement, list of external stores used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">full_table_name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_TABLE_NAME_LENGTH</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span>
            <span class="s2">&quot;Table name `</span><span class="si">{name}</span><span class="s2">` exceeds the max length of </span><span class="si">{max_length}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">MAX_TABLE_NAME_LENGTH</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="p">(</span>
        <span class="n">table_comment</span><span class="p">,</span>
        <span class="n">primary_key</span><span class="p">,</span>
        <span class="n">attribute_sql</span><span class="p">,</span>
        <span class="n">foreign_key_sql</span><span class="p">,</span>
        <span class="n">index_sql</span><span class="p">,</span>
        <span class="n">external_stores</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">prepare_declare</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">primary_key</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DataJointError</span><span class="p">(</span><span class="s2">&quot;Table must have a primary key&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;CREATE TABLE IF NOT EXISTS </span><span class="si">%s</span><span class="s2"> (</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">full_table_name</span>
        <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">attribute_sql</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;PRIMARY KEY (`&quot;</span> <span class="o">+</span> <span class="s2">&quot;`,`&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">primary_key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;`)&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">foreign_key_sql</span>
            <span class="o">+</span> <span class="n">index_sql</span>
        <span class="p">)</span>
        <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">) ENGINE=InnoDB, COMMENT &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">table_comment</span>
    <span class="p">),</span> <span class="n">external_stores</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.alter" class="doc doc-heading">
<code class="highlight language-python"><span class="n">alter</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

<a href="#datajoint.table.alter" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>definition</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>new table definition</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>old_definition</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>current table definition</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the context in which to evaluate foreign key definitions</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>string SQL ALTER command, list of new stores used for external storage</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/declare.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">alter</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param definition: new table definition</span>
<span class="sd">    :param old_definition: current table definition</span>
<span class="sd">    :param context: the context in which to evaluate foreign key definitions</span>
<span class="sd">    :return: string SQL ALTER command, list of new stores used for external storage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span>
        <span class="n">table_comment</span><span class="p">,</span>
        <span class="n">primary_key</span><span class="p">,</span>
        <span class="n">attribute_sql</span><span class="p">,</span>
        <span class="n">foreign_key_sql</span><span class="p">,</span>
        <span class="n">index_sql</span><span class="p">,</span>
        <span class="n">external_stores</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">prepare_declare</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">(</span>
        <span class="n">table_comment_</span><span class="p">,</span>
        <span class="n">primary_key_</span><span class="p">,</span>
        <span class="n">attribute_sql_</span><span class="p">,</span>
        <span class="n">foreign_key_sql_</span><span class="p">,</span>
        <span class="n">index_sql_</span><span class="p">,</span>
        <span class="n">external_stores_</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">prepare_declare</span><span class="p">(</span><span class="n">old_definition</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="c1"># analyze differences between declarations</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">primary_key</span> <span class="o">!=</span> <span class="n">primary_key_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;table.alter cannot alter the primary key (yet).&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">foreign_key_sql</span> <span class="o">!=</span> <span class="n">foreign_key_sql_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;table.alter cannot alter foreign keys (yet).&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index_sql</span> <span class="o">!=</span> <span class="n">index_sql_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;table.alter cannot alter indexes (yet)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attribute_sql</span> <span class="o">!=</span> <span class="n">attribute_sql_</span><span class="p">:</span>
        <span class="n">sql</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_make_attribute_alter</span><span class="p">(</span><span class="n">attribute_sql</span><span class="p">,</span> <span class="n">attribute_sql_</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">table_comment</span> <span class="o">!=</span> <span class="n">table_comment_</span><span class="p">:</span>
        <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;COMMENT=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">table_comment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sql</span><span class="p">,</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">external_stores</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">external_stores_</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="datajoint.table.lookup_class_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lookup_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#datajoint.table.lookup_class_name" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>given a table name in the form <code>schema_name</code>.<code>table_name</code>, find its class in the context.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>schema_name</code>.<code>table_name</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary representing the namespace</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>depth</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search depth into imported modules, helps avoid infinite recursion.</p>
            </div>
          </td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>class name found in the context or None if not found</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lookup_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    given a table name in the form `schema_name`.`table_name`, find its class in the context.</span>

<span class="sd">    :param name: `schema_name`.`table_name`</span>
<span class="sd">    :param context: dictionary representing the namespace</span>
<span class="sd">    :param depth: search depth into imported modules, helps avoid infinite recursion.</span>
<span class="sd">    :return: class name found in the context or None if not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># breadth-first search</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">context_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)]</span>
    <span class="k">while</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">member_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>  <span class="c1"># skip IPython&#39;s implicit variables</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>  <span class="c1"># found it!</span>
                        <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;context_name&quot;</span><span class="p">],</span> <span class="n">member_name</span><span class="p">])</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>  <span class="c1"># look for part tables</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="vm">__dict__</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># not a UserTable -- cannot have part tables.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span>
                            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                        <span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">full_table_name</span> <span class="o">==</span> <span class="n">name</span>
                            <span class="p">):</span>
                                <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;context_name&quot;</span><span class="p">],</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">node</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismodule</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">member</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;datajoint&quot;</span>
                <span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="nb">dict</span><span class="p">(</span>
                                <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">member</span><span class="p">)),</span>
                                <span class="n">context_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;context_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">member_name</span><span class="p">,</span>
                                <span class="n">depth</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># could not import, so do not attempt</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.FreeTable" class="doc doc-heading">
        <code>FreeTable</code>


<a href="#datajoint.table.FreeTable" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.table.Table" href="#datajoint.table.Table">Table</a></code></p>

  
      <p>A base table without a dedicated class. Each instance is associated with a table
specified by full_table_name.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>conn</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a dj.Connection object</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>full_table_name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>in format <code>database</code>.<code>table_name</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>datajoint/table.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FreeTable</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base table without a dedicated class. Each instance is associated with a table</span>
<span class="sd">    specified by full_table_name.</span>

<span class="sd">    :param conn:  a dj.Connection object</span>
<span class="sd">    :param full_table_name: in format `database`.`table_name`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">full_table_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">full_table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="n">full_table_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">table_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
                <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;FreeTable(`</span><span class="si">%s</span><span class="s2">`.`</span><span class="si">%s</span><span class="s2">`)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span><span class="p">)</span>
            <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="datajoint.table.Log" class="doc doc-heading">
        <code>Log</code>


<a href="#datajoint.table.Log" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="datajoint.table.Table" href="#datajoint.table.Table">Table</a></code></p>

  
      <p>The log table for each schema.
Instances are callable.  Calls log the time and identifying information along with the event.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>skip_logging</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if True, then log entry is skipped by default. See <strong>call</strong></p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>datajoint/table.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Log</span><span class="p">(</span><span class="n">Table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The log table for each schema.</span>
<span class="sd">    Instances are callable.  Calls log the time and identifying information along with the event.</span>

<span class="sd">    :param skip_logging: if True, then log entry is skipped by default. See __call__</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_table_name</span> <span class="o">=</span> <span class="s2">&quot;~log&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">skip_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_logging</span> <span class="o">=</span> <span class="n">skip_logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Heading</span><span class="p">(</span>
            <span class="n">table_info</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">conn</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_support</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">full_table_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;    # event logging table for `</span><span class="si">{database}</span><span class="s2">`</span>
<span class="s2">        id       :int unsigned auto_increment     # event order id</span>
<span class="s2">        ---</span>
<span class="s2">        timestamp = CURRENT_TIMESTAMP : timestamp # event timestamp</span>
<span class="s2">        version  :varchar(12)                     # datajoint version</span>
<span class="s2">        user     :varchar(255)                    # user@host</span>
<span class="s2">        host=&quot;&quot;  :varchar(255)                    # system hostname</span>
<span class="s2">        event=&quot;&quot; :varchar(255)                    # event message</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_declared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declare</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">skip_logging</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param event: string to write into the log table</span>
<span class="sd">        :param skip_logging: If True then do not log. If None, then use self.skip_logging</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">skip_logging</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_logging</span> <span class="k">if</span> <span class="n">skip_logging</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">skip_logging</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_logging</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span>
                        <span class="n">version</span><span class="o">=</span><span class="n">version</span> <span class="o">+</span> <span class="s2">&quot;py&quot;</span><span class="p">,</span>
                        <span class="n">host</span><span class="o">=</span><span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
                        <span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">ignore_extra_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">DataJointError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;could not log event in table ~log&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        bypass interactive prompts and cascading dependencies</span>

<span class="sd">        :return: number of deleted items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;bypass interactive prompts and cascading dependencies&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Log.delete" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete</span><span class="p">()</span></code>

<a href="#datajoint.table.Log.delete" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>bypass interactive prompts and cascading dependencies</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>number of deleted items</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    bypass interactive prompts and cascading dependencies</span>

<span class="sd">    :return: number of deleted items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">(</span><span class="n">get_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="datajoint.table.Log.drop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">drop</span><span class="p">()</span></code>

<a href="#datajoint.table.Log.drop" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>bypass interactive prompts and cascading dependencies</p>

      <details class="quote">
        <summary>Source code in <code>datajoint/table.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;bypass interactive prompts and cascading dependencies&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drop_quick</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.datajoint.com" target="_blank" rel="noopener" title="DataJoint" class="md-social__link">
      <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>
    </a>
  
    
    
    
    
    <a href="https://datajoint.slack.com" target="_blank" rel="noopener" title="Slack" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/datajoint" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/datajoint" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/datajoint" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://hub.docker.com/u/datajoint" target="_blank" rel="noopener" title="DockerHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://pypi.org/user/datajointbot" target="_blank" rel="noopener" title="PyPI" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://stackoverflow.com/questions/tagged/datajoint" target="_blank" rel="noopener" title="StackOverflow" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCdeCuFOTCXlVMRzh6Wk-lGg" target="_blank" rel="noopener" title="YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>